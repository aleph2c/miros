
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Recipes &#8212; miros 2.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Reflection" href="reflection.html" />
    <link rel="prev" title="Spy and Trace Across a Network" href="networked_instrumentation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <blockquote id="recipes">
<div><p><em>Simple things should be simple, complex things should be possible.</em></p>
<p class="attribution">&mdash;Alan Kay</p>
</div></blockquote>
<div class="section" id="id1">
<h1>Recipes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="states">
<span id="recipes-states"></span><h2>States<a class="headerlink" href="#states" title="Permalink to this headline">¶</a></h2>
<p>In the miros frame work, your state methods act as places to link your application code into designed behavior.</p>
<p>States need to:</p>
<ol class="arabic simple">
<li>React to events and run your application code.</li>
<li>Describe their parent state.</li>
<li>Describe how they should transition to other states for specific events.</li>
</ol>
<p>There are different ways to create states with miros:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#recipes-boiler-plate-state-method-code"><span class="std std-ref">You can create a hand-coded state method with if-elif structures.</span></a> (so you can easily port your design
back into the c programming language for embedded applications)</li>
<li><a class="reference internal" href="#recipes-creating-a-state-method-from-a-template"><span class="std std-ref">You can have the library generate a state method for you, then register
callback responses to specific events and set a parent at
runtime.</span></a></li>
<li>You can use a fusion technique.  You can hand write a <a class="reference internal" href="glossary.html#term-state"><span class="xref std std-term">state</span></a> and use context
managers within the method so that the miros package can register callbacks
for specific signals, or even change it’s parent at run time.</li>
<li><a class="reference internal" href="#recipes-creating-a-state-method-from-a-factory"><span class="std std-ref">You can use an Active Object Factory to create your statechart</span></a></li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">I recommend that you only use methods 1 and 4.  Methods 2 and 3 are built up to
provide method 4.  A statechart built using a factory, method 4, can always be
turned back into a statechart of method 1 using the <code class="docutils literal"><span class="pre">to_code</span></code> method.</p>
</div>
<p id="recipes-state-recipes"><strong>State Recipes</strong>:</p>
<ul class="simple">
<li><a class="reference internal" href="#recipes-boiler-plate-state-method-code"><span class="std std-ref">Boiler plate state method code</span></a></li>
<li><a class="reference internal" href="#recipes-describe-a-parent-state"><span class="std std-ref">Describe a parent state</span></a></li>
<li><a class="reference internal" href="#recipes-pass-an-event-through-to-a-parent-state"><span class="std std-ref">Pass an event through to a parent state</span></a></li>
<li><a class="reference internal" href="#recipes-transition-to-another-state"><span class="std std-ref">Transition to another state</span></a></li>
<li><a class="reference internal" href="#recipes-do-something-when-the-state-is-entered"><span class="std std-ref">Do something when the state is entered</span></a></li>
<li><a class="reference internal" href="#recipes-do-something-when-the-state-is-initialized"><span class="std std-ref">Do something when the state is initialized</span></a></li>
<li><a class="reference internal" href="#recipes-do-something-when-the-state-is-exited"><span class="std std-ref">Do something when the state is exited</span></a></li>
<li><a class="reference internal" href="#recipes-markup-your-event-processor"><span class="std std-ref">Augment your active object</span></a></li>
<li><a class="reference internal" href="#recipes-create-a-hook"><span class="std std-ref">Create a hook</span></a></li>
<li><a class="reference internal" href="#recipes-catch-and-release"><span class="std std-ref">Catch and release</span></a></li>
<li><a class="reference internal" href="#recipes-create-a-one-shot-state"><span class="std std-ref">Create a one-shot</span></a></li>
<li><a class="reference internal" href="#recipes-create-a-mult-shot-state"><span class="std std-ref">Create a multi-shot</span></a></li>
<li><a class="reference internal" href="#recipes-cancelling-events-state"><span class="std std-ref">Cancel events</span></a></li>
<li><a class="reference internal" href="#recipes-deferring-an-event-state"><span class="std std-ref">Defer and Recall an event</span></a></li>
<li><a class="reference internal" href="#recipes-what-a-state-does-and-how-to-structure-it"><span class="std std-ref">A Deeper look at state methods</span></a></li>
<li><a class="reference internal" href="#recipes-creating-a-state-method-from-a-template"><span class="std std-ref">Creating a statechart from a template</span></a></li>
<li><a class="reference internal" href="#recipes-creating-a-state-method-from-a-factory"><span class="std std-ref">Creating a statechart from a factory</span></a></li>
</ul>
<div class="section" id="what-a-state-does-and-how-to-structure-it">
<span id="recipes-what-a-state-does-and-how-to-structure-it"></span><h3>What a State Does and How to Structure it<a class="headerlink" href="#what-a-state-does-and-how-to-structure-it" title="Permalink to this headline">¶</a></h3>
<p>Your state methods represent the rounded rectangles in your statechart diagram.
They contain information about how a state should react to an event and they
contain information about how they relate to other states.  They do not
explicitly create the behavior that you expect from your statechart, this is
done by an event processor.  An event processor is created when you instantiate
an active object and it is the thing that calls the state methods over and over
again to manifest the expected behavior.</p>
<p>When an active object uses its <code class="docutils literal"><span class="pre">start_at</span></code> method, it connects your state
method to its event processor.</p>
<p>An event processor never actually learns or remembers the full nature of how
your state methods are linked to one another, it only remembers it’s current
state and where it would like to transition within the diagram on its next
pass.  It always searches them as it reacts to whatever event you have provided
it.  So, your design is discovered as the event processor reacts to events.  Your
state method’s can be used by many different event processors, they’re
polyamorous:</p>
<div align="center" class="align-center"><img alt="_images/eventprocessors.svg" src="_images/eventprocessors.svg" /></div>
<p>In the diagram above we see that two different active objects can use the same
statechart structure.  Each active object can be in a different state, even
though they are using the same diagram.   <code class="docutils literal"><span class="pre">ao1</span></code> starts it’s interpretation of
the statechart in state <code class="docutils literal"><span class="pre">c</span></code> and <code class="docutils literal"><span class="pre">ao2</span></code> starts it’s interpretation of the
statechart in state <code class="docutils literal"><span class="pre">c2</span></code>.  As someone building this design you would create
two different active objects, and you would define three different state
methods, then you would start the different active objects with a <code class="docutils literal"><span class="pre">start_at</span></code>
call.</p>
<p>You don’t explicitly call an event processor while using the miros api, it is
called in the background when you use methods like <code class="docutils literal"><span class="pre">start_at</span></code>, <code class="docutils literal"><span class="pre">post_fifo</span></code>
or <code class="docutils literal"><span class="pre">post_lifo</span></code>.</p>
<p>The event processor treats a state method as if it was defined within its own
class.  It does this by using its <code class="docutils literal"><span class="pre">self</span></code> variable in the first argument to
the state method call.  It then injects the event into the second argument to
see what the state method will do about it.</p>
<p>The state method communicates back to it’s currently connected event processor
in two different ways.  It adjusts internal attributes on this <code class="docutils literal"><span class="pre">self</span></code>
variable of the thing searching it and by returning a status value.  The first
argument of your state method does not have to be written as <code class="docutils literal"><span class="pre">self</span></code>, it can
be called anything.  If it is called <code class="docutils literal"><span class="pre">chart</span></code> or <code class="docutils literal"><span class="pre">hsm</span></code>, it makes no
difference to how it will actually be used by the event processor.</p>
<p>State methods themselves are stateless.  They do not keep internal variables,
they only react and tweak the variable states of the objects that were given to
them as input arguments.  It is the <code class="docutils literal"><span class="pre">self</span></code> variable of the outside caller
that has new information impressed upon it.  This is how state methods stay
polyamorous.</p>
<p>The states contain a place to anchor your application code.  They also provide
information about the design topology of your chart.  They describe their
parent state and they describe how some events can cause transitions to other
state methods. That’s it.  There is no full picture described in a table or in
any other data structure.  The picture is actually written in the interaction
of your state method code and the event processor calling it.</p>
<p>For this reason an event processor can call your state method many times while
it is trying to discover how your statechart is structured.  It does this
during the <code class="docutils literal"><span class="pre">start_at</span></code> call, or when a <code class="docutils literal"><span class="pre">post_fifo</span></code> or <code class="docutils literal"><span class="pre">post_lifo</span></code> method
is called with an event.</p>
<p>As an application developer you don’t have to care about <cite>how</cite> the event
processor does its job you just need to tell it <cite>what</cite> to do.  You
need to take your picture and turn it into code.  This is done by writing one
state method at a time; linking them together with hierarchy and arrows.</p>
<p>To make an arrow is fairly straight forward.  You just use the <code class="docutils literal"><span class="pre">trans</span></code>
method with your target state as an argument.  This is easy to code.</p>
<div align="center" class="align-center"><img alt="_images/stateapplicationcode3.svg" src="_images/stateapplicationcode3.svg" /></div>
<p>To describe the hierarchy is a little bit more subtle.</p>
<p>All state methods must reveal their parent information.  They do this by using
an if-elif-else and placing the parent information in the <code class="docutils literal"><span class="pre">else</span></code> clause.  It
does this as a kind of default arrow for all events it doesn’t know how to
react to, to the next-outer-most-state.  In this <code class="docutils literal"><span class="pre">else</span></code> clause it:</p>
<ol class="arabic simple">
<li>sets <code class="docutils literal"><span class="pre">self.temp.fun</span></code> of the event processor to point to it’s parent state method</li>
<li>return the value of <code class="docutils literal"><span class="pre">return_status.SUPER</span></code></li>
</ol>
<div align="center" class="align-center"><img alt="_images/stateapplicationcode1.svg" src="_images/stateapplicationcode1.svg" /></div>
<p>For the outermost state of your state chart you set the parent  to <code class="docutils literal"><span class="pre">self.top</span></code>.
This state method is actually defined within the event processor and when it
sees this state it knows that it is about to fall of the edge of your map.</p>
<p>If your parent state isn’t the outer most state, you would just set the
<code class="docutils literal"><span class="pre">self.temp.fun</span></code> to whatever state is:</p>
<div align="center" class="align-center"><img alt="_images/stateapplicationcode2.svg" src="_images/stateapplicationcode2.svg" /></div>
<p>Now that we understand how state methods relate to each other and to event
processors let’s look at a simple example to see how the pictures relate to
working code.</p>
<div align="center" class="align-center"><img alt="_images/eventprocessors.svg" src="_images/eventprocessors.svg" /></div>
<p>First you would describe state’s <code class="docutils literal"><span class="pre">c</span></code>, <code class="docutils literal"><span class="pre">c1</span></code> and <code class="docutils literal"><span class="pre">c2</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros.hsm</span> <span class="kn">import</span> <span class="n">spy_on</span>
<span class="kn">from</span> <span class="nn">miros.activeobject</span> <span class="kn">import</span> <span class="n">ActiveObject</span>
<span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">signals</span><span class="p">,</span> <span class="n">return_status</span><span class="p">,</span> <span class="n">Event</span>

<span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="c1"># call c&#39;s entry code</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">B</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="c1"># call c&#39;s exit code</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="k">def</span> <span class="nf">c1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">A</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">trans</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="k">def</span> <span class="nf">c2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">A</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">trans</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>Then you would connect the state methods into two different active objects and
start them in their desired states:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ao1</span><span class="p">,</span> <span class="n">ao2</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">(),</span> <span class="n">ActiveObject</span><span class="p">()</span>
<span class="n">ao1</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">ao2</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">ao1</span></code> would act as if it owned the map, and <code class="docutils literal"><span class="pre">ao2</span></code> would act as if it owned
the map.  Neither would know that <cite>their</cite> state methods were being used by more
than one active object.</p>
</div>
<div class="section" id="boiler-plate-state-method-code">
<span id="recipes-boiler-plate-state-method-code"></span><h3>Boiler Plate State Method Code<a class="headerlink" href="#boiler-plate-state-method-code" title="Permalink to this headline">¶</a></h3>
<p>For a flat state:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="o">&lt;</span><span class="n">your_state_method_name</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="c1"># if you state method doesn&#39;t know what to do it should return this</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="c1"># call your entry application code</span>

    <span class="c1"># make sure you tell the event processor you handled this event</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="c1"># call your initialization (big black dot) application code</span>

    <span class="c1"># make sure you tell the event processor you handled this event</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="c1">#</span>
  <span class="c1"># Write your custom</span>
  <span class="c1"># event handlers in here as there own elif clauses</span>
  <span class="c1">#</span>

  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="c1"># call your exit (big black dot) application code</span>

    <span class="c1"># make sure you tell the event processor you handled this event</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="c1"># this logic will run when your event processor sends an event with the</span>
    <span class="c1"># SEARCH_FOR_SUPER_SIGNAL name</span>

    <span class="c1"># 1) place your parent state method into the self.temp.fun</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">your_parent_state_method</span><span class="o">&gt;</span>

    <span class="c1"># 2) make sure you return this value</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="c1"># return the status value</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>If your state method didn’t include handling for the <code class="docutils literal"><span class="pre">ENTRY_SIGNAL</span></code>,
<code class="docutils literal"><span class="pre">INIT_SIGNAL</span></code> or <code class="docutils literal"><span class="pre">EXIT_SIGNAL</span></code>, the event processor will just assume it did
and returned return_state.HANDLED.</p>
</div>
<div class="section" id="describe-a-parent-state">
<span id="recipes-describe-a-parent-state"></span><h3>Describe a Parent State<a class="headerlink" href="#describe-a-parent-state" title="Permalink to this headline">¶</a></h3>
<p>To describe your parent state:</p>
<ol class="arabic simple">
<li>setting the <code class="docutils literal"><span class="pre">temp.fun</span></code> attribute of the first argument to point at their
parent state.</li>
<li>return the value of <code class="docutils literal"><span class="pre">return_state.SUPER</span></code></li>
</ol>
<p>Generally speaking this is how it is done:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="o">&lt;</span><span class="n">state_method_name</span><span class="o">&gt;</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="c1"># .</span>
  <span class="c1"># .</span>
  <span class="k">else</span><span class="p">:</span>
<span class="hll">    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
</span><span class="hll">    <span class="n">chart</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">parent_state_of_this_state_method</span><span class="o">&gt;</span>
</span>  <span class="k">return</span> <span class="n">status</span><span class="o">.</span>
</pre></div>
</div>
<p>If you need to define your parent state as the outermost state of your diagram, you would
set the <code class="docutils literal"><span class="pre">&lt;parent_state_of_this_state_method&gt;</span></code> to the <code class="docutils literal"><span class="pre">top</span></code> attribute of the
first argument provided your crafted the state method:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="o">&lt;</span><span class="n">state_method_name</span><span class="o">&gt;</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="c1"># .</span>
  <span class="c1"># .</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
<span class="hll">    <span class="n">chart</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">top</span>
</span>  <span class="k">return</span> <span class="n">status</span><span class="o">.</span>
</pre></div>
</div>
<p>To read more about why you structure your state methods this way, read <a class="reference internal" href="#recipes-what-a-state-does-and-how-to-structure-it"><span class="std std-ref">this.</span></a></p>
</div>
<div class="section" id="pass-an-event-through-to-a-parent-state">
<span id="recipes-pass-an-event-through-to-a-parent-state"></span><h3>Pass an event through to a Parent State<a class="headerlink" href="#pass-an-event-through-to-a-parent-state" title="Permalink to this headline">¶</a></h3>
<p>The easiest way to pass an event outward in your statechart is not to handle it
in your <code class="docutils literal"><span class="pre">if-elif</span></code> clauses and let your <code class="docutils literal"><span class="pre">else</span></code>
<a class="reference internal" href="#recipes-describe-a-parent-state"><span class="std std-ref">clause</span></a> handle it.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Sending Event(signal=signals.B) to c1 would cause</span>
<span class="c1"># the parent state c to be called with this event,</span>
<span class="c1"># since it is not handled in the ``if-elif``</span>
<span class="c1"># logic structure or c1.</span>
<span class="k">def</span> <span class="nf">c1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">A</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">trans</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>Another way to pass an event out to your parent state is to handle the event in
the <code class="docutils literal"><span class="pre">if-elif</span></code> clause, then return <code class="docutils literal"><span class="pre">return_status.UNHANDLED</span></code> to the event
processor.  When it sees that your state method couldn’t handle the event it
will call it again to find it’s parent state and then call that parent state
method with the event that you want to trickle outward in your diagram.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Sending Event(signal=signals.B) to c1 would cause</span>
<span class="c1"># the parent state c to be called with this event,</span>
<span class="c1"># since c1 returns a `UNHANDLED` value to the event</span>
<span class="c1"># processor</span>
<span class="k">def</span> <span class="nf">c1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">B</span><span class="p">):</span>
<span class="hll">    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;saw signal B, but letting it trickle through to my parent&quot;</span><span class="p">)</span>
</span>  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">A</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">trans</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
</div>
<div class="section" id="transition-to-another-state">
<span id="recipes-transition-to-another-state"></span><h3>Transition to another state<a class="headerlink" href="#transition-to-another-state" title="Permalink to this headline">¶</a></h3>
<p>To transition to another state, use the <code class="docutils literal"><span class="pre">trans</span></code> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Sending Event(signal=signals.A) will cause a transition to c2</span>
<span class="k">def</span> <span class="nf">c1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
<span class="hll">  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">A</span><span class="p">):</span>
</span><span class="hll">    <span class="n">status</span> <span class="o">=</span> <span class="n">trans</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
</span>  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>Make sure that you return the result of the call to your <code class="docutils literal"><span class="pre">trans</span></code> method, or
the event processor will break.</p>
</div>
<div class="section" id="do-something-when-the-state-is-entered">
<span id="recipes-do-something-when-the-state-is-entered"></span><h3>Do Something when the State is Entered<a class="headerlink" href="#do-something-when-the-state-is-entered" title="Permalink to this headline">¶</a></h3>
<p>To have your application code run when a state is entered place it in the
<code class="docutils literal"><span class="pre">ENTRY_SIGNAL</span></code> clause of your state’s if-elif structure.  An entry event will
occur anytime the event processor detects a transition from the outside to the
inside of your state method’s boundary.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Running application code when the state is entered</span>
<span class="k">def</span> <span class="nf">c1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
<span class="hll">  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
</span><span class="hll">    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running my entry application code here&quot;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
</span>  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
</div>
<div class="section" id="do-something-when-the-state-is-initialized">
<span id="recipes-do-something-when-the-state-is-initialized"></span><h3>Do Something when the State is Initialized<a class="headerlink" href="#do-something-when-the-state-is-initialized" title="Permalink to this headline">¶</a></h3>
<p>To have your application code run when a state is initialized place it in the
<code class="docutils literal"><span class="pre">INIT_SIGNAL</span></code> clause of your state’s if-elif structure.  An init event will
occur after the entry event, if a transition is moving from the outside to the
inside of your state method’s boundary.  It will also occur if there is a
transition into this state from one of its child states.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Running application code when the state is initialized</span>
<span class="k">def</span> <span class="nf">c1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
<span class="hll">  <span class="c1"># BIG BLACK DOT ON DIAGRAM</span>
</span><span class="hll">  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
</span><span class="hll">    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running my init application code here&quot;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
</span>  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">NOTE:</th><td class="field-body">If you only want to run initialization code and do not want your state
to immediately transition into another state, make sure you return
<code class="docutils literal"><span class="pre">HANDLED</span></code> after running your application code, otherwise your
statechart will not behave properly.</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">INIT_SIGNAL</span></code> handler is often used as the place where your state can
immediately transition into another state.  To do this, just use the
<a class="reference internal" href="#recipes-transition-to-another-state"><span class="std std-ref">trans</span></a> method and return its result
from your state method call:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Running application code when the state is initialized</span>
<span class="k">def</span> <span class="nf">c1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
<span class="hll">  <span class="c1"># BIG BLACK DOT ON DIAGRAM</span>
</span><span class="hll">  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
</span><span class="hll">    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running my init application code here&quot;</span><span class="p">)</span>
</span><span class="hll">    <span class="c1"># now transition into the c2 state</span>
</span><span class="hll">    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
</span>  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you use an init signal to transition out of your parent state an
<code class="docutils literal"><span class="pre">HsmTopologyException</span></code> will be issued.  Init signals should only be used to
run code with no transitions or to transition deeper into your statechart.
If you absolutely need to leave a state after entering  you can post an
<a class="reference internal" href="glossary.html#term-artificial-event"><span class="xref std std-term">artificial event</span></a> into the fifo/lifo.  This will
cause this signal to be caught on the next <a class="reference internal" href="glossary.html#term-run-to-completion"><span class="xref std std-term">rtc</span></a>
process and your statechart will behave as you want it to (though, you should
probably re-visit your design).</p>
</div>
</div>
<div class="section" id="do-something-when-the-state-is-exited">
<span id="recipes-do-something-when-the-state-is-exited"></span><h3>Do Something when the State is Exited<a class="headerlink" href="#do-something-when-the-state-is-exited" title="Permalink to this headline">¶</a></h3>
<p>To have your application code run when a state is exited place it in the
<code class="docutils literal"><span class="pre">EXIT_SIGNAL</span></code> clause of your state’s if-elif structure.  An exit event will
occur anytime the event processor detects a transition from the inside to the
outside of of your state method’s boundary.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Running application code when the state is entered</span>
<span class="k">def</span> <span class="nf">c1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
<span class="hll">  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
</span><span class="hll">    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running my exit application code here&quot;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
</span>  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
</div>
<div class="section" id="augment-your-active-object">
<span id="recipes-markup-your-event-processor"></span><h3>Augment Your Active Object<a class="headerlink" href="#augment-your-active-object" title="Permalink to this headline">¶</a></h3>
<p>It is a bad idea to add variables to the state methods, instead augment your
active objects using the <code class="docutils literal"><span class="pre">augment</span></code> command.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">ActiveObect</span><span class="p">()</span>
<span class="n">chart</span><span class="o">.</span><span class="n">augment</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;counter&#39;</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-hook">
<span id="recipes-create-a-hook"></span><h3>Create a Hook<a class="headerlink" href="#create-a-hook" title="Permalink to this headline">¶</a></h3>
<p>A hook is some application code that is shared between your state method and
all of its child state method’s.</p>
<p>Here we will create a hook in the c1 state, linking some application code to an
event with the signal name <code class="docutils literal"><span class="pre">MY_HOOK</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Sending Event(signal=signals.A) will cause a transition to c2</span>
<span class="k">def</span> <span class="nf">c1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>

<span class="hll">  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">MY_HOOK</span><span class="p">):</span>
</span><span class="hll">    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;running the code defined in c1&quot;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>Now we will make a child state.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Create a child state of c1</span>
<span class="k">def</span> <span class="nf">c11</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>We will start up our state chart, in c11 and send the <code class="docutils literal"><span class="pre">MY_HOOK</span></code> event:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ao</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>
<span class="n">ao</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">c11</span><span class="p">)</span>
<span class="c1"># run code in c1 from c11 by using a hook</span>
<span class="n">ao</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">MY_HOOK</span><span class="p">))</span>
  <span class="c1"># =&gt; &quot;running the code from defined in c1&quot;</span>
<span class="c1"># demonstrate the state didn&#39;t change</span>
<span class="k">assert</span><span class="p">(</span><span class="n">ao</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;c11&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above code we see evidence that our statechart ran some application code
contained in the parent state (<code class="docutils literal"><span class="pre">c1</span></code>) while it stayed within its child state
(<code class="docutils literal"><span class="pre">c11</span></code>).</p>
<p>The child state received an event called <code class="docutils literal"><span class="pre">MY_HOOK</span></code> which it didn’t know what
to do with.  So the event processor searched the parent state and saw that there was a
handler for this event in <code class="docutils literal"><span class="pre">c1</span></code>.  The <code class="docutils literal"><span class="pre">MY_HOOK</span></code> handler (the if-elif
clause) returned <code class="docutils literal"><span class="pre">return_status.HANDLED</span></code>.  Upon seeing this value, the event
processor determined that no transition is needed and it stopped running.</p>
<div align="center" class="align-center"><img alt="_images/hook1.svg" src="_images/hook1.svg" /></div>
<p>In this way hook code is run in the search phase of the search-then-transition
part of the event processor algorithm.</p>
<p>The <code class="docutils literal"><span class="pre">c1</span></code> state method, “hooks” the <code class="docutils literal"><span class="pre">MY_HOOK</span></code> event, by capturing it, running
its application code and returning the <code class="docutils literal"><span class="pre">HANDLED</span></code> value.  It stops the
<code class="docutils literal"><span class="pre">MY_HOOK</span></code> event from falling off the edge of the map and returns control to
the state that originally experienced the event.</p>
</div>
<div class="section" id="catch-and-release">
<span id="recipes-catch-and-release"></span><h3>Catch and Release<a class="headerlink" href="#catch-and-release" title="Permalink to this headline">¶</a></h3>
<p>The catch and release recipe is similar to the
<a class="reference internal" href="#recipes-create-a-hook"><span class="std std-ref">hook</span></a> recipe in that you are using the search
phase of the event processor algorithm to run your code.</p>
<p>Instead of hooking the code with an <code class="docutils literal"><span class="pre">HANDLED</span></code> response, your state method
returns an <code class="docutils literal"><span class="pre">UNHANDLED</span></code> status.  This causes the event processor, to query it
again to find its parent, then dispatch the event to that state method.</p>
<div align="center" class="align-center"><img alt="_images/catchandrelease1.svg" src="_images/catchandrelease1.svg" /></div>
<p>Here we create the state in the picture, notice that <code class="docutils literal"><span class="pre">inner</span></code> and <code class="docutils literal"><span class="pre">middle</span></code>
do not return <code class="docutils literal"><span class="pre">HANDLED</span></code> when they see the <code class="docutils literal"><span class="pre">BUBBLED</span></code> signal.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">outer</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
<span class="hll">  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">BUBBLED</span><span class="p">):</span>
</span><span class="hll">    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;hooked by the outer state&quot;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
</span>  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">top</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="hll">  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
</span><span class="hll">  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">BUBBLED</span><span class="p">):</span>
</span><span class="hll">    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;processed in middle&quot;</span><span class="p">)</span>
</span>  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">outer</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="hll">  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
</span><span class="hll">  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">BUBBLED</span><span class="p">):</span>
</span><span class="hll">    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;processed in inner&quot;</span><span class="p">)</span>
</span>  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">outer</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="n">ao</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>
<span class="hll"><span class="n">ao</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
</span><span class="c1"># run each state&#39;s application code for the bubble event</span>
<span class="n">ao</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">BUBBLED</span><span class="p">))</span>
  <span class="c1"># =&gt; &quot;processed in inner&quot;</span>
  <span class="c1">#    &quot;processed in middle&quot;</span>
  <span class="c1">#    &quot;hooked by the outer state&quot;</span>
<span class="c1"># demonstrate the state didn&#39;t change</span>
<span class="hll"><span class="k">assert</span><span class="p">(</span><span class="n">ao</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<div class="section" id="create-a-one-shot">
<span id="recipes-create-a-one-shot-state"></span><h3>Create a One-Shot<a class="headerlink" href="#create-a-one-shot" title="Permalink to this headline">¶</a></h3>
<p>A one-shot event can be used to add some delay between state transitions.  You
can think of them as delayed <strong>init</strong> signals.  You might want to use a one-shot if
you need a system to settle down a bit before transitioning into an inner
state.</p>
<p>Generally speaking, you should cancel your one-shot events as your chart passes
control to outer states.  You don’t need to do this, but if you don’t your
outer states will be hit with one-shot messages that they don’t care about
and your chart will needlessly search as it reacts to these events.</p>
<p>It is important to know that if your chart changes state, the event posted to
it will look like it came from outside of your statechart, even though it was
originally generated within a given state.  The construction of any event with
the <code class="docutils literal"><span class="pre">fifo</span></code> or <code class="docutils literal"><span class="pre">lifo</span></code> api behaves like this.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Here define a middle state the creates a one-shot event called</span>
<span class="c1"># delayed_one_second.  The same delayed_one_second signal is captured</span>
<span class="c1"># by the middle state and used to transition into the inner state</span>
<span class="nd">@spy_on</span>
<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">ao</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">UNHANDLED</span>

  <span class="c1"># we have entered the state and we would like to delay one</span>
  <span class="c1"># second prior to entering the inner state</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
      <span class="n">ao</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span>
        <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">delay_one_second</span><span class="p">),</span>
        <span class="n">times</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">deferred</span><span class="o">=</span><span class="bp">True</span>
      <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="c1"># we are leaving this state for an outer state</span>
    <span class="c1"># so we cancel our one-shot in case it hasn&#39;t gone off yet</span>
    <span class="n">ao</span><span class="o">.</span><span class="n">cancel_events</span><span class="p">(</span><span class="n">ao</span><span class="o">.</span><span class="n">delay_one_second</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="c1"># ignore our init</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="c1"># our one-shot has fired, one second has passed since</span>
  <span class="c1"># we transitioned into this state, now transition</span>
  <span class="c1"># to our desired target; &#39;inner&#39;</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">delay_one_second</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">ao</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>

  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">ao</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">SUPER</span><span class="p">,</span> <span class="n">outer</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-multi-shot">
<span id="recipes-create-a-mult-shot-state"></span><h3>Create a Multi-Shot<a class="headerlink" href="#create-a-multi-shot" title="Permalink to this headline">¶</a></h3>
<p>A multi-shot event is just an extension of the one-shot idea.  Instead of only
being fired once on entry, it can be fired between 2 and an infinite number of
times.  You would use a multi-shot event if you would like to provide an inner
part of your chart with a heart beat that the outer part of your chart doesn’t
need to know about.  In this way you could save cycles by avoiding unnecessary
event processing in the parts of the chart that don’t need these heart beats.
This will also be useful while debugging your chart, your logs won’t be filled
with unnecessary events.</p>
<p>You should cancel your multi-shot events in the exit handler of the state that
created them.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Here define a middle state the creates a multi-shot event called</span>
<span class="c1"># three_pulse.  The same three_pulse signal is captured</span>
<span class="c1"># by the middle state and used to transition into the inner state</span>
<span class="nd">@spy_on</span>
<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">ao</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">multi_shot_thread</span> <span class="o">=</span> \
      <span class="n">ao</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">),</span>
                      <span class="n">times</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                      <span class="n">period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                      <span class="n">deferred</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1"># We mark up the ao with this id, so that</span>
    <span class="c1"># state function can be used by many different aos</span>
    <span class="n">ao</span><span class="o">.</span><span class="n">augment</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">multi_shot_thread</span><span class="p">,</span>
                  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;multi_shot_thread&#39;</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">ao</span><span class="o">.</span><span class="n">cancel_event</span><span class="p">(</span><span class="n">ao</span><span class="o">.</span><span class="n">multi_shot_thread</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">ao</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">ao</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">SUPER</span><span class="p">,</span> <span class="n">outer</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>By setting the <code class="docutils literal"><span class="pre">times</span></code> argument of the <code class="docutils literal"><span class="pre">post_fifo</span></code> to 0, you can create an
infinite multi-shot event.  This is how you could make an inner heart beat.</p>
<p>The <code class="docutils literal"><span class="pre">post_lifo</span></code> api can be used the same as the <code class="docutils literal"><span class="pre">post_fifo</span></code> api for
creating these types of repeating events.  You would use the <code class="docutils literal"><span class="pre">post_lifo</span></code> api
when you would need your heart beat event signal to barge ahead of all other
events waiting to be processed by the active object.</p>
</div>
<div class="section" id="cancelling-events">
<span id="recipes-cancelling-events-state"></span><span id="recipes-cancelling-a-specific-event-source"></span><h3>Cancelling Events<a class="headerlink" href="#cancelling-events" title="Permalink to this headline">¶</a></h3>
<p>To kill a cancel a spefic event, see <a class="reference internal" href="i_create_a_multishot.html#recipes-cancelling-a-specific-event-source"><span class="std std-ref">this.</span></a></p>
<p>To kill all events sharing a signal name, see <a class="reference internal" href="#recipes-cancelling-event-source-by-signal-name"><span class="std std-ref">this.</span></a></p>
</div>
<div class="section" id="deferring-and-recalling-an-event">
<span id="recipes-deferring-an-event-state"></span><h3>Deferring and Recalling an Event<a class="headerlink" href="#deferring-and-recalling-an-event" title="Permalink to this headline">¶</a></h3>
<p>There will be situations where you want to post a kind of artificial event into
a queue which won’t immediately be acted upon by your startchart.  It is an
<cite>artificial</cite> event, because your chart is making it up, it isn’t being given to
it by the outside world.  It is a way for your chart to build up a kind of
processing pressure that can be relieved when you have the cycles to work on
things.</p>
<p>This is a two stage process, one, deferring the event, and two, recalling the
event.  It is called a deferment of an event because we are holding off our
reaction to it.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># code to place in the state that is deferring the event:</span>
<span class="n">chart</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">signal_that_is_deferred</span><span class="p">)</span>

<span class="c1"># code to place in the state where you would like the event reposted into</span>
<span class="c1"># the chart&#39;s first in first out queue</span>
<span class="n">chart</span><span class="o">.</span><span class="n">recall</span><span class="p">()</span> <span class="c1"># posts our deferred event to the chart.</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-guard">
<span id="recipes-create-a-guard"></span><h3>Create a Guard<a class="headerlink" href="#create-a-guard" title="Permalink to this headline">¶</a></h3>
<p>There will be situations where you only would like an event to cause a
transition between two states if a condition is true.  This is called a guard,
in UML it looks like this:</p>
<div align="center" class="align-center"><img alt="_images/guard.svg" src="_images/guard.svg" /></div>
<p>The logic between the square brackets must be true for this event to work.  In
this case the <code class="docutils literal"><span class="pre">T</span></code> event is guarded, it can only cause a transition if the the
function <code class="docutils literal"><span class="pre">g()</span></code> returns <code class="docutils literal"><span class="pre">True</span></code>, otherwise nothing will happen.</p>
<p>The <code class="docutils literal"><span class="pre">t()</span></code> function is a function that runs if the <code class="docutils literal"><span class="pre">g()</span></code> returns True.</p>
<p>To implement a guard in your state method is very straight forward, you use an
if statement:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
<span class="hll">  <span class="k">if</span> <span class="n">g</span><span class="p">():</span>
</span>    <span class="n">t</span><span class="p">()</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="o">&lt;</span><span class="n">state_to_transition_to</span><span class="p">)</span>
</pre></div>
</div>
<p>The highlighted code is the guard.</p>
<p>To learn more about guards read the
<a class="reference internal" href="scribbleexample.html#scribbleexample-hacking-to-learn-the-deeper-dynamics"><span class="std std-ref">hacking to learn example.</span></a></p>
</div>
<div class="section" id="creating-a-statechart-from-a-template">
<span id="recipes-creating-a-state-method-from-a-template"></span><h3>Creating a Statechart From a Template<a class="headerlink" href="#creating-a-statechart-from-a-template" title="Permalink to this headline">¶</a></h3>
<p>To have the library create your state methods for you:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#recipes-template-1"><span class="std std-ref">Import the correct items from the miros library</span></a></li>
<li><a class="reference internal" href="#recipes-template-2"><span class="std std-ref">Create a set of states from the miros template.</span></a></li>
<li><a class="reference internal" href="#recipes-template-3"><span class="std std-ref">Create callback functions which you will link into the chart</span></a></li>
<li><a class="reference internal" href="#recipes-template-4"><span class="std std-ref">Create an active object, and link it to your state handler</span></a></li>
<li><a class="reference internal" href="#recipes-template-5"><span class="std std-ref">Register callbacks to each of your events.</span></a></li>
<li><a class="reference internal" href="#recipes-template-6"><span class="std std-ref">Relate your states to one another by assigning them parents</span></a></li>
<li><a class="reference internal" href="#recipes-template-7"><span class="std std-ref">Start up the active object in the desired state</span></a></li>
<li><a class="reference internal" href="#recipes-template-8"><span class="std std-ref">Debugging a templated state method</span></a></li>
</ol>
<div align="center" class="align-center"><img alt="_images/factory2.svg" src="_images/factory2.svg" /></div>
<p id="recipes-template-1">Import the correct items from the miros library:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros.hsm</span> <span class="kn">import</span> <span class="n">state_method_template</span>
<span class="kn">from</span> <span class="nn">miros.activeobject</span> <span class="kn">import</span> <span class="n">ActiveObject</span>
<span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">signals</span><span class="p">,</span> <span class="n">Event</span><span class="p">,</span> <span class="n">return_status</span>
</pre></div>
</div>
<p id="recipes-template-2">Create a set of states from the miros template:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">tc2_s1</span> <span class="o">=</span> <span class="n">state_method_template</span><span class="p">(</span><span class="s1">&#39;tc2_s1&#39;</span><span class="p">)</span>
<span class="n">tc2_s2</span> <span class="o">=</span> <span class="n">state_method_template</span><span class="p">(</span><span class="s1">&#39;tc2_s2&#39;</span><span class="p">)</span>
<span class="n">tc2_s3</span> <span class="o">=</span> <span class="n">state_method_template</span><span class="p">(</span><span class="s1">&#39;tc2_s3&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p id="recipes-template-3">Create callback functions which you will link into your chart:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">trans_to_c2_s1</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">tc2_s1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">trans_to_c2_s3</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">tc2_s3</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">trans_to_c2_s2</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">tc2_s2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">handled</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
</pre></div>
</div>
<p id="recipes-template-4">Create an active object and link it to your state handler:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ao</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>
</pre></div>
</div>
<p id="recipes-template-5">Register callbacks to each of your events:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ao</span><span class="o">.</span><span class="n">register_signal_callback</span><span class="p">(</span><span class="n">tc2_s1</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">BB</span><span class="p">,</span> <span class="n">trans_to_c2_s1</span><span class="p">)</span>
<span class="n">ao</span><span class="o">.</span><span class="n">register_signal_callback</span><span class="p">(</span><span class="n">tc2_s1</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">,</span> <span class="n">handled</span><span class="p">)</span>
<span class="n">ao</span><span class="o">.</span><span class="n">register_signal_callback</span><span class="p">(</span><span class="n">tc2_s1</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">,</span>  <span class="n">handled</span><span class="p">)</span>
<span class="n">ao</span><span class="o">.</span><span class="n">register_signal_callback</span><span class="p">(</span><span class="n">tc2_s1</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">,</span>  <span class="n">trans_to_c2_s2</span><span class="p">)</span>

<span class="n">ao</span><span class="o">.</span><span class="n">register_signal_callback</span><span class="p">(</span><span class="n">tc2_s2</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">trans_to_c2_s3</span><span class="p">)</span>
<span class="n">ao</span><span class="o">.</span><span class="n">register_signal_callback</span><span class="p">(</span><span class="n">tc2_s2</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">,</span>  <span class="n">handled</span><span class="p">)</span>
<span class="n">ao</span><span class="o">.</span><span class="n">register_signal_callback</span><span class="p">(</span><span class="n">tc2_s2</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">,</span>  <span class="n">handled</span><span class="p">)</span>

<span class="n">ao</span><span class="o">.</span><span class="n">register_signal_callback</span><span class="p">(</span><span class="n">tc2_s3</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">trans_to_c2_s2</span><span class="p">)</span>
<span class="n">ao</span><span class="o">.</span><span class="n">register_signal_callback</span><span class="p">(</span><span class="n">tc2_s3</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">,</span> <span class="n">handled</span><span class="p">)</span>
</pre></div>
</div>
<p id="recipes-template-6">Relate your states to one another by assigning them to parents:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ao</span><span class="o">.</span><span class="n">register_parent</span><span class="p">(</span><span class="n">tc2_s1</span><span class="p">,</span> <span class="n">ao</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
<span class="n">ao</span><span class="o">.</span><span class="n">register_parent</span><span class="p">(</span><span class="n">tc2_s2</span><span class="p">,</span> <span class="n">tc2_s1</span><span class="p">)</span>
<span class="n">ao</span><span class="o">.</span><span class="n">register_parent</span><span class="p">(</span><span class="n">tc2_s3</span><span class="p">,</span> <span class="n">tc2_s1</span><span class="p">)</span>
</pre></div>
</div>
<p id="recipes-template-7">Start up the active object in the desired state:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ao</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">tc2_s2</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#recipes-state-recipes"><span class="std std-ref">Then all of you usual state recipes apply</span></a>.</p>
<p id="recipes-template-8">If you need to debug or unwind your templated state methods, reference
<a class="reference internal" href="#recipes-flatting-a-state-method"><span class="std std-ref">this</span></a>.</p>
</div>
<div class="section" id="creating-a-statechart-from-a-factory">
<span id="recipes-creating-a-state-method-from-a-factory"></span><h3>Creating a Statechart From a Factory<a class="headerlink" href="#creating-a-statechart-from-a-factory" title="Permalink to this headline">¶</a></h3>
<p>To have the library create your state methods for you:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="#recipes-factory-1"><span class="std std-ref">Import the correct items from the miros library</span></a></li>
<li><a class="reference internal" href="#recipes-factory-2"><span class="std std-ref">Create the statechart’s event callback methods</span></a></li>
<li><a class="reference internal" href="#recipes-factory-3"><span class="std std-ref">Create a factory object</span></a></li>
<li><a class="reference internal" href="#recipes-factory-4"><span class="std std-ref">Build up your statemethods using the factory object</span></a></li>
<li><a class="reference internal" href="#recipes-factory-5"><span class="std std-ref">Add the hierarchy information to your factory object</span></a></li>
<li><a class="reference internal" href="#recipes-factory-6"><span class="std std-ref">Start your statechart in the desired state</span></a></li>
<li><a class="reference internal" href="#recipes-factory-7"><span class="std std-ref">Debugging a state method made from a factory</span></a></li>
</ol>
<div align="center" class="align-center"><img alt="_images/factory5.svg" src="_images/factory5.svg" /></div>
<p id="recipes-factory-1">Import the correct items from the miros library:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros.activeobject</span> <span class="kn">import</span> <span class="n">Factory</span>
<span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">signals</span><span class="p">,</span> <span class="n">Event</span><span class="p">,</span> <span class="n">return_status</span>
</pre></div>
</div>
<p id="recipes-factory-2">Create the statechart’s event callback methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># the statechart&#39;s event callback methods</span>
<span class="k">def</span> <span class="nf">trans_to_fc</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">trans_to_fc1</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">fc1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">trans_to_fc2</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">fc2</span><span class="p">)</span>
</pre></div>
</div>
<p id="recipes-factory-3">Create your statechart using the <code class="docutils literal"><span class="pre">Factory</span></code> class.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Factory is a type of ActiveObject, so it will have it&#39;s methods</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">Factory</span><span class="p">(</span><span class="s1">&#39;factory_class_example&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p id="recipes-factory-4">Create the state methods and describe how you want to react to different
signals.  Then turn it it into a method.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">fc</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s1">&#39;fc&#39;</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">handler</span><span class="o">=</span><span class="n">trans_to_fc</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">,</span> <span class="n">handler</span><span class="o">=</span><span class="n">trans_to_fc1</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">to_method</span><span class="p">()</span>

<span class="n">fc1</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s1">&#39;fc1&#39;</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">handler</span><span class="o">=</span><span class="n">trans_to_fc2</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">to_method</span><span class="p">()</span>

<span class="n">fc2</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s1">&#39;fc2&#39;</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">handler</span><span class="o">=</span><span class="n">trans_to_fc1</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">to_method</span><span class="p">()</span>
</pre></div>
</div>
<p id="recipes-factory-5">Add the hierarchy information to your state methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">chart</span><span class="o">.</span><span class="n">nest</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span>  <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">nest</span><span class="p">(</span><span class="n">fc1</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">fc</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">nest</span><span class="p">(</span><span class="n">fc2</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">fc</span><span class="p">)</span>
</pre></div>
</div>
<p id="recipes-factory-6">Start your statechart in the desired state.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">chart</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#recipes-state-recipes"><span class="std std-ref">Then all of you usual state recipes apply</span></a>.</p>
<p id="recipes-factory-7">If you need to debug or unwind your factor generated state methods, reference
<a class="reference internal" href="#recipes-flatting-a-state-method"><span class="std std-ref">this</span></a>.</p>
</div>
</div>
<div class="section" id="events-and-signals">
<span id="recipes-events-and-signals"></span><h2>Events And Signals<a class="headerlink" href="#events-and-signals" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-an-event">
<span id="recipes-creating-an-event"></span><h3>Creating an Event<a class="headerlink" href="#creating-an-event" title="Permalink to this headline">¶</a></h3>
<p>An event is something that will be passed into your statechart, it will be
reacted to, then removed from memory.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">Event</span>
<span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">signals</span>

<span class="n">event_1</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="s2">&quot;name_of_signal&quot;</span><span class="p">)</span>
<span class="c1"># or</span>
<span class="n">event_2</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">name_of_signal</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-signal">
<span id="recipes-creating-a-signal"></span><h3>Creating a Signal<a class="headerlink" href="#creating-a-signal" title="Permalink to this headline">¶</a></h3>
<p>A signal is the name of an event.  Many different events can have the same
name, or signal.  When a signal is created, it is given a number which is one
higher than the oldest signal that was within your program.  You shouldn’t have
to worry about what a signal number is, they are only used to speed up the
event processor. (it is faster to compare two numbers than two strings)</p>
<p>When you create a signal it will not be removed from memory until your program
finishes.  They are created at the moment they are referenced, so you don’t
have to explicitly define them.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">Event</span>
<span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">signals</span>

<span class="c1"># signal named &quot;name_of_signaL&quot; invented</span>
<span class="c1"># here and given a unique number</span>
<span class="hll"><span class="n">event_1</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="s2">&quot;name_of_signal&quot;</span><span class="p">)</span>
</span><span class="c1"># the signal number of this event will have</span>
<span class="c1"># the same number as in line 6</span>
<span class="n">event_2</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">name_of_signal</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that the signal was invented on line <strong>6</strong> then re-used on line <strong>9</strong>.</p>
<p>The signals are shared across your whole program.  To see reflect upon your
signals read <a class="reference internal" href="#recipes-seeing-your-signals"><span class="std std-ref">this</span></a>.</p>
</div>
<div class="section" id="posting-events">
<span id="id2"></span><h3>Posting Events<a class="headerlink" href="#posting-events" title="Permalink to this headline">¶</a></h3>
<p>The Active Object <code class="docutils literal"><span class="pre">post_fifo</span></code>, <code class="docutils literal"><span class="pre">post_lifo</span></code>, <code class="docutils literal"><span class="pre">defer</span></code> and <code class="docutils literal"><span class="pre">recall</span></code>
methods are use to feed events to the statechart.  An Event can be thought of
as a kind of named marble that is placed onto a topological map.  If a
particular elevation doesn’t know what to do with the marble, it rolls the
marble to the next lower elevation, or state.  If the lowest elevation is
reached and the program doesn’t know what to do, it just ignores the event, or
lets the marble fall out of play.</p>
<p>The name of the marble is the signal name. An event can have a payload, but it
doesn’t have to.  An event can only be posted to a chart after the chart has
started.  Otherwise the behavior of the active object is undefined.</p>
<p>The state methods typically react to the names of a event, or the signal names.
This means that the if-else structures that you write will use the signal names
in their logic.</p>
<p>If you use the chart’s post event methods within the chart, the chart will not
concern itself with <em>where</em> you initiated that event.  It will post its events
into its queue as if they were provided by the outside world.  In this way
these events are called <em>artificial</em>; instead of the world creating the event,
the chart does.  There are a number of situations where it makes sense to do
this, they will be described in the patterns section.</p>
</div>
<div class="section" id="posting-an-event-to-the-fifo">
<span id="recipes-posting-an-event-to-the-fifo"></span><h3>Posting an Event to the Fifo<a class="headerlink" href="#posting-an-event-to-the-fifo" title="Permalink to this headline">¶</a></h3>
<p>To post an event to the active object first-in-first-out (fifo) buffer, you
must have first started your statechart.  Here is a simple example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ao</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>
<span class="c1"># start at &#39;outer&#39; for the sake of our example</span>
<span class="n">ao</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">outer</span><span class="p">)</span>

<span class="c1"># Send an event with the signal name &#39;mary&#39;</span>
<span class="n">ao</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">mary</span><span class="p">))</span>
</pre></div>
</div>
<p>The signal names used by the events are common across the entire system.  You
do not need to declare them.  If the system had not seen the <code class="docutils literal"><span class="pre">signals.mary</span></code>
signal code before in our above example, this name would be added and assigned
a unique number automatically.</p>
</div>
<div class="section" id="posting-an-event-to-the-lifo">
<span id="recipes-posting-an-event-to-the-lifo"></span><h3>Posting an Event to the LIFO<a class="headerlink" href="#posting-an-event-to-the-lifo" title="Permalink to this headline">¶</a></h3>
<p>To post an event to the active object last-in-first-out (lifo) buffer, you
must have first started your statechart.  Here is a simple example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ao</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>
<span class="c1"># start at &#39;outer&#39; for the sake of our example</span>
<span class="n">ao</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">outer</span><span class="p">)</span>

<span class="c1"># Now say we want to send an event with</span>
<span class="c1"># th the signal name of &#39;mary&#39; to the chart</span>
<span class="n">ao</span><span class="o">.</span><span class="n">post_lifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">mary</span><span class="p">))</span>
</pre></div>
</div>
<p>You would post to the ‘lifo’ buffer if you needed your event to be moved to the
front of the active object’s collection of unprocessed events.  You might want
to do this with a timing heart beat or for any event that needs to be processed
with a greater priority than other events.</p>
</div>
<div class="section" id="creating-a-one-shot-event">
<span id="recipes-creating-a-one-shot-event"></span><h3>Creating a One-Shot Event<a class="headerlink" href="#creating-a-one-shot-event" title="Permalink to this headline">¶</a></h3>
<p>A one-shot event can be used to add some delay between state transitions.  You
can think of them as delayed <strong>init</strong> signals.  You might want to use a one-shot if
you need a system to settle down a bit before transitioning into an inner
state.</p>
<p>Generally speaking, you should cancel your one-shot events as your chart passes
control to outer states.  You don’t need to do this, but if you don’t your
outer states will be hit with one-shot messages that they don’t care about
and your chart will needlessly search as it reacts to these events.</p>
<p>It is important to know that if your chart changes state, the event posted to
it will look like it came from outside of your statechart, even though it was
originally generated within a given state.  The construction of any event with
the <code class="docutils literal"><span class="pre">fifo</span></code> or <code class="docutils literal"><span class="pre">lifo</span></code> api behaves like this.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Here define a middle state the creates a one-shot event called</span>
<span class="c1"># delayed_one_second.  The same delayed_one_second signal is captured</span>
<span class="c1"># by the middle state and used to transition into the inner state</span>
<span class="nd">@spy_on</span>
<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">ao</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">UNHANDLED</span>

  <span class="c1"># we have entered the state and we would like to delay one</span>
  <span class="c1"># second prior to entering the inner state</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
      <span class="n">ao</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span>
        <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">delay_one_second</span><span class="p">),</span>
        <span class="n">times</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">deferred</span><span class="o">=</span><span class="bp">True</span>
      <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="c1"># we are leaving this state for an outer state</span>
    <span class="c1"># so we cancel our one-shot in case it hasn&#39;t gone off yet</span>
    <span class="n">ao</span><span class="o">.</span><span class="n">cancel_events</span><span class="p">(</span><span class="n">ao</span><span class="o">.</span><span class="n">delay_one_second</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="c1"># ignore our init</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="c1"># our one-shot has fired, one second has passed since</span>
  <span class="c1"># we transitioned into this state, now transition</span>
  <span class="c1"># to our desired target; &#39;inner&#39;</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">delay_one_second</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">ao</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>

  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">ao</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">SUPER</span><span class="p">,</span> <span class="n">outer</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-multishot-event">
<span id="recipes-creating-a-multishot-event"></span><h3>Creating a Multishot Event<a class="headerlink" href="#creating-a-multishot-event" title="Permalink to this headline">¶</a></h3>
<p>A multi-shot event is just an extension of the one-shot idea.  Instead of only
being fired once on entry, it can be fired between 2 and an infinite number of
times.  You would use a multi-shot event if you would like to provide an inner
part of your chart with a heart beat that the outer part of your chart doesn’t
need to know about.  In this way you could save cycles by avoiding unnecessary
event processing in the parts of the chart that don’t need these heart beats.
This will also be useful while debugging your chart, your logs won’t be filled
with unnecessary events.</p>
<p>You should cancel your multi-shot events in the exit handler of the state that
created them.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Here define a middle state the creates a multi-shot event called</span>
<span class="c1"># three_pulse.  The same three_pulse signal is captured</span>
<span class="c1"># by the middle state and used to transition into the inner state</span>
<span class="nd">@spy_on</span>
<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">ao</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">multi_shot_thread</span> <span class="o">=</span> \
      <span class="n">ao</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">),</span>
                      <span class="n">times</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                      <span class="n">period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                      <span class="n">deferred</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1"># We mark up the ao with this id, so that</span>
    <span class="c1"># state function can be used by many different aos</span>
    <span class="n">ao</span><span class="o">.</span><span class="n">augment</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">multi_shot_thread</span><span class="p">,</span>
                  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;multi_shot_thread&#39;</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">ao</span><span class="o">.</span><span class="n">cancel_event</span><span class="p">(</span><span class="n">ao</span><span class="o">.</span><span class="n">multi_shot_thread</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">ao</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">ao</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">SUPER</span><span class="p">,</span> <span class="n">outer</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>By setting the <code class="docutils literal"><span class="pre">times</span></code> argument of the <code class="docutils literal"><span class="pre">post_fifo</span></code> to 0, you can create an
infinite multi-shot event.  This is how you could make an inner heart beat.</p>
<p>The <code class="docutils literal"><span class="pre">post_lifo</span></code> api can be used the same as the <code class="docutils literal"><span class="pre">post_fifo</span></code> api for
creating these types of repeating events.  You would use the <code class="docutils literal"><span class="pre">post_lifo</span></code> api
when you would need your heart beat event signal to barge ahead of all other
events waiting to be processed by the active object.</p>
</div>
<div class="section" id="cancelling-a-specific-event-source">
<span id="id3"></span><h3>Cancelling a Specific Event Source<a class="headerlink" href="#cancelling-a-specific-event-source" title="Permalink to this headline">¶</a></h3>
<p>The requests to the <code class="docutils literal"><span class="pre">post_fifo</span></code> and <code class="docutils literal"><span class="pre">post_lifo</span></code> methods, where <code class="docutils literal"><span class="pre">times</span></code> are
specified, can be thought of as event sources.  This is because they create
background threads which track time and periodically post events to the active
object.</p>
<p>There are two different ways to cancel event sources.  You can cancel a
specific event source, or you can cancel all event sources that create a
specific signal name (easier).  Read the
<a class="reference internal" href="#recipes-cancelling-event-source-by-signal-name"><span class="std std-ref">Cancelling Event Source By Signal Name</span></a> recipe to see how to do
this.</p>
<p>To cancel a specific signal source, you need to track the thread id which was
created when it was made, then use that id to cancel the event.  Since a state
method can be used by many different active objects, you don’t want to store
this id on the method itself, or in its variable name space.  Instead, you can
markup the name of the chart that is using the method, this <code class="docutils literal"><span class="pre">chart</span></code> object is
passed to the state method as the first argument.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Here define a middle state the creates a multi-shot event called</span>
<span class="c1"># three_pulse.  The same three_pulse signal is captured</span>
<span class="c1"># by the middle state and used to transition into the inner state</span>
<span class="c1">#</span>
<span class="c1"># We want to cancel this specific event source when we are exiting this</span>
<span class="c1"># state</span>
<span class="nd">@spy_on</span>
<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">multi_shot_thread</span> <span class="o">=</span> \
      <span class="n">chart</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">),</span>
                      <span class="n">times</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                      <span class="n">period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                      <span class="n">deferred</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1"># We graffiti the provided chart object with this id</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">augment</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">multi_shot_thread</span><span class="p">,</span>
                  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;multi_shot_thread&#39;</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">cancel_event</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">multi_shot_thread</span><span class="p">)</span>

    <span class="c1"># remove our graffiti</span>
    <span class="k">del</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">multi_shot_thread</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">chart</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">SUPER</span><span class="p">,</span> <span class="n">outer</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">augment</span></code> api is used to graffiti our chart upon entering the state.
We write the event-source id onto the <code class="docutils literal"><span class="pre">multi_shot_thread</span></code> chart attribute,
so that we can use it later.  By marking this specific <code class="docutils literal"><span class="pre">chart</span></code> object, the
middle state method handler can be shared by other active objects.</p>
<p>You would use this method of canceling an event source if you need the
three_pulse signal name elsewhere in your statechart.  If you do not intend on
re-using this signal name you can just cancel event sources using a much
simpler api: the <code class="docutils literal"><span class="pre">cancel_event</span></code>.</p>
</div>
<div class="section" id="cancelling-event-source-by-signal-name">
<span id="recipes-cancelling-event-source-by-signal-name"></span><h3>Cancelling Event Source By Signal Name<a class="headerlink" href="#cancelling-event-source-by-signal-name" title="Permalink to this headline">¶</a></h3>
<p>If you would like to re-use your event source signal names through your chart,
then you can use the <span class="xref std std-ref">recipes-cancelling-a-specific-event-source</span> recipe
to cancel a specific source and leave your other event sources running.
Otherwise, you can use the simpler <code class="docutils literal"><span class="pre">cancel_sources</span></code> api provided by the
Active Object:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Here we define a middle state the creates a multi-shot event called</span>
<span class="c1"># three_pulse.  The same three_pulse signal is captured</span>
<span class="c1"># by the middle state and used to transition into the inner state</span>
<span class="c1">#</span>
<span class="c1"># We want to cancel this specific event source when we are exiting this</span>
<span class="c1"># state</span>
<span class="nd">@spy_on</span>
<span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">),</span>
                    <span class="n">times</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                    <span class="n">period</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="n">deferred</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="c1"># cancel all event sources with the signal named three_pulses</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">cancel_events</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">))</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">three_pulse</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">chart</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">SUPER</span><span class="p">,</span> <span class="n">outer</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>There is no need to keep a thread id for the event source, since the Active
Object can just look at all of the event source threads and kill any of them
that have this signal name provided to the <code class="docutils literal"><span class="pre">cancel_events</span></code> call.</p>
</div>
<div class="section" id="recipes-deferring-an-event">
<span id="id4"></span><h3>Deferring and Recalling an Event<a class="headerlink" href="#recipes-deferring-an-event" title="Permalink to this headline">¶</a></h3>
<p>There will be situations where you want to post a kind of artificial event into
a queue which won’t immediately be acted upon by your startchart.  It is an
<cite>artificial</cite> event, because your chart is making it up, it isn’t being given to
it by the outside world.  It is a way for your chart to build up a kind of
processing pressure that can be relieved when you have the cycles to work on
things.</p>
<p>This is a two stage process, one, deferring the event, and two, recalling the
event.  It is called a deferment of an event because we are holding off our
reaction to it.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># code to place in the state that is deferring the event:</span>
<span class="n">chart</span><span class="o">.</span><span class="n">defer</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">signal_that_is_deferred</span><span class="p">)</span>

<span class="c1"># code to place in the state where you would like the event reposted into</span>
<span class="c1"># the chart&#39;s first in first out queue</span>
<span class="n">chart</span><span class="o">.</span><span class="n">recall</span><span class="p">()</span> <span class="c1"># posts our deferred event to the chart.</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-a-payload-to-an-event">
<span id="recipes-adding-a-payload-to-an-event"></span><h3>Adding a Payload to an Event<a class="headerlink" href="#adding-a-payload-to-an-event" title="Permalink to this headline">¶</a></h3>
<p>To add a payload to your event:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">YOUR_SIGNAL_NAME</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="s2">&quot;My Payload&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="determining-if-an-event-has-a-payload">
<span id="recipes-determining-if-an-event-has-a-payload"></span><h3>Determining if an Event Has a Payload<a class="headerlink" href="#determining-if-an-event-has-a-payload" title="Permalink to this headline">¶</a></h3>
<p>To determine if an event has a payload:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">e1</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">YOUR_SIGNAL_NAME</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="s2">&quot;My Payload&quot;</span><span class="p">)</span>
<span class="n">e2</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">YOUR_SIGNAL_NAME</span><span class="p">)</span>

<span class="k">assert</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">has_payload</span><span class="p">()</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="n">e2</span><span class="o">.</span><span class="n">has_payload</span><span class="p">()</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="multiple-statecharts">
<span id="recipes-multiple-statecharts"></span><span id="seeing-what-is-going-on"></span><h2>Multiple Statecharts<a class="headerlink" href="#multiple-statecharts" title="Permalink to this headline">¶</a></h2>
<p>Break your design down into different interacting charts by using the
ActiveFabric.</p>
<p>The active fabric is a set of background tasks which act together to dispatch
events between the active objects in your system.</p>
<p>As a user of the software you wouldn’t touch the active fabric directly, but
instead would use your active object’s <code class="docutils literal"><span class="pre">publish</span></code> and <code class="docutils literal"><span class="pre">subscribe</span></code> methods.  The
active fabric has two different priority queues and two different tasks which
pend upon them.  One is for managing subscriptions in a first in first (fifo)
out manner, the other is for managing messages in a last in first out (lifo)
manner.  By having two different queues and two different tasks an active
object is given the option to subscribe to another active object’s published
events, using one of two different strategies:</p>
<ol class="arabic simple">
<li>If it subscribes to an event using the <code class="docutils literal"><span class="pre">fifo</span></code> strategy, the active fabric
will post events to it using its <a class="reference internal" href="#recipes-posting-an-event-to-the-fifo"><span class="std std-ref">post_fifo</span></a> method.</li>
<li>If it subscribes in a <code class="docutils literal"><span class="pre">lifo</span></code> way it will post using the <a class="reference internal" href="#recipes-posting-an-event-to-the-lifo"><span class="std std-ref">post_lifo</span></a> method.</li>
</ol>
<p>You can also set the priority of the event while it is in transit within the
active fabric.  This would only be useful if you are expecting contension
between various events being dispatched across your system.</p>
<div class="section" id="subscribing-to-an-event-posted-by-another-active-object">
<span id="recipes-subscribing-to-an-event-posted-by-another-active-object"></span><h3>Subscribing to an Event Posted by Another Active Object<a class="headerlink" href="#subscribing-to-an-event-posted-by-another-active-object" title="Permalink to this headline">¶</a></h3>
<p>Your active object can subscribe to the events published by other active objects.</p>
<p>An active object can set how the active fabric posts events to it.  If it would
like a message to take priority over all other events waiting to be managed,
you would use the <code class="docutils literal"><span class="pre">lifo</span></code> technique:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">subscribing_ao</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>
<span class="n">subscribing_ao</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">signals</span><span class="o">.</span><span class="n">THING_SUBSCRIBING_AO_CARES_ABOUT</span><span class="p">,</span>
  <span class="n">queue_type</span><span class="o">=</span><span class="s1">&#39;lifo&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This approach would make sense if you were subscribed to a timed heart beat
being sent out by another active object, or if this event was some sort of
safety related thing.</p>
<p>In most situations you can use the subscription defaults:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">subscribing_ao</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>
<span class="n">subscribing_ao</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">signals</span><span class="o">.</span><span class="n">THING_SUBSCRIBING_AO_CARES_ABOUT</span><span class="p">)</span>
<span class="c1"># which is the same as writing</span>
<span class="n">subscribing_ao</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span>
  <span class="n">signals</span><span class="o">.</span><span class="n">THING_SUBSCRIBING_AO_CARES_ABOUT</span><span class="p">,</span> <span class="n">queue_type</span><span class="o">=</span><span class="s1">&#39;fifo&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It seems a little bit strange to subscribe to an event, since an event is a
specific thing in which belongs a general thing; the signal.  But the <code class="docutils literal"><span class="pre">subscribe</span></code>
method supports subscribing to events so that it’s method signature looks like
the other method signatures in the library.  (Less things for you to remember)</p>
<p>If you chose to subscribe to events and not directly to signals, think of your
call as saying, “I would like to subscribe to this type of event”.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># subscribing to a `type` of event</span>
<span class="n">subscribing_ao</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span>
  <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">THING_SUBSCRIBING_AO_CARES_ABOUT</span><span class="p">),</span>
  <span class="n">queue_type</span><span class="o">=</span><span class="s1">&#39;fifo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="publishing-events-to-other-active-objects">
<span id="recipes-publishing-event-to-other-active-objects"></span><h3>Publishing events to other Active Objects<a class="headerlink" href="#publishing-events-to-other-active-objects" title="Permalink to this headline">¶</a></h3>
<p>Your active object can communicate to other active objects in the system by
publishing events.  There are two different threads in the active fabric
object that manage this communication and they each have a priority queue.  A
priority queue lets you post items into a queue with different priorities.  If
one posted thing is higher than another, it will be pushed closer to the front of
the queue.  The <code class="docutils literal"><span class="pre">publish</span></code> method has access to the same prioritization.  If
you call it with a priority number it will pass this number in with the message
that it is transmitting out to all of its subscribers.  The task will
automatically arrange this message relative to all of the other
events that are waiting in the queue.</p>
<p>For an active object to publish an event to another active object (which has
subscribed to the event):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">publishing_ao</span> <span class="o">=</span> <span class="n">ActiveObect</span><span class="p">()</span>
<span class="n">publishing_ao</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">THING_SUBSCRIBING_AO_CARES_ABOUT</span><span class="p">)</span>

<span class="c1"># or you can set the priority (1 is the highest priority see note):</span>
<span class="n">publishing_ao</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
  <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">THING_SUBSCRIBING_AO_CARES_ABOUT</span>
  <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">NOTE:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<p>The highest event priority corresponds to the number 1 and all higher numbers
have lower priority.  If a number is higher than another it will have lower
priority than the number it is greater than.  By default all published events
are given a priority of 1000.  If two events have the same priority the queue
will behave like a first in first out queue.</p>
</div>
</div>
<div class="section" id="recipes-seeing-what-is">
<span id="id5"></span><h2>Seeing What is Going On<a class="headerlink" href="#recipes-seeing-what-is" title="Permalink to this headline">¶</a></h2>
<div class="section" id="determining-the-current-state">
<span id="recipes-determining-the-current-state"></span><h3>Determining the Current State<a class="headerlink" href="#determining-the-current-state" title="Permalink to this headline">¶</a></h3>
<p>To see what state your chart is in:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="hll">  <span class="n">chart</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">fun</span>           <span class="c1"># will be the state method</span>
</span><span class="hll">  <span class="n">chart</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">fun</span><span class="o">.</span><span class="vm">__name__</span>  <span class="c1"># will be the state method name</span>
</span></pre></div>
</div>
</div>
<div class="section" id="seeing-what-signals-you-have-in-your-system">
<span id="recipes-seeing-what-signals-you-have-in-your-system"></span><h3>Seeing what Signals You Have In Your System<a class="headerlink" href="#seeing-what-signals-you-have-in-your-system" title="Permalink to this headline">¶</a></h3>
<span class="target" id="recipes-seeing-your-signals"></span><p>A signal is the name that can be given to an event.  To get access to your
signals:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">signals</span>
</pre></div>
</div>
<p>The signals object is provided by a singleton of the SignalSource class, which
is just an OrderedDictionary with a <code class="docutils literal"><span class="pre">__getattr__</span></code> method to make the syntax
easier to use.</p>
<p><cite>This basically means that you can think of the signals object as being a dict
that is shared across your whole program.</cite></p>
<p>To see your signals, you just reflect upon it like you would with any other
Python dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># To see your signal names:</span>
<span class="n">signal_names</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="c1"># To see your signal numbers:</span>
<span class="n">signal_numbers</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

<span class="c1"># To output your names and number:</span>
<span class="k">for</span> <span class="n">signal_name</span><span class="p">,</span> <span class="n">signal_number</span> <span class="ow">in</span> <span class="n">signals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
  <span class="k">print</span><span class="p">(</span><span class="n">signal_name</span><span class="p">,</span> <span class="n">signal_number</span><span class="p">)</span>

<span class="c1"># same output with some formatting</span>
<span class="n">max_name_len</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
<span class="n">max_number_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">signals</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">signal_name</span><span class="p">,</span> <span class="n">signal_number</span> <span class="ow">in</span> <span class="n">signals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{1: &lt;{0}} {2:{3}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_name_len</span><span class="p">,</span>
                                   <span class="n">signal_name</span><span class="p">,</span>
                                   <span class="n">signal_number</span><span class="p">,</span>
                                   <span class="n">max_number_len</span><span class="p">))</span>  <span class="c1"># output below -&gt;</span>
  <span class="c1"># ENTRY_SIGNAL            1</span>
  <span class="c1"># EXIT_SIGNAL             2</span>
  <span class="c1"># INIT_SIGNAL             3</span>
  <span class="c1"># REFLECTION_SIGNAL       4</span>
  <span class="c1"># SEARCH_FOR_SUPER_SIGNAL 5</span>
  <span class="c1"># ..</span>
</pre></div>
</div>
<p>To compare a received event against a signal, compare the signal numbers:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">some_example_state</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANLDED</span>
<span class="hll">  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
</span>    <span class="c1"># do something</span>
</pre></div>
</div>
<p>It you wanted to read an event’s signals name as a string, you would call the
<code class="docutils literal"><span class="pre">signal_name</span></code> method of the Event class:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">some_example_state</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANLDED</span>
<span class="hll">  <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal_name</span><span class="p">)</span> <span class="c1"># &quot;ENTRY_SIGNAL&quot;</span>
</span></pre></div>
</div>
<p>If you have a signal number and you want to determine it’s name:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">signal_name</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">name_for_signal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># ENTRY_SIGNAL</span>
<span class="n">signal_name</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">name_for_signal</span><span class="p">(</span><span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">)</span> <span class="c1"># ENTRY_SIGNAL</span>
</pre></div>
</div>
</div>
<div class="section" id="using-the-trace">
<span id="recipes-using-the-trace"></span><h3>Using the Trace<a class="headerlink" href="#using-the-trace" title="Permalink to this headline">¶</a></h3>
<p>If you would like to see what your active object was doing from a <strong>very high
level</strong>, you can look at it’s <cite>trace</cite> instrumentation.  The trace will only
create a log item if a state transition has occurred. Each line in the <cite>trace</cite>
will contain:</p>
<ol class="arabic simple">
<li>A datetime stamp between square brackets</li>
<li>The active object name, between square brackets</li>
<li>The event that caused the transition, its signal number and its payload</li>
<li>The starting state</li>
<li>The ending state</li>
</ol>
<p>If you haven’t named your active object, a unique identifier is given to it,
and the first 5 characters of this unique identifier will be used in the trace.
The reason that an identifier is given to it is so that the trace outputs, from
multiple active objects, can be distinguished from one another.</p>
<p>Suppose you have built the tazor active object described in the <a class="reference internal" href="postingexample.html#examples-tazor-example"><span class="std std-ref">second
example</span></a>. Suppose you named this active object <cite>tazor</cite>:
To see the trace you would type:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">tazor</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span>
</pre></div>
</div>
<p>This would output the following trace:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="hll"><span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">28.268873</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">start_at</span><span class="p">()</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">arming</span>
</span><span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">arming</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
</pre></div>
</div>
<p>Notice that on line one, the signal is called <cite>start_at</cite>.  There is no signal
called <cite>start_at</cite>, here the trace is actually using the method name <cite>start_at</cite>
to indicate how the chart was started.</p>
<p>A trace can be used with the <cite>sequence</cite> project to generate a sequence diagram,
more about that is described <span class="xref std std-ref">here.</span></p>
</div>
<div class="section" id="using-the-spy">
<span id="recipes-using-the-spy"></span><span id="reflection-an-extremely-detailed-view"></span><h3>Using the Spy<a class="headerlink" href="#using-the-spy" title="Permalink to this headline">¶</a></h3>
<p>If you need a <strong>very detailed description</strong> of your system’s behavior you will want
to use the <cite>spy</cite> instrumentation.  The spy outputs:</p>
<ol class="arabic simple">
<li>All of the internal activity that is run by the event processor</li>
<li>How your chart reacts to the events it has received</li>
<li>Information about what happened between each of the rtc activities.</li>
<li>If a signal was hooked by a state</li>
<li>If and when a signal was <a class="reference internal" href="#recipes-deferring-an-event"><span class="std std-ref">deferred</span></a></li>
<li>If and when a signal was <a class="reference internal" href="#recipes-deferring-an-event"><span class="std std-ref">recalled</span></a></li>
<li>The number of events awaiting immediate processing after a specific rtc activity.</li>
<li>The number of events which have had their processing deferred.</li>
</ol>
<p>If you don’t understand what these terms mean, read the
<a class="reference internal" href="postingexample.html#examples-simple-posting-example"><span class="std std-ref">simple posting example</span></a>, since it
introduces all of these ideas.</p>
<p>To access the full spy:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># import a pretty printer (like print)</span>
<span class="kn">from</span> <span class="nn">miros</span> <span class="kn">import</span> <span class="n">pp</span>

<span class="c1"># .. state charts and other code here</span>

<span class="c1"># Assuming your active object is called `ao`</span>
<span class="c1"># we use the pretty printer to write the</span>
<span class="c1"># full spy log to the terminal</span>
<span class="n">pp</span><span class="p">(</span><span class="n">ao</span><span class="o">.</span><span class="n">spy</span><span class="p">())</span>
</pre></div>
</div>
<p>This might output:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="hll"><span class="p">[</span><span class="s1">&#39;START&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:middle&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(0) Deferred:(0)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;A:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;POST_DEFERRED:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:inner&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(0) Deferred:(1)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;A:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;A:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;POST_DEFERRED:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:inner&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(0) Deferred:(2)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;A:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;A:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;POST_DEFERRED:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:inner&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(0) Deferred:(3)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;D:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;POST_FIFO:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;D:outer:HOOK&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(1) Deferred:(2)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;B:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;B:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;B:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:inner&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:middle&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;POST_FIFO:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;RECALL:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:outer&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(1) Deferred:(1)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;B:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;POST_FIFO:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;RECALL:B&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:outer&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(1) Deferred:(0)&#39;</span><span class="p">,</span>
</span> <span class="s1">&#39;B:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;EXIT_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ENTRY_SIGNAL:outer&#39;</span><span class="p">,</span>
 <span class="s1">&#39;INIT_SIGNAL:outer&#39;</span><span class="p">,</span>
<span class="hll"> <span class="s1">&#39;&lt;- Queued:(0) Deferred:(0)&#39;</span><span class="p">]</span>
</span></pre></div>
</div>
<p>If you would like to understand in detail how to read this log, and how it
might have occurred, reference <a class="reference internal" href="postingexample.html#examples-simple-posting-example"><span class="std std-ref">the example from which it
came</span></a>.</p>
<p>The spy log is a ring buffer that contains 500 spots.  This is so your system
can run forever without using an infinite amount of memory.  Once the internal
spy log has run out of room, it will shift out the old data and write the new
data at the tail end of its log.</p>
</div>
<div class="section" id="add-timing-information-to-the-spy">
<span id="recipes-add-timing-information-to-the-spy"></span><span id="recipes-tracing-live"></span><h3>Add Timing Information to the Spy<a class="headerlink" href="#add-timing-information-to-the-spy" title="Permalink to this headline">¶</a></h3>
<p>The spy doesn’t contain timing information, if you would like to mark it up
with time so that you can compare it with the trace output:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="c1"># .</span>
<span class="c1"># .</span>
<span class="c1"># In your state method or callback code write:</span>
<span class="n">chart</span><span class="o">.</span><span class="n">scribble</span><span class="p">(</span><span class="s2">&quot;{} at {}&quot;</span><span class="o">.</span> \
    <span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal_name</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%M:%S:</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="section" id="tracing-live">
<h3>Tracing Live<a class="headerlink" href="#tracing-live" title="Permalink to this headline">¶</a></h3>
<p>There are situations where you would like to see what an active object is doing
while it is running.  Each active object has an attribute called
<code class="docutils literal"><span class="pre">live_trace</span></code>.  By setting this attribute to <code class="docutils literal"><span class="pre">True</span></code> the active object will
output it’s trace information to the terminal while it reacts to events:</p>
<p>To turn on/off the live trace:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ao1</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>
<span class="c1"># turn on the live trace</span>
<span class="hll"><span class="n">ao1</span><span class="o">.</span><span class="n">live_trace</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class="c1"># your code and state interactions here</span>
<span class="c1"># live trace information will be displayed on the terminal</span>

<span class="c1"># turn off the live trace</span>
<span class="hll"><span class="n">ao1</span><span class="o">.</span><span class="n">live_trace</span> <span class="o">=</span> <span class="bp">False</span>
</span></pre></div>
</div>
</div>
<div class="section" id="spying-live">
<span id="recipes-spying-live"></span><h3>Spying Live<a class="headerlink" href="#spying-live" title="Permalink to this headline">¶</a></h3>
<p>There are situations where you would like to see what an active object is doing
while it is running.  Each active object has an attribute called
<code class="docutils literal"><span class="pre">live_spy</span></code>.  By setting this attribute to <code class="docutils literal"><span class="pre">True</span></code> the active object will
output it’s spy information to the terminal while it reacts to events:</p>
<p>To turn on/off the live spy:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">ao1</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>
<span class="c1"># turn on the live spy</span>
<span class="hll"><span class="n">ao1</span><span class="o">.</span><span class="n">live_spy</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class="c1"># your code and state interactions here</span>
<span class="c1"># live spy information will be displayed on the terminal</span>

<span class="c1"># turn off the live spy</span>
<span class="hll"><span class="n">ao1</span><span class="o">.</span><span class="n">live_spy</span> <span class="o">=</span> <span class="bp">False</span>
</span></pre></div>
</div>
</div>
<div class="section" id="scribble-on-the-spy">
<span id="recipes-scribble-on-the-spy"></span><h3>Scribble On the Spy<a class="headerlink" href="#scribble-on-the-spy" title="Permalink to this headline">¶</a></h3>
<p>To add messaging to your spy log so that you can see how an activity is
situated within the statechart’s behavior, use the <code class="docutils literal"><span class="pre">scribble</span></code> api within your
state method:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@spy_on</span>
<span class="k">def</span> <span class="nf">s2_state</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">c</span><span class="p">(</span><span class="n">chart</span><span class="p">):</span>
<span class="hll">    <span class="n">chart</span><span class="o">.</span><span class="n">scribble</span><span class="p">(</span><span class="s2">&quot;running c()&quot;</span><span class="p">)</span>
</span>
  <span class="k">def</span> <span class="nf">d</span><span class="p">(</span><span class="n">chart</span><span class="p">):</span>
<span class="hll">    <span class="n">chart</span><span class="o">.</span><span class="n">scribble</span><span class="p">(</span><span class="s2">&quot;running d()&quot;</span><span class="p">)</span>
</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">c</span><span class="p">(</span><span class="n">chart</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">d</span><span class="p">(</span><span class="n">chart</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">s21_state</span><span class="p">)</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">chart</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span><span class="p">,</span> <span class="n">s_state</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
</div>
<div class="section" id="flatting-a-state-method">
<span id="recipes-flatting-a-state-method"></span><h3>Flatting a State Method<a class="headerlink" href="#flatting-a-state-method" title="Permalink to this headline">¶</a></h3>
<p>If you have created a state method using either a <code class="docutils literal"><span class="pre">template</span></code> or a <code class="docutils literal"><span class="pre">Factory</span></code>
and you would like to see it’s code as if it where written by hand, use the
<code class="docutils literal"><span class="pre">to_code</span></code> call.</p>
<p>Let’s first look how to flatten a template state method:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros.hsm</span> <span class="kn">import</span> <span class="n">state_method_template</span>
<span class="kn">from</span> <span class="nn">miros.activeobject</span> <span class="kn">import</span> <span class="n">ActiveObject</span>
<span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">signals</span><span class="p">,</span> <span class="n">Event</span><span class="p">,</span> <span class="n">return_status</span>

<span class="k">def</span> <span class="nf">trans_to_fc1</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">fc1</span><span class="p">)</span>

<span class="c1"># create a state method using a template</span>
<span class="n">fc</span> <span class="o">=</span> <span class="n">state_method_template</span><span class="p">(</span><span class="s1">&#39;fc&#39;</span><span class="p">)</span>

<span class="c1"># build an active object, which has an event processor</span>
<span class="n">ao</span> <span class="o">=</span> <span class="n">ActiveObject</span><span class="p">()</span>

<span class="c1"># write the design information into the fc state method</span>
<span class="n">ao</span><span class="o">.</span><span class="n">register_signal_callback</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">BB</span><span class="p">,</span> <span class="n">trans_to_fc</span><span class="p">)</span>
<span class="n">ao</span><span class="o">.</span><span class="n">register_signal_callback</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">,</span>  <span class="n">trans_to_fc1</span><span class="p">)</span>
<span class="n">ao</span><span class="o">.</span><span class="n">register_parent</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">ao</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>

<span class="c1"># to see how fc would be written as a flat method:</span>
<span class="hll"><span class="k">print</span><span class="p">(</span><span class="n">ao</span><span class="o">.</span><span class="n">to_code</span><span class="p">(</span><span class="n">fc</span><span class="p">))</span> <span class="c1"># -&gt;</span>
</span>  <span class="c1"># @spy_on</span>
  <span class="c1"># def fc(chart, e):</span>
  <span class="c1">#   status = return_status.UNHANDLED</span>
  <span class="c1">#   if(e.signal == signals.ENTRY_SIGNAL):</span>
  <span class="c1">#     status = return_status.HANDLED</span>
  <span class="c1">#   elif(e.signal == signals.INIT_SIGNAL):</span>
  <span class="c1">#     status = trans_to_fc1(chart, e)</span>
  <span class="c1">#   elif(e.signal == signals.BB):</span>
  <span class="c1">#     status = trans_to_fc(chart, e)</span>
  <span class="c1">#   elif(e.signal == signals.EXIT_SIGNAL):</span>
  <span class="c1">#     status = return_status.HANDLED</span>
  <span class="c1">#   else:</span>
  <span class="c1">#     status, chart.temp.fun = return_status.SUPER, chart.top</span>
  <span class="c1">#   return status</span>
</pre></div>
</div>
<p>Above we see that the state method is flattened using the <code class="docutils literal"><span class="pre">to_code</span></code> method of
the active object.  You could copy this and drop it into your design for
debugging purposes.</p>
<p>The same process applies for a state method built using the <code class="docutils literal"><span class="pre">Factory</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros.activeobject</span> <span class="kn">import</span> <span class="n">ActiveObject</span>
<span class="kn">from</span> <span class="nn">miros.event</span> <span class="kn">import</span> <span class="n">signals</span><span class="p">,</span> <span class="n">Event</span><span class="p">,</span> <span class="n">return_status</span>
<span class="kn">from</span> <span class="nn">miros.activeobject</span> <span class="kn">import</span> <span class="n">Factory</span>

<span class="c1"># create the specific behavior we want in our state chart</span>
<span class="k">def</span> <span class="nf">trans_to_fc1</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">chart</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">fc1</span><span class="p">)</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">Factory</span><span class="p">(</span><span class="s1">&#39;factory_class_recipe_example&#39;</span><span class="p">)</span>

<span class="n">fc</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s1">&#39;fc&#39;</span><span class="p">)</span><span class="o">.</span>                             \
  <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">BB</span><span class="p">,</span> <span class="n">handler</span><span class="o">=</span><span class="n">trans_to_fc</span><span class="p">)</span><span class="o">.</span>           \
  <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">,</span> <span class="n">handler</span><span class="o">=</span><span class="n">trans_to_fc1</span><span class="p">)</span><span class="o">.</span> \
  <span class="n">to_method</span><span class="p">()</span>

<span class="hll"><span class="n">chart</span><span class="o">.</span><span class="n">to_code</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span> <span class="c1"># =&gt;</span>
</span>  <span class="c1"># @spy_on</span>
  <span class="c1"># def fc(chart, e):</span>
  <span class="c1">#   status = return_status.UNHANDLED</span>
  <span class="c1">#   if(e.signal == signals.ENTRY_SIGNAL):</span>
  <span class="c1">#     status = return_status.HANDLED</span>
  <span class="c1">#   elif(e.signal == signals.INIT_SIGNAL):</span>
  <span class="c1">#     status = trans_to_fc1(chart, e)</span>
  <span class="c1">#   elif(e.signal == signals.BB):</span>
  <span class="c1">#     status = trans_to_fc(chart, e)</span>
  <span class="c1">#   elif(e.signal == signals.EXIT_SIGNAL):</span>
  <span class="c1">#     status = return_status.HANDLED</span>
  <span class="c1">#   else:</span>
  <span class="c1">#     status, chart.temp.fun = return_status.SUPER, chart.top</span>
  <span class="c1">#   return status</span>
</pre></div>
</div>
<p>To see how to unwind an auto-generated statechart read
<a class="reference internal" href="towardsthefactoryexample.html#towardsthefactoryexample-unwinding-a-factory-state-method"><span class="std std-ref">unwinding a state method</span></a></p>
</div>
</div>
<div class="section" id="describing-your-work">
<span id="recipes-describing-your-work"></span><h2>Describing your Work<a class="headerlink" href="#describing-your-work" title="Permalink to this headline">¶</a></h2>
<div class="section" id="drawing-a-statechart">
<span id="recipes-drawing-a-statechart"></span><h3>Drawing a StateChart<a class="headerlink" href="#drawing-a-statechart" title="Permalink to this headline">¶</a></h3>
<p>The Harel formalism was consumed by the UML standard.</p>
<p>The UML standards were not properly curated and became overly-complicated and
full of contradictions.  As a result, they are largely disregarded by the
software community at large, so most of the open source drawing tool projects
have been abandoned.</p>
<p>A lot of the commercial drawing tools have tried to keep up with the overly
complicated UML standards, so you end up fighting with the tools when you just
want to draw a simple picture.  The point of the picture is to be expressive
enough to explain something to someone else.</p>
<p>So in many ways UML has become a kind of anti-brand but it has it’s good parts.
Skip the class diagrams and use the <a class="reference internal" href="#recipes-drawing-a-sequence-diagram"><span class="std std-ref">sequence
diagram</span></a> and the statecharts.</p>
<p>A statechart drawing tool only needs to provide the following features:</p>
<ol class="arabic simple">
<li>zoom in and out of a diagram.</li>
<li>draw the basic Harel statemachine building blocks.</li>
<li>draw arrows and the other useful parts of UML.</li>
<li>mark up the diagram with code</li>
<li>be simple to change a design</li>
</ol>
<p>Pencil and paper are great for drawing your designs.  It is good to work on
them over and over again without the impediment of the computer interface
getting in your way.</p>
<p>Once you think you have it figured out you can transfer the picture into
something digital using a free tool called <a class="reference external" href="http://www.umlet.com/">umlet</a>.</p>
<p>There is also an online version of the tool, which is called <a class="reference external" href="http://www.umlet.com/umletino/umletino.html">umletino</a>.</p>
<p>It is easy to use and it has a lot of youtube training videos.  It doesn’t
provide the zooming features asked for by the original Harel paper (1987), but
this could be implemented using HTML/SVG if you have a lot of spare time.</p>
<p>If you want to drop an ASCII art picture into your code (which you will see in
the examples) you can use the <a class="reference external" href="https://github.com/vim-scripts/DrawIt">drawit</a> vim plugin, or something like it for
your text editor.  If you don’t know how to do it yet, look up vertical
editing, this is required if you are going to sketch in meaningful pictures.</p>
</div>
<div class="section" id="drawing-a-sequence-diagram">
<span id="recipes-drawing-a-sequence-diagram"></span><h3>Drawing a Sequence Diagram<a class="headerlink" href="#drawing-a-sequence-diagram" title="Permalink to this headline">¶</a></h3>
<p>To create effective, yet inexpensive documentation, you can <a class="reference internal" href="reflection.html#reflection-a-high-level-description-of-the-behavior"><span class="std std-ref">first obtain
a trace of your system</span></a>,
then use it to generate a sequence diagram, with <a class="reference external" href="https://github.com/aleph2c/sequence">sequence</a>.</p>
<p>Without a lot of effort, you can configure your text editor to write these
pictures for you.  When I select this in my editor:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">28.268873</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">start_at</span><span class="p">()</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">arming</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">arming</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
</pre></div>
</div>
<p>Then press &lt;ctrl-T&gt;, it becomes this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[ Chart: 75c8c ] (?)
     top        arming        armed
      +-tart_at()-&gt;|            |
      |    (?)     |            |
      |            +---BC()----&gt;|
      |            |    (?)     |
      |            |            +
      |            |             \ (?)
      |            |             BC()
      |            |             /
      |            |            &lt;
</pre></div>
</div>
<p>Then I would manually replace the question marks with numbers, so that
I could explained each event by referencing its number.  Since my diagram is in
ASCII, I could place it in my code comments.</p>
<p><a class="reference external" href="https://github.com/aleph2c/sequence">sequence</a> also works with interleaving trace outputs that would come from two
different interacting active objects:</p>
<p>Suppose you got this from your terminal while testing two different
statecharts:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">28.268873</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">start_at</span><span class="p">()</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">arming</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">28.268873</span><span class="p">]</span> <span class="p">[</span><span class="mi">95</span><span class="n">a8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">start_at</span><span class="p">()</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">arming</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">arming</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">95</span><span class="n">a8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">OTHER</span><span class="p">()</span> <span class="n">arming</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">75</span><span class="n">c8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">95</span><span class="n">a8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">06</span> <span class="mi">08</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mf">26.312241</span><span class="p">]</span> <span class="p">[</span><span class="mi">95</span><span class="n">a8c</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BC</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
</pre></div>
</div>
<p>By running it through <a class="reference external" href="https://github.com/aleph2c/sequence">sequence</a> we would see:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[ Chart: 75c8c ] (?)
     top        arming        armed
      +-tart_at()-&gt;|            |
      |    (?)     |            |
      |            +---BC()----&gt;|
      |            |    (?)     |
      |            |            +
      |            |             \ (?)
      |            |             BC()
      |            |             /
      |            |            &lt;

[ Chart: 95a8c ] (?)
     top        arming        armed
      +-tart_at()-&gt;|            |
      |    (?)     |            |
<span class="hll">      |            +--OTHER()--&gt;|
</span>      |            |    (?)     |
      |            |            +
      |            |             \ (?)
      |            |             BC()
      |            |             /
      |            |            &lt;
</pre></div>
</div>
<p>Now I’ll write some fake documentation to make a point, notice how I update the
numbers in the diagram:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="n">Chart</span><span class="p">:</span> <span class="n">Unit</span> <span class="mi">1</span> <span class="p">]</span>
     <span class="n">top</span>        <span class="n">arming</span>        <span class="n">armed</span>
      <span class="o">+</span><span class="n">start_at</span><span class="p">()</span><span class="o">-&gt;|</span>            <span class="o">|</span>
      <span class="o">|</span>    <span class="p">(</span><span class="mi">1</span><span class="p">)</span>     <span class="o">|</span>            <span class="o">|</span>
      <span class="o">|</span>            <span class="o">+---</span><span class="n">BC</span><span class="p">()</span><span class="o">----&gt;|</span>
      <span class="o">|</span>            <span class="o">|</span>    <span class="p">(</span><span class="mi">3</span><span class="p">)</span>     <span class="o">|</span>
      <span class="o">|</span>            <span class="o">|</span>            <span class="o">+</span>
      <span class="o">|</span>            <span class="o">|</span>             \ <span class="p">(</span><span class="mi">5</span><span class="p">)</span>
      <span class="o">|</span>            <span class="o">|</span>             <span class="n">BC</span><span class="p">()</span>
      <span class="o">|</span>            <span class="o">|</span>             <span class="o">/</span>
      <span class="o">|</span>            <span class="o">|</span>            <span class="o">&lt;</span>

<span class="p">[</span> <span class="n">Chart</span><span class="p">:</span> <span class="n">Unit</span> <span class="mi">2</span> <span class="p">]</span>
     <span class="n">top</span>        <span class="n">arming</span>        <span class="n">armed</span>
      <span class="o">+</span><span class="n">start_at</span><span class="p">()</span><span class="o">-&gt;|</span>            <span class="o">|</span>
      <span class="o">|</span>    <span class="p">(</span><span class="mi">2</span><span class="p">)</span>     <span class="o">|</span>            <span class="o">|</span>
<span class="hll">      <span class="o">|</span>            <span class="o">+--</span><span class="n">OTHER</span><span class="p">()</span><span class="o">--&gt;|</span>
</span>      <span class="o">|</span>            <span class="o">|</span>    <span class="p">(</span><span class="mi">4</span><span class="p">)</span>     <span class="o">|</span>
      <span class="o">|</span>            <span class="o">|</span>            <span class="o">+</span>
      <span class="o">|</span>            <span class="o">|</span>             \ <span class="p">(</span><span class="mi">6</span><span class="p">)</span>
      <span class="o">|</span>            <span class="o">|</span>             <span class="n">BC</span><span class="p">()</span>
      <span class="o">|</span>            <span class="o">|</span>             <span class="o">/</span>
      <span class="o">|</span>            <span class="o">|</span>            <span class="o">&lt;</span>
</pre></div>
</div>
<p>You can gang two tazors together to act as one tazor.  The first arming event
in your tazor network will also arm all of the other tazors, consider the
diagram above to see this interaction.</p>
<ol class="arabic simple">
<li>Tazor labeled ‘Unit 1’ turns on in the <cite>arming</cite> state.</li>
<li>Tazor labeled ‘Unit 2’ turns on in the <cite>arming</cite> state.</li>
<li>Unit 1 begins a battery charge (BC) which will send a broadcast message to
all other tazors in the network.</li>
<li>Unit 2 detects another tazor is beginning a battery charge, so it too begins
it’s battery charge (OTHER)</li>
</ol>
<p>…. and so on</p>
<p>If I changed the above design, it would be simple to adjust these diagrams and
their description.  Sequence diagrams are great for explaining small things,
but they do break the <a class="reference external" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a> principle.  You are effectively replicating your
data by having these descriptions in your documentation.  The source <cite>image</cite> is
your state chart diagram.  Give it a lot of attention, since it is actually
your specification.  The sequence diagrams are little throw away things, that
can be used to assist in telling a very specific story about how your system
behaves.</p>
<p>I’m probably not following the UML standard and I don’t care.  The utility of
the sequence diagram picture is in its simplicity.</p>
<p>I know that you can represent loops and object destructor’s using these
diagrams, but why bother?  It is easier to write a loop in the code than it is
in a picture, so why not copy and paste the code onto the sequence diagram if
you need to explain a loop?</p>
<p>If you would like to create sequence diagrams that are UML compliant, the
<a class="reference external" href="http://www.umlet.com/">umlet</a> program supports these features.</p>
</div>
</div>
<div class="section" id="testing">
<span id="recipes-testing"></span><h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-a-trace-as-a-test-target">
<span id="recipes-using-a-trace-as-a-test-target"></span><h3>Using a Trace As a Test Target<a class="headerlink" href="#using-a-trace-as-a-test-target" title="Permalink to this headline">¶</a></h3>
<p>If you would like to sketch out the high level behavior of your statechart using
a trace output as the target for a regression test, you would:</p>
<ol class="arabic simple">
<li>Run your program and print your trace to the output.</li>
<li>Copy this trace as the target behavior of your test.</li>
<li>Run this trace target and the future output of the statechart trace through
the <a class="reference internal" href="reflection.html#stripped-example"><span class="std std-ref">stripped context manager</span></a> to remove the date
timestamp information.</li>
<li>Compare your target with the results.</li>
</ol>
<p>This should become clear with an example.</p>
<p>Consider a statechart that outputted the following at the point when you were
working on it.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">05</span> <span class="mi">21</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mf">56.098526</span><span class="p">]</span> <span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">start_at</span><span class="p">()</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">arming</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">05</span> <span class="mi">21</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mf">56.200047</span><span class="p">]</span> <span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">arming</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">05</span> <span class="mi">21</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mf">56.300974</span><span class="p">]</span> <span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mo">05</span> <span class="mi">21</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mf">56.401682</span><span class="p">]</span> <span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
</pre></div>
</div>
<p>You might have gotten this output with the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">tazor</span><span class="o">.</span><span class="n">trace</span><span class="p">())</span>
</pre></div>
</div>
<p>It does a decent job describing what we want, but it has timestamps.  With the
<cite>stripped</cite> context manager we can turn the above into something that would look
like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">start_at</span><span class="p">()</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">arming</span>
<span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">arming</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
<span class="p">[</span><span class="n">tazor</span><span class="p">]</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">BATTERY_CHARGE</span><span class="p">()</span> <span class="n">armed</span><span class="o">-&gt;</span><span class="n">armed</span>
</pre></div>
</div>
<p>That is something that shouldn’t change over time, it looks like something we
could use as a test specification.  The only problem is that when we run the
code in the future and generate a new trace we get a trace with a pre-pended
date timestamp.  We can get around this issue like this:</p>
<div class="highlight-python" id="stripped-example"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros.hsm</span> <span class="kn">import</span> <span class="n">stripped</span>

<span class="n">target</span> <span class="o">=</span> \
<span class="sd">&#39;&#39;&#39;[2017-11-05 21:31:56.098526] [tazor] e-&gt;start_at() top-&gt;arming</span>
<span class="sd">   [2017-11-05 21:31:56.200047] [tazor] e-&gt;BATTERY_CHARGE() arming-&gt;armed</span>
<span class="sd">   [2017-11-05 21:31:56.300974] [tazor] e-&gt;BATTERY_CHARGE() armed-&gt;armed</span>
<span class="sd">   [2017-11-05 21:31:56.401682] [tazor] e-&gt;BATTERY_CHARGE() armed-&gt;armed</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">with</span> <span class="n">stripped</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="k">as</span> <span class="n">stripped_target</span><span class="p">,</span> \
     <span class="n">stripped</span><span class="p">(</span><span class="n">tazor</span><span class="o">.</span><span class="n">trace</span><span class="p">())</span> <span class="k">as</span> <span class="n">stripped_trace_result</span><span class="p">:</span>

  <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">stripped_target</span><span class="p">,</span> <span class="n">stripped_trace_result</span><span class="p">):</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">target</span> <span class="o">==</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>On line <strong>1</strong> we import the stripped context manager.</p>
<p>On lines <strong>3-7</strong> we define the target as just being the trace that we copied
when we were first designing our statechart.</p>
<p>On line <strong>9</strong>, we map this target to the <code class="docutils literal"><span class="pre">stripped_target</span></code> which contains the
same string with the date timestamps removed.</p>
<p>On line <strong>10</strong>, we use the same stripped context manager to strip our tazor active
object’s trace output of it’s date timestamp information and place the result
into the <code class="docutils literal"><span class="pre">stripped_trace_result</span></code> variable.</p>
<p>Lines <strong>12-13</strong> are for testing each line of our output against our target.</p>
<p>If our design changes, it is easy to update the test, we just copy the new
trace of of new design into the target string and everything should be peachy.</p>
</div>
<div class="section" id="using-a-spy-as-a-test-target">
<h3>Using a Spy as a Test Target<a class="headerlink" href="#using-a-spy-as-a-test-target" title="Permalink to this headline">¶</a></h3>
<p>A trace does not tell the full story about what your system is doing.  For
instance it is blind to hooks, deferred events and many other things that might
happen in the dynamics of your active object.  If you need to look at the
<cite>exact</cite> behavior of your system, you can:</p>
<ol class="arabic simple">
<li>Run your program and print your spy to the output.</li>
<li>Copy the spy as your target behavior.</li>
<li>Compare the target with the results.</li>
</ol>
<p>Here is an example:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="c1"># pp(tazor.spy())</span>
</span><span class="hll"><span class="c1"># import pdb.set_trace()</span>
</span><span class="hll"><span class="k">assert</span><span class="p">(</span><span class="n">tazor</span><span class="o">.</span><span class="n">spy</span><span class="p">()</span> <span class="o">==</span>
</span>  <span class="p">[</span><span class="s1">&#39;START&#39;</span><span class="p">,</span>
   <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:arming&#39;</span><span class="p">,</span>
   <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:tazor_operating&#39;</span><span class="p">,</span>
   <span class="s1">&#39;ENTRY_SIGNAL:tazor_operating&#39;</span><span class="p">,</span>
   <span class="s1">&#39;ENTRY_SIGNAL:arming&#39;</span><span class="p">,</span>
   <span class="s1">&#39;INIT_SIGNAL:arming&#39;</span><span class="p">,</span>
   <span class="s1">&#39;&lt;- Queued:(0) Deferred:(0)&#39;</span><span class="p">,</span>
   <span class="s1">&#39;BATTERY_CHARGE:arming&#39;</span><span class="p">,</span>
   <span class="s1">&#39;SEARCH_FOR_SUPER_SIGNAL:armed&#39;</span><span class="p">,</span>
   <span class="s1">&#39;ENTRY_SIGNAL:armed&#39;</span><span class="p">,</span>
   <span class="s1">&#39;POST_DEFERRED:CAPACITOR_CHARGE&#39;</span><span class="p">,</span>
   <span class="s1">&#39;INIT_SIGNAL:armed&#39;</span><span class="p">,</span>
   <span class="s1">&#39;&lt;- Queued:(0) Deferred:(1)&#39;</span><span class="p">])</span>
</pre></div>
</td></tr></table></div>
<p>On line <strong>1</strong> we have a commented pretty print command ready to go for when we
need to rebuild our test specification.  When the test fails in the future,
which it will because this is a tightly coupled test, we will uncomment lines
<strong>1-2</strong> then re-run the test.</p>
<p>This will drop us into a debugging session just after our next spy output has
been printed to the screen.  At this point we would carefully determine if it
actually describes the new behavior we are looking for. If it wasn’t, we would
fix the issue, otherwise we over-write lines <strong>4-16</strong> with this new
specification.</p>
<p>We would re-comment lines <strong>1-2</strong> and re-run our tests.</p>
<p><a class="reference internal" href="reflection.html#reflection"><span class="std std-ref">Next topic</span></a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="index.html">
  <img class="logo_a" src="_static/miros_a.svg" width="250" alt="Logo" >
</a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Recipes</a><ul>
<li><a class="reference internal" href="#states">States</a><ul>
<li><a class="reference internal" href="#what-a-state-does-and-how-to-structure-it">What a State Does and How to Structure it</a></li>
<li><a class="reference internal" href="#boiler-plate-state-method-code">Boiler Plate State Method Code</a></li>
<li><a class="reference internal" href="#describe-a-parent-state">Describe a Parent State</a></li>
<li><a class="reference internal" href="#pass-an-event-through-to-a-parent-state">Pass an event through to a Parent State</a></li>
<li><a class="reference internal" href="#transition-to-another-state">Transition to another state</a></li>
<li><a class="reference internal" href="#do-something-when-the-state-is-entered">Do Something when the State is Entered</a></li>
<li><a class="reference internal" href="#do-something-when-the-state-is-initialized">Do Something when the State is Initialized</a></li>
<li><a class="reference internal" href="#do-something-when-the-state-is-exited">Do Something when the State is Exited</a></li>
<li><a class="reference internal" href="#augment-your-active-object">Augment Your Active Object</a></li>
<li><a class="reference internal" href="#create-a-hook">Create a Hook</a></li>
<li><a class="reference internal" href="#catch-and-release">Catch and Release</a></li>
<li><a class="reference internal" href="#create-a-one-shot">Create a One-Shot</a></li>
<li><a class="reference internal" href="#create-a-multi-shot">Create a Multi-Shot</a></li>
<li><a class="reference internal" href="#cancelling-events">Cancelling Events</a></li>
<li><a class="reference internal" href="#deferring-and-recalling-an-event">Deferring and Recalling an Event</a></li>
<li><a class="reference internal" href="#create-a-guard">Create a Guard</a></li>
<li><a class="reference internal" href="#creating-a-statechart-from-a-template">Creating a Statechart From a Template</a></li>
<li><a class="reference internal" href="#creating-a-statechart-from-a-factory">Creating a Statechart From a Factory</a></li>
</ul>
</li>
<li><a class="reference internal" href="#events-and-signals">Events And Signals</a><ul>
<li><a class="reference internal" href="#creating-an-event">Creating an Event</a></li>
<li><a class="reference internal" href="#creating-a-signal">Creating a Signal</a></li>
<li><a class="reference internal" href="#posting-events">Posting Events</a></li>
<li><a class="reference internal" href="#posting-an-event-to-the-fifo">Posting an Event to the Fifo</a></li>
<li><a class="reference internal" href="#posting-an-event-to-the-lifo">Posting an Event to the LIFO</a></li>
<li><a class="reference internal" href="#creating-a-one-shot-event">Creating a One-Shot Event</a></li>
<li><a class="reference internal" href="#creating-a-multishot-event">Creating a Multishot Event</a></li>
<li><a class="reference internal" href="#cancelling-a-specific-event-source">Cancelling a Specific Event Source</a></li>
<li><a class="reference internal" href="#cancelling-event-source-by-signal-name">Cancelling Event Source By Signal Name</a></li>
<li><a class="reference internal" href="#recipes-deferring-an-event">Deferring and Recalling an Event</a></li>
<li><a class="reference internal" href="#adding-a-payload-to-an-event">Adding a Payload to an Event</a></li>
<li><a class="reference internal" href="#determining-if-an-event-has-a-payload">Determining if an Event Has a Payload</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multiple-statecharts">Multiple Statecharts</a><ul>
<li><a class="reference internal" href="#subscribing-to-an-event-posted-by-another-active-object">Subscribing to an Event Posted by Another Active Object</a></li>
<li><a class="reference internal" href="#publishing-events-to-other-active-objects">Publishing events to other Active Objects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recipes-seeing-what-is">Seeing What is Going On</a><ul>
<li><a class="reference internal" href="#determining-the-current-state">Determining the Current State</a></li>
<li><a class="reference internal" href="#seeing-what-signals-you-have-in-your-system">Seeing what Signals You Have In Your System</a></li>
<li><a class="reference internal" href="#using-the-trace">Using the Trace</a></li>
<li><a class="reference internal" href="#using-the-spy">Using the Spy</a></li>
<li><a class="reference internal" href="#add-timing-information-to-the-spy">Add Timing Information to the Spy</a></li>
<li><a class="reference internal" href="#tracing-live">Tracing Live</a></li>
<li><a class="reference internal" href="#spying-live">Spying Live</a></li>
<li><a class="reference internal" href="#scribble-on-the-spy">Scribble On the Spy</a></li>
<li><a class="reference internal" href="#flatting-a-state-method">Flatting a State Method</a></li>
</ul>
</li>
<li><a class="reference internal" href="#describing-your-work">Describing your Work</a><ul>
<li><a class="reference internal" href="#drawing-a-statechart">Drawing a StateChart</a></li>
<li><a class="reference internal" href="#drawing-a-sequence-diagram">Drawing a Sequence Diagram</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing">Testing</a><ul>
<li><a class="reference internal" href="#using-a-trace-as-a-test-target">Using a Trace As a Test Target</a></li>
<li><a class="reference internal" href="#using-a-spy-as-a-test-target">Using a Spy as a Test Target</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="networked_instrumentation.html" title="previous chapter">Spy and Trace Across a Network</a></li>
      <li>Next: <a href="reflection.html" title="next chapter">Reflection</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/recipes.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Scott Volk.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/recipes.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>