
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cellular Automata &#8212; miros 2.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Active Object Example" href="singlechartexample.html" />
    <link rel="prev" title="Comprehensive" href="comprehensive.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <blockquote>
<div><p><em>Making the simple complicated is commonplace; making the complicated simple, awesomely simple, that’s creativity.</em></p>
<p class="attribution">&mdash;Charlie Mingus</p>
</div></blockquote>
<div class="section" id="cellular-automata">
<h1>Cellular Automata<a class="headerlink" href="#cellular-automata" title="Permalink to this headline">¶</a></h1>
<p>Here is a picture of the predatory snail, <a class="reference external" href="https://www.youtube.com/watch?v=JjHMGSI_h0Q">Conus Textile</a>:</p>
<a class="reference external image-reference" href="https://en.wikipedia.org/wiki/Cellular_automaton#/media/File:Textile_cone.JPG"><img alt="_images/Conus_textile.JPG" class="align-center" src="_images/Conus_textile.JPG" /></a>
<div class=body>By Richard Ling - Own work; Location: Cod Hole, Great Barrier Reef, Australia, <a href="http://creativecommons.org/licenses/by-sa/3.0/" title="Creative Commons Attribution-Share Alike 3.0">CC BY-SA 3.0</a>, <a href="https://commons.wikimedia.org/w/index.php?curid=293495">Link</a></div><p>The pattern on its shell is an example of a 1D cellular automata.  The shell is
grown by a kind of organic line of printer heads along the shell’s lip.  These
printer heads, called pigment cells, can extrude colored calcium cement.  The
color choice of a pigment cell is dependent upon the color choice of it’s two
adjacent pigment cells.  The rules governing this process are simple, yet a very
complex shell color pattern emerges.</p>
<p>A 1D cellular automata exists on a 2D grid of cells; like graphing paper, and it
is governed by a simple set of rules.  How you color in a square is dependent
upon the coloring of the three squares above it.  If we decided only to use
black and white coloring, a square’s color would be dependent upon eight
different permutations of the three squares above it.  The governing rules of a
1D cellular automata could be described by drawing out these eight pictures.</p>
<p>But before we begin to fill in our drawings we would have to decide how to start
them.  Typically you color the middle square of the top line on your graphing
paper black, then begin painting the squares of the second line using the rules.
Of course, you don’t have to do this, you can start however you like.  But how
you start is called the initial condition, and as you will see, the initial
conditions have a huge effect on the overall emergent pattern of your drawing.</p>
<p>In 1983 <a class="reference external" href="https://www.youtube.com/watch?v=60P7717-XOQ">Stephen Wolfram</a>
discovered a 1D cellular automata which created patterns that look like the
shell of the Conus Textile snail.  He called this program, <a class="reference external" href="https://en.wikipedia.org/wiki/Rule_30">Rule 30</a>.</p>
<p>Let’s explore how to make a Rule 30, 1D cellular automata, by looking at the
instructions which govern it:</p>
<blockquote>
<div><em>“First, look at each cell and it’s right-hand neighbor.  If both of these were
white on the previous step, then take the new color of the cell to be whatever
the previous color of its left-hand neighbor was.  Otherwise, take the new
color to be the opposite of that.”</em> <a class="footnote-reference" href="#id2" id="id1">[1]</a></div></blockquote>
<p>Here are these instructions as a picture:</p>
<a class="reference external image-reference" href="_static/rule_30_rule_in_pictures.pdf"><div align="center" class="align-center"><img alt="_images/rule_30_rule_in_pictures.svg" src="_images/rule_30_rule_in_pictures.svg" /></div>
</a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you look carefully at the picture version of the rule, you will see two
rows of binary numbers, and the reason why rule 30 is called rule 30.</p>
</div>
<p>Now let’s start a drawing: we will place a black square in the middle of the
first line then follow the rules to fill in the 4 lines below it.</p>
<a class="reference external image-reference" href="_static/rule_30_by_hand.pdf"><div align="center" class="align-center"><img alt="_images/rule_30_by_hand.svg" src="_images/rule_30_by_hand.svg" /></div>
</a>
<p>If you look at the diagram and compare it to the rules described as a paragraph,
then to the pictures illustrating this same rule, you will see how it works.</p>
<p>Now, what do we do about the edges of our graphing paper?  We could just pretend
they aren’t there, making the automata infinite.  Or, we could wrap the paper
into a tube so that there is no edge.  I have seen that both of these things
have been done before, but I haven’t seen anyone just force a color onto the
edge, like a wall.  The guys that invented and played with automata are really
<em>really</em> smart, and they follow a disciplined, mathematical aesthetic.  So let’s
do something they wouldn’t do, let’s take their beautiful little program and run
it into something completely arbitrary, let’s build that wall!</p>
<p>This will give us a chance to have two state machines interact in the same
cellular automata.  We need two different machines, a rule 30 machine and a wall
machine.  The wall machine should be able to be white or black.</p>
<p>Let’s design a system, then build it and run it (not necessarily in that order)
and see if we can make something new.</p>
<div class="section" id="design-and-code">
<span id="cellular-automata-design"></span><h2>Design and Code<a class="headerlink" href="#design-and-code" title="Permalink to this headline">¶</a></h2>
<p>Here is a basic design diagram including two finite state machines (FSMs) that
will do the job:</p>
<a class="reference external image-reference" href="_static/rule_30_basic_design.pdf"><div align="center" class="align-center"><img alt="_images/rule_30_basic_design.svg" src="_images/rule_30_basic_design.svg" /></div>
</a>
<p>At the top of the diagram is our automata which provides some context and
describes our design goal.  Below that is a small UML diagram showing how some
classes relate to each other.  We see that a <code class="docutils literal notranslate"><span class="pre">Canvas</span></code> class <em>has a</em>
<code class="docutils literal notranslate"><span class="pre">OneDCellularAutomata</span></code> class.  This <code class="docutils literal notranslate"><span class="pre">OneDCellularAutomata</span></code> class <em>has many</em>
<code class="docutils literal notranslate"><span class="pre">Rule30</span></code> and <code class="docutils literal notranslate"><span class="pre">Wall</span></code> classes.  The <code class="docutils literal notranslate"><span class="pre">Canvas</span></code> class will draw our diagrams
and animations, the <code class="docutils literal notranslate"><span class="pre">OneDCellularAutomata</span></code> will be responsible for creating
any automata given a <code class="docutils literal notranslate"><span class="pre">Wall</span></code> class and a <code class="docutils literal notranslate"><span class="pre">Rule</span></code> class.  That seems simple
enough.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Rule30</span></code> class will have three attributes describing the machine on the
left and right and its color.  The <code class="docutils literal notranslate"><span class="pre">Rule30</span></code> machine will be inherited from the
<code class="docutils literal notranslate"><span class="pre">Wall</span></code> class, so we only have to write our color worker method,
<code class="docutils literal notranslate"><span class="pre">color_number</span></code>, in one spot (the <code class="docutils literal notranslate"><span class="pre">Wall</span></code> class).  The <code class="docutils literal notranslate"><span class="pre">Wall</span></code> class is
inherited from the <code class="docutils literal notranslate"><span class="pre">HsmWithQueues</span></code>, which means that these state machines
won’t be running in their own threads (like they would be if they were derived
from the <code class="docutils literal notranslate"><span class="pre">ActiveObject</span></code> class).  To have them react to events, we will have to
use their <code class="docutils literal notranslate"><span class="pre">dispatch</span></code> method, and they will have to run within the thread of
some sort of governing program.</p>
<p>The state machine under the <code class="docutils literal notranslate"><span class="pre">Rule30</span></code> class will provide the behaviour
described by the squares at the top of the page.  The state machine under the
<code class="docutils literal notranslate"><span class="pre">Wall</span></code> class consists of two states which can only be gotten to using the
<code class="docutils literal notranslate"><span class="pre">start_at</span></code> method, no event will cause a transition between these states.  The
<code class="docutils literal notranslate"><span class="pre">Wall</span></code> objects are intended to interface with the <code class="docutils literal notranslate"><span class="pre">Rule30</span></code> objects so that a
<code class="docutils literal notranslate"><span class="pre">Rule30</span></code> cell can’t tell if it is working with an actual machine or just a
wall.</p>
<div class="section" id="canvas-class">
<span id="cellular-automata-canvas"></span><h3>Canvas Class<a class="headerlink" href="#canvas-class" title="Permalink to this headline">¶</a></h3>
<p>How do we build a <code class="docutils literal notranslate"><span class="pre">Canvas</span></code> class to get the feedback needed to see what is
going on with our program?</p>
<p>If we were using Stephen Wolfram’s Mathematica software, this work would be
trivial. Even if we were using Matlab, it wouldn’t be too hard to see these
automata, but we are using Python so we will have to stitch a few things
together before we can visualize our work.</p>
<p>Let’s go technology shopping.</p>
<p>A few years ago Python <a class="reference external" href="https://www.youtube.com/watch?v=AyenRCJ_4Ww">borg’d</a>
Matlab, into its <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, <code class="docutils literal notranslate"><span class="pre">scipy</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> packages, so the Matlab
type interfaces have been assimilated into the Python collective: resistance is
futile.  We can use the <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> libraries to get the Matlab
features we need to build and animate our automata.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> library can animate graphs so we will use that.  The graphing
paper look that we want is provided by its <code class="docutils literal notranslate"><span class="pre">matplotlib.pcolormesh</span></code> graphing
object so we will use that too.  Animations are provided by the
<code class="docutils literal notranslate"><span class="pre">matplotlib.FuncAnimation</span></code> class, which takes a reference to the figure you
are drawing on, information about how many frames you want in your movie and how
often you want to show them, and some callback functions that affect the data
(your picture) for each frame.  The callback functions will be very useful,
because it means we can pull the operation of our automata away from the
<code class="docutils literal notranslate"><span class="pre">Canvas</span></code> class and we can make the animation callback call out to a coroutine,
so we can run our automata forever (if we wanted that).</p>
<p>Under the hood <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> calls out to <code class="docutils literal notranslate"><span class="pre">FFmpeg</span></code>, which is some open source
software that makes videos.  Let’s install what we need and get back to our
design:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">ffmpeg</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">numpy</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">matplotlib</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">I’m assuming you are working within a virtual enviroment.  If you are on
windows, go and get the ubuntu app, and run this code within your Windows
Linux Subsystem (WLS).  If you are on a mac, you can use <code class="docutils literal notranslate"><span class="pre">brew</span></code> to get
ffmpeg.</p>
</div>
<p>Here is a UML drawing of the Canvas class:</p>
<a class="reference external image-reference" href="_static/rule_30_canvas.pdf"><div align="center" class="align-center"><img alt="_images/rule_30_canvas.svg" src="_images/rule_30_canvas.svg" /></div>
</a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The diagram isn’t that useful, and it’s reproducing information that is already
in the code.  It might have been easier to see this same information using your
editor’s code browser.  But, remember, UML is from the ’90s.</p>
</div>
<p>The diagram may not be that useful, but it emphasizes that the <code class="docutils literal notranslate"><span class="pre">Canvas</span></code> class
will have a <code class="docutils literal notranslate"><span class="pre">FuncAnimation</span></code> object and a <code class="docutils literal notranslate"><span class="pre">LinearSegmentedColormap</span></code> (used for
making colors), and it shows us how we want to make the object and how we want
to use it with the <code class="docutils literal notranslate"><span class="pre">run_animation</span></code> and <code class="docutils literal notranslate"><span class="pre">save</span></code> methods.</p>
<p>It also shows us that the Canvas calls will have a <code class="docutils literal notranslate"><span class="pre">OneDCellularAutomata</span></code>
object, which will be created elsewhere, then passed to it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="kn">as</span> <span class="nn">animation</span>

<span class="k">class</span> <span class="nc">Canvas</span><span class="p">():</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">automata</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Animate 2D graphing paper, or static file describing a automata</span>

<span class="sd">    Given an autonoma, which has a ``_Generation`` coroutine generator, an</span>
<span class="sd">    animation can be build by calling this coroutine for as many generations</span>
<span class="sd">    are required.</span>

<span class="sd">    **Note**:</span>
<span class="sd">       This ``automata`` object needs to provide a ``_Generation`` method</span>
<span class="sd">       which returns a coroutine which can be called with ``next``.</span>

<span class="sd">    **Args**:</span>
<span class="sd">       | ``automata`` (OneDCellularAutomata):</span>
<span class="sd">       | ``title=None`` (string): An optional title</span>

<span class="sd">    **Returns**:</span>
<span class="sd">       (Canvas): this object</span>

<span class="sd">    **Example(s)**:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">       eco1 = Canvas(autonoma)</span>
<span class="sd">       eco1.run_animation(1200, interval=10)  # 10 ms</span>
<span class="sd">       eco1.save(&#39;eco1.mp4&#39;)</span>

<span class="sd">       eco2 = Canvas(automata)</span>
<span class="sd">       eco2 = save(&#39;eco2.pdf, generations=100)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">automata</span> <span class="o">=</span> <span class="n">automata</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generation</span> <span class="o">=</span> <span class="n">automata</span><span class="o">.</span><span class="n">_Generation</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># seventies orange/browns looking color map</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span>
      <span class="s1">&#39;oranges&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffa501&#39;</span><span class="p">,</span> <span class="s1">&#39;#b27300&#39;</span><span class="p">,</span> <span class="s1">&#39;#191000&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;animation initialization callback</span>

<span class="sd">    **Note**:</span>
<span class="sd">       This not needed by our animation, but it is needed by the library we</span>
<span class="sd">       are calling, so we just stub it out</span>

<span class="sd">    **Returns**:</span>
<span class="sd">       (tuple): (self.grid,)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,)</span>

  <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;animation callback.</span>

<span class="sd">    This method will be called for each i frame of the animation.  It creates</span>
<span class="sd">    the next generation of the automata then it updates the pcolormesh using</span>
<span class="sd">    the set_array method.</span>

<span class="sd">    **Args**:</span>
<span class="sd">       | ``i`` (int): animation frame number</span>

<span class="sd">    **Returns**:</span>
<span class="sd">       (tuple): (self.grid,)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="p">)</span>
    <span class="c1"># set_array only accepts a 1D argument</span>
    <span class="c1"># so flatten Z before feeding it into the grid arg</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,)</span>

  <span class="k">def</span> <span class="nf">run_animation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">generations</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Run an animation of the automata.</span>

<span class="sd">    **Args**:</span>
<span class="sd">       | ``generations`` (int): number of automata generations</span>
<span class="sd">       | ``interval`` (int): movie frame interval in ms</span>

<span class="sd">    **Example(s)**:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">      eco = Canvas(automata)</span>
<span class="sd">      eco.run_animation(1200, interval=20)  # 20 ms</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">animate</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">,</span>
      <span class="n">frames</span><span class="o">=</span><span class="n">generations</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span>
      <span class="n">blit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">generations</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;save an animation or run for a given number of generations and save as a</span>
<span class="sd">       static file (pdf, svg, .. etc)</span>

<span class="sd">    **Note**:</span>
<span class="sd">       This function will save as many different static file formats as are</span>
<span class="sd">       supported by matplot lib, since it uses matplotlib.</span>

<span class="sd">    **Args**:</span>
<span class="sd">       | ``filename=None`` (string): name of the file</span>
<span class="sd">       | ``generations=0`` (int): generations to run if the files doesn&#39;t have</span>
<span class="sd">       |                          an &#39;mp4&#39; extension and hasn&#39;t been</span>
<span class="sd">       |                          animated before</span>


<span class="sd">    **Example(s)**:</span>

<span class="sd">       eco1 = Canvas(autonoma)</span>
<span class="sd">       eco1.run_animation(50, 10)</span>
<span class="sd">       eco1.save(&#39;rule_30.mp4)</span>
<span class="sd">       eco1.save(&#39;rule_30.pdf)</span>

<span class="sd">       eco2 = Canvas(autonoma)</span>
<span class="sd">       eco1.save(&#39;rule_30.pdf&#39;, generations=40)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s1">&#39;.mp4&#39;</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">anim</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">automata</span><span class="o">.</span><span class="n">generation</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">automata</span><span class="o">.</span><span class="n">generations</span><span class="p">):</span>
          <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">automata</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On construction: I didn’t write the <code class="docutils literal notranslate"><span class="pre">Canvas</span></code> class out of thin air, I
created a 2 dimensional array and some functions that would randomize this
array, then I fed these functions into the code that I built up using examples
from the internet until I got something working.  Only then did I feed it the
OneDCellularAutomata class, which originally didn’t use a co-routine; it
was added later.</p>
</div>
</div>
<div class="section" id="the-onedcellularautomata-class">
<span id="cellular-automata-two2automato"></span><h3>The OneDCellularAutomata Class<a class="headerlink" href="#the-onedcellularautomata-class" title="Permalink to this headline">¶</a></h3>
<p>Let’s give our basic design another look:</p>
<a class="reference external image-reference" href="_static/rule_30_basic_design.pdf"><div align="center" class="align-center"><img alt="_images/rule_30_basic_design.svg" src="_images/rule_30_basic_design.svg" /></div>
</a>
<p>The <code class="docutils literal notranslate"><span class="pre">OneDCellularAutomata</span></code> object will be responsible for applying the rules
to our graphing paper, and for setting it into its initial condition (the black
square in the middle of the top line).</p>
<p>To do this <code class="docutils literal notranslate"><span class="pre">OneDCellularAutomata</span></code> will provide a two-dimensional array, Z,
containing color codes, to be used by our Canvas to draw things.  It also builds
a lot of <code class="docutils literal notranslate"><span class="pre">Rule30</span></code> and <code class="docutils literal notranslate"><span class="pre">Wall</span></code> state machines and links them to other machines
so that they can read the <code class="docutils literal notranslate"><span class="pre">left.color</span></code> and <code class="docutils literal notranslate"><span class="pre">right.color</span></code> attributes of their
adjacent cells.  <code class="docutils literal notranslate"><span class="pre">OneDCellularAutomata</span></code> needs to set up some initial
conditions; how the machines are started on the first line of our graphing
paper.  The <code class="docutils literal notranslate"><span class="pre">Rule30</span></code> state machines respond to <code class="docutils literal notranslate"><span class="pre">Next</span></code> events, which cause
them to react and change if they need to change, so the <code class="docutils literal notranslate"><span class="pre">OneDCellularAutomata</span></code>
will need to dispatch this event into all of the <code class="docutils literal notranslate"><span class="pre">Rule30</span></code> objects to make a
new line as the automata propagate downward.</p>
<p>To make the <code class="docutils literal notranslate"><span class="pre">OneDCellularAutomata</span></code> object generic, we will feed it its
automata rule and wall rules as classes.  To make the wall behaviour
parameterizable, I’ll add some new wall rule classes that hold the left and
right colors in their class attributes:</p>
<a class="reference external image-reference" href="_static/rule_30_basic_design_1.pdf"><div align="center" class="align-center"><img alt="_images/rule_30_basic_design_1.svg" src="_images/rule_30_basic_design_1.svg" /></div>
</a>
<p>Here is a UML diagram of the <code class="docutils literal notranslate"><span class="pre">OneDCellularAutomata</span></code> class:</p>
<a class="reference external image-reference" href="_static/rule_30_twodcellularautomata.pdf"><div align="center" class="align-center"><img alt="_images/rule_30_twodcellularautomata.svg" src="_images/rule_30_twodcellularautomata.svg" /></div>
</a>
<p>There is a bunch of stuff in this diagram that I don’t know how to draw using
UML.  For instance, how do I show a class that I have sent it a class, so it
knows how to build something, using the class I just gave it?  How do I draw
something that makes a co-routine?  Well, I don’t know, so I will just scribble
down something that isn’t too confusing and explain what I meant here with a few
words:</p>
<p>The few key takeaways from the drawing are how the constructor works, we feed it
in the rule and wall classes so that it can generically construct automata.  We
also show the function that returns the co-routine.  Each time <code class="docutils literal notranslate"><span class="pre">next</span></code> is
called it advances to the next yield statement.  So, the first time the
coroutine is activated, it will initialize the automata, and then every
activation after that will cause it to descend one row down.</p>
<p>Here is the code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">miros</span> <span class="kn">import</span> <span class="n">Event</span>

<span class="n">White</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">Black</span> <span class="o">=</span> <span class="mf">0.9</span>

<span class="k">class</span> <span class="nc">OneDCellularAutomata</span><span class="p">():</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
      <span class="n">generations</span><span class="p">,</span>
      <span class="n">cells_per_generation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="n">initial_condition_index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="n">machine_cls</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="n">wall_cls</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Build a two dimensional cellular automata object which can be advanced</span>
<span class="sd">       with a coroutine.</span>

<span class="sd">    **Args**:</span>
<span class="sd">       | ``generations`` (int): how many generations to run (vertical cells)</span>
<span class="sd">       | ``cells_per_generation=None`` (int): how many cells across</span>
<span class="sd">       | ``initial_condition_index=None`` (int): the starting index cell (make</span>
<span class="sd">       |                                         black)</span>
<span class="sd">       | ``machine_cls=None`` (Rule): which automata rule to follow</span>
<span class="sd">       | ``wall_cls=None`` (Wall): which wall rules to follow</span>

<span class="sd">    **Returns**:</span>
<span class="sd">       (OneDCellularAutonomata): an automata object</span>

<span class="sd">    **Example(s)**:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">      # build an automata using rule 30 with white walls</span>
<span class="sd">      # it should be 50 cells across</span>
<span class="sd">      # and it should run for 1000 generations</span>
<span class="sd">      autonoma = OneDCellularAutomata(</span>
<span class="sd">        machine_cls=Rule30,</span>
<span class="sd">        generations=1000,</span>
<span class="sd">        wall_cls=WallLeftWhiteRightWhite,</span>
<span class="sd">        cells_per_generation=50</span>
<span class="sd">      )</span>

<span class="sd">      # to get the generator for this automata</span>
<span class="sd">      generation = automata.make_generation_coroutine()</span>

<span class="sd">      # to advance a generation (first one will initialize it)</span>
<span class="sd">      next(generation)</span>

<span class="sd">      # to get the color codes from it&#39;s two dimension array</span>
<span class="sd">      automata.Z</span>

<span class="sd">      # to advance a generation</span>
<span class="sd">      next(generation)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># python automatically places the classes passed into this object as</span>
    <span class="c1"># tuples, this is surprising behavior but it is how it works, so we go</span>
    <span class="c1"># with it</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">machine_cls</span> <span class="o">=</span> <span class="n">machine_cls</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wall_cls</span> <span class="o">=</span> <span class="n">wall_cls</span>

    <span class="k">if</span> <span class="n">machine_cls</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">machine_cls</span> <span class="o">=</span> <span class="n">Rule30</span>

    <span class="k">if</span> <span class="n">wall_cls</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">wall_cls</span> <span class="o">=</span> <span class="n">WallLeftWhiteRightWhite</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">generations</span> <span class="o">=</span> <span class="n">generations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cells_per_generation</span> <span class="o">=</span> <span class="n">cells_per_generation</span>

    <span class="c1"># if they haven&#39;t specified cells_per_generation set it</span>
    <span class="c1"># so that the cells appear square on most terminals</span>
    <span class="k">if</span> <span class="n">cells_per_generation</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="c1"># this number was discovered through trial and error</span>
      <span class="c1"># matplotlib seems to be ignoring the aspect ratio</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">cells_per_generation</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">generations</span><span class="o">*</span><span class="mi">17</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">initial_condition_index</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells_per_generation</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> \
      <span class="k">if</span> <span class="n">initial_condition_index</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">initial_condition_index</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">generation</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">left_wall</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_cls</span><span class="o">.</span><span class="n">left_wall</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right_wall</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_cls</span><span class="o">.</span><span class="n">right_wall</span>

  <span class="k">def</span> <span class="nf">make_and_start_left_wall_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;make and start the left wall based on the wall_cls&#39;&#39;&#39;</span>
    <span class="n">wall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wall_cls</span><span class="p">()</span>
    <span class="n">wall</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_cls</span><span class="o">.</span><span class="n">left_wall</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wall</span>

  <span class="k">def</span> <span class="nf">make_and_start_right_wall_machine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;make and start the right wall based on the wall_cls&#39;&#39;&#39;</span>
    <span class="n">wall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wall_cls</span><span class="p">()</span>
    <span class="n">wall</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wall_cls</span><span class="o">.</span><span class="n">right_wall</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wall</span>

  <span class="k">def</span> <span class="nf">initial_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;initialize the 1d cellular automata&#39;&#39;&#39;</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">generations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells_per_generation</span><span class="p">],</span> <span class="n">Black</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># create a collections of unstarted machines</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">machines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells_per_generation</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">machine_cls</span><span class="p">())</span>

    <span class="n">left_wall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_and_start_left_wall_machine</span><span class="p">()</span>
    <span class="n">right_wall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_and_start_right_wall_machine</span><span class="p">()</span>

    <span class="c1"># unstarted machines sandwiched between unstarted boundaries</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">machines</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_wall</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">machines</span> <span class="o">+</span> <span class="p">[</span><span class="n">right_wall</span><span class="p">]</span>

    <span class="c1"># start the boundaries in their holding color</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">fake_white</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">fake_white</span><span class="p">)</span>

    <span class="c1"># start most of the machines in white except for the one at the</span>
    <span class="c1"># intial_condition_index</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_condition_index</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">white</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">black</span><span class="p">)</span>

    <span class="c1"># we have created a generation, so count down by one</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generations</span><span class="o">-</span><span class="mi">1</span>

    <span class="c1"># create some initial walls in Z</span>
    <span class="n">Z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">color_number</span><span class="p">()</span>
    <span class="n">Z</span><span class="p">[:,</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">color_number</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span>

  <span class="k">def</span> <span class="nf">next_generation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;create the next row of the 1d cellular automata&#39;&#39;&#39;</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">generations</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
      <span class="c1"># draw the first row</span>
      <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">machine</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="p">):</span>
        <span class="n">Z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">generations</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">color_number</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># draw every other row</span>
      <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span>
      <span class="n">new_machines</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
        <span class="n">old_left_machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">old_machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">old_right_machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">new_machine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">machine_cls</span><span class="p">()</span>
        <span class="n">new_machine</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">old_machine</span><span class="o">.</span><span class="n">state_fn</span><span class="p">)</span>
        <span class="n">new_machine</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">old_left_machine</span>
        <span class="n">new_machine</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">old_right_machine</span>
        <span class="n">new_machines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_machine</span><span class="p">)</span>

      <span class="n">left_wall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_and_start_left_wall_machine</span><span class="p">()</span>
      <span class="n">right_wall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_and_start_right_wall_machine</span><span class="p">()</span>
      <span class="n">new_machines</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_wall</span><span class="p">]</span> <span class="o">+</span> <span class="n">new_machines</span> <span class="o">+</span> <span class="p">[</span><span class="n">right_wall</span><span class="p">]</span>

      <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">machine</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_machines</span><span class="p">):</span>
        <span class="n">machine</span><span class="o">.</span><span class="n">dispatch</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">Next</span><span class="p">))</span>
        <span class="n">Z</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">color_number</span><span class="p">()</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">machines</span> <span class="o">=</span> <span class="n">new_machines</span><span class="p">[:]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generation</span> <span class="o">-=</span> <span class="mi">1</span>

  <span class="k">def</span> <span class="nf">make_generation_coroutine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;create the automata coroutine&#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initial_state</span><span class="p">()</span>
    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">next_generation</span><span class="p">()</span>
      <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On construction:  Initially I build the <code class="docutils literal notranslate"><span class="pre">OneDCellularAutomata</span></code> without a
coroutine.</p>
</div>
</div>
<div class="section" id="rule30-and-the-wall-classes">
<span id="cellular-automata-rule30-and-the-walls"></span><h3>Rule30 and the Wall Classes<a class="headerlink" href="#rule30-and-the-wall-classes" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Rule30</span></code> is a class which describes the attributes and methods needed by our
rule30 state machine.   The rule30 state machine really isn’t described anywhere
as an individual entity, it is two callback functions that attach to a
<code class="docutils literal notranslate"><span class="pre">Rule30</span></code> object.  You can see it here:</p>
<a class="reference external image-reference" href="_static/rule_30_basic_design_1.pdf"><div align="center" class="align-center"><img alt="_images/rule_30_basic_design_1.svg" src="_images/rule_30_basic_design_1.svg" /></div>
</a>
<p>To see if the rule 30 machine is designed properly, put your eyes on one of the
clusters-of-four-squares at the top of the diagram.  Now imagine the state
machine was started in the color of the middle of the top three squares of this
cluster.  Send the <code class="docutils literal notranslate"><span class="pre">Next</span></code> event to the machine and see if you can get it to
transition to the color of the bottom square of the cluster.</p>
<p>Let’s do the first one together:</p>
<a class="reference external image-reference" href="_static/rule_30_does_it_work.pdf"><div align="center" class="align-center"><img alt="_images/rule_30_does_it_work.svg" src="_images/rule_30_does_it_work.svg" /></div>
</a>
<p>If you repeat this exercise for each of the cluster-of-four-squares, and you are
satisfied, then this state machine’s design will give us the rule 30 behavior.</p>
<p>The wall is an even simpler machine, it starts in one color state and remains
that way forever.</p>
<p>Here is the code for our <code class="docutils literal notranslate"><span class="pre">Rule30</span></code> and <code class="docutils literal notranslate"><span class="pre">Wall</span></code> classes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros</span> <span class="kn">import</span> <span class="n">Event</span>
<span class="kn">from</span> <span class="nn">miros</span> <span class="kn">import</span> <span class="n">signals</span>
<span class="kn">from</span> <span class="nn">miros</span> <span class="kn">import</span> <span class="n">HsmWithQueues</span>
<span class="kn">from</span> <span class="nn">miros</span> <span class="kn">import</span> <span class="n">return_status</span>

<span class="k">class</span> <span class="nc">Wall</span><span class="p">(</span><span class="n">HsmWithQueues</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;wall&#39;</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="k">def</span> <span class="nf">color_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Black</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;black&#39;</span> <span class="k">else</span> <span class="n">White</span>

<span class="k">def</span> <span class="nf">fake_white</span><span class="p">(</span><span class="n">wall</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">wall</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">Next</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">wall</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">wall</span><span class="o">.</span><span class="n">top</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="k">def</span> <span class="nf">fake_black</span><span class="p">(</span><span class="n">wall</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">wall</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">Next</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">wall</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">wall</span><span class="o">.</span><span class="n">top</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="k">class</span> <span class="nc">WallLeftWhiteRightWhite</span><span class="p">(</span><span class="n">Wall</span><span class="p">):</span>
  <span class="n">left_wall</span> <span class="o">=</span> <span class="n">fake_white</span>
  <span class="n">right_wall</span> <span class="o">=</span> <span class="n">fake_white</span>

<span class="k">class</span> <span class="nc">WallLeftWhiteRightBlack</span><span class="p">(</span><span class="n">Wall</span><span class="p">):</span>
  <span class="n">left_wall</span> <span class="o">=</span> <span class="n">fake_white</span>
  <span class="n">right_wall</span> <span class="o">=</span> <span class="n">fake_black</span>

<span class="k">class</span> <span class="nc">WallLeftBlackRightWhite</span><span class="p">(</span><span class="n">Wall</span><span class="p">):</span>
  <span class="n">left_wall</span> <span class="o">=</span> <span class="n">fake_black</span>
  <span class="n">right_wall</span> <span class="o">=</span> <span class="n">fake_white</span>

<span class="k">class</span> <span class="nc">WallLeftBlackRightBlack</span><span class="p">(</span><span class="n">Wall</span><span class="p">):</span>
  <span class="n">left_wall</span> <span class="o">=</span> <span class="n">fake_black</span>
  <span class="n">right_wall</span> <span class="o">=</span> <span class="n">fake_black</span>

<span class="k">class</span> <span class="nc">Rule30</span><span class="p">(</span><span class="n">Wall</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cell&#39;</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">white</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>

  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">Next</span><span class="p">):</span>
    <span class="k">if</span><span class="p">((</span><span class="n">cell</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;black&#39;</span> <span class="ow">and</span>
        <span class="n">cell</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span> <span class="ow">or</span>
       <span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;white&#39;</span> <span class="ow">and</span>
        <span class="n">cell</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="s1">&#39;black&#39;</span><span class="p">)):</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">black</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">cell</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">top</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
</div>
<div class="section" id="running-and-visualizing-the-cellular-automata">
<span id="cellular-automata-running-and-visualizing-the-automata"></span><h3>Running and Visualizing the Cellular Automata<a class="headerlink" href="#running-and-visualizing-the-cellular-automata" title="Permalink to this headline">¶</a></h3>
<p>Now that we have all the parts we need let’s stitch them together and see what
happens.  We will build an automata using rule 30 with some white walls. Then we
will feed the automata into a canvas, and use the canvas to print a <cite>png</cite> file,
a <cite>pdf</cite> file and an <cite>mp4</cite> movie:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">generations</span> <span class="o">=</span> <span class="mi">200</span>

<span class="n">automata</span> <span class="o">=</span> <span class="n">OneDCellularAutomata</span><span class="p">(</span>
  <span class="n">generations</span><span class="o">=</span><span class="n">generations</span><span class="p">,</span>
  <span class="n">machine_cls</span><span class="o">=</span><span class="n">Rule30</span><span class="p">,</span>
  <span class="n">wall_cls</span><span class="o">=</span><span class="n">WallLeftWhiteRightWhite</span><span class="p">)</span>

<span class="n">ecosystem</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">automata</span><span class="p">)</span>
<span class="n">ecosystem</span><span class="o">.</span><span class="n">run_animation</span><span class="p">(</span><span class="n">generations</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># 100 ms</span>
<span class="n">eco</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;rule_30_white_walls_200_generations.mp4&#39;</span><span class="p">)</span>
<span class="n">eco</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;rule_30_white_walls_200_generations.pdf&#39;</span><span class="p">)</span>
<span class="n">eco</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;rule_30_white_walls_200_generations.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is the movie:</p>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/lB3oZ5DkPks" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center><p>Here is the <cite>pgn</cite> diagram, click on it to see the <cite>pdf</cite> version of the same picture:</p>
<a class="reference external image-reference" href="_static/rule_30_white_walls_200_generations.pdf"><img alt="_images/rule_30_white_walls_200_generations.png" class="align-center" src="_images/rule_30_white_walls_200_generations.png" /></a>
<p>Let’s try it with black walls</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">generations</span> <span class="o">=</span> <span class="mi">200</span>

<span class="n">automata</span> <span class="o">=</span> <span class="n">OneDCellularAutomata</span><span class="p">(</span>
  <span class="n">generations</span><span class="o">=</span><span class="n">generations</span><span class="p">,</span>
  <span class="n">machine_cls</span><span class="o">=</span><span class="n">Rule30</span><span class="p">,</span>
  <span class="n">wall_cls</span><span class="o">=</span><span class="n">WallLeftBlackRightBlack</span><span class="p">)</span>

<span class="n">ecosystem</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">automata</span><span class="p">)</span>
<span class="n">ecosystem</span><span class="o">.</span><span class="n">run_animation</span><span class="p">(</span><span class="n">generations</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>  <span class="c1"># 50 ms</span>
<span class="n">eco</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;rule_30_black_walls_200_generations.mp4&#39;</span><span class="p">)</span>
<span class="n">eco</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;rule_30_black_walls_200_generations.pdf&#39;</span><span class="p">)</span>
<span class="n">eco</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;rule_30_black_walls_200_generations.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is a <a class="reference external" href="https://www.youtube.com/watch?v=qSsddlg9o2M&amp;feature=youtu.be">link</a> to the resulting video, and below you can see what happens when we run 200 generations of rule 30 with black walls.</p>
<a class="reference external image-reference" href="_static/rule_30_black_walls_200_generations.pdf"><img alt="_images/rule_30_black_walls_200_generations.png" class="align-center" src="_images/rule_30_black_walls_200_generations.png" /></a>
<p><a class="reference external" href="https://youtu.be/r24NV8vQPKc">Running it again for 500 generations</a> and with white walls results in this:</p>
<a class="reference external image-reference" href="_static/rule_30_white_walls_500_generations.pdf"><img alt="_images/rule_30_white_walls_500_generations.png" class="align-center" src="_images/rule_30_white_walls_500_generations.png" /></a>
<p>On this diagram we can see order imposing itself from the left white wall, and a <a class="reference external" href="https://blog.stephenwolfram.com/data/uploads/2017/05/5.png">kind of repeating pattern on the left side of the triangle</a> which emerges from our initial conditions.  The center and right part of the results seem to be full of disorder.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>On limitations:</p>
<p>The pdf resulting from the 500 generation run of our automata is over 5 MB;
this is a lot of data to add to your computer if you want to clone the miros
library, so I will refrain from going bigger.</p>
<p class="last">It took a long time to render the 500 generation automata.  I don’t know
where the computational bottle-neck is coming from; if it were important to
me I could profile the different parts of the code until I found my issue,
but the issue could be Python itself.  Mathematica has no such obvious
limitation. If you want to do a deep dive into this subject and don’t have
the resources to buy a Mathematica licence, you can buy a Raspberry Pi with
the NOOBs OS, then VNC onto the device from your desktop.  Wolfram Alpha is
being given away on this platform.</p>
</div>
</div>
<div class="section" id="the-nothing-n-phenomenon">
<span id="cellular-automata-the-nothing"></span><h3>The Nothing (n-phenomenon)<a class="headerlink" href="#the-nothing-n-phenomenon" title="Permalink to this headline">¶</a></h3>
<p>The white and black walls force order into the automata; causing a kind of
pattern crystallization to propagate across our results.  We lose the incredible
complexity of rule 30, to this ordering pattern, which I think of as the
<a class="reference external" href="https://www.youtube.com/watch?v=_-5QTdC7hOo">nothing</a>. Order imposes itself
like a prion does in the brain of someone with Alzheimer’s.  We have seen that
this effect takes place with both white and black walls, the key is that there
is an inflexible minority on the walls, imposing itself on a flexible majority.
(Nassim Nicholas Taleb calls this kind of thing <a class="reference external" href="https://medium.com/incerto/the-most-intolerant-wins-the-dictatorship-of-the-small-minority-3f1f83ce4e15">a normalization</a>.)</p>
<p>I will call this destructive ordering, the n-phenomenon.</p>
<p>Let’s study it in a bit more detail.  I will shrink the width of our graphing
paper to 30 cells and watch the n-phenomenon completely destroy rule 30’s beautiful
complexity over 100 generations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">generations</span> <span class="o">=</span> <span class="mi">100</span>

 <span class="n">automata</span> <span class="o">=</span> <span class="n">OneDCellularAutomata</span><span class="p">(</span>
   <span class="n">generations</span><span class="o">=</span><span class="n">generations</span><span class="p">,</span>
   <span class="n">machine_cls</span><span class="o">=</span><span class="n">Rule30</span><span class="p">,</span>
   <span class="n">wall_cls</span><span class="o">=</span><span class="n">WallLeftWhiteRightWhite</span><span class="p">,</span>
<span class="hll">   <span class="n">cells_per_generation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span>
 <span class="n">ecosystem</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">automata</span><span class="p">)</span>
 <span class="n">ecosystem</span><span class="o">.</span><span class="n">run_animation</span><span class="p">(</span><span class="n">generations</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>  <span class="c1"># 500 ms</span>
 <span class="n">eco</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;rule_30_white_walls_100_generations_width_30.mp4&#39;</span><span class="p">)</span>
</pre></div>
</div>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/oadp1sh69jE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center><p>It seems that the n-phenomenon has a pattern velocity; resulting in an angle.
My protractor tells me that the ordered crystallization, caused by the white
minority at the wall, spreads downward at an angle of about 20 degrees.</p>
<p>If we reduce the width of the graphing paper, this pattern seems to
advance quicker into the chaos:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">generations</span> <span class="o">=</span> <span class="mi">100</span>

 <span class="n">automata</span> <span class="o">=</span> <span class="n">OneDCellularAutomata</span><span class="p">(</span>
   <span class="n">generations</span><span class="o">=</span><span class="n">generations</span><span class="p">,</span>
   <span class="n">machine_cls</span><span class="o">=</span><span class="n">Rule30</span><span class="p">,</span>
   <span class="n">wall_cls</span><span class="o">=</span><span class="n">WallLeftWhiteRightWhite</span><span class="p">,</span>
<span class="hll">   <span class="n">cells_per_generation</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span>
 <span class="n">ecosystem</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">automata</span><span class="p">)</span>
 <span class="n">ecosystem</span><span class="o">.</span><span class="n">run_animation</span><span class="p">(</span><span class="n">generations</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>  <span class="c1"># 500 ms</span>
 <span class="n">eco</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;rule_30_white_walls_100_generations_width_30.mp4&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Compare the 30 cell width result to the 15 cell width result:</p>
<center>
<div style="float:left;">
<iframe width="330" height="315" src="https://www.youtube.com/embed/oadp1sh69jE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>

<div style="float:left;">
<iframe width="330" height="315" src="https://www.youtube.com/embed/IVLnbYamjXk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
<div style="clear:both;"></div>
</center><p>Let’s try going thinner, here is a 15 cell width result beside a 10 cell width result:</p>
 <center>

 <div style="float:left;">
 <iframe width="330" height="315" src="https://www.youtube.com/embed/IVLnbYamjXk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
 </div>
 <div style="float:left;">
<iframe width="330" height="315" src="https://www.youtube.com/embed/whmwZEoYDz8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
 </div>
 <div style="clear:both;"></div>
 </center><p>So the angle of the n-phenomenon does not necessarily shrink with a reduction in
the graphing paper’s width.</p>
<p>Let’s write some code that can calculate the angle of the n-phenomenon.</p>
<p>We will set the walls to be white and the initial condition is a single black
rule 30 machine, sandwiched between other rule 30 machines started in the white
state:</p>
<a class="reference external image-reference" href="_static/rule_30_twodcellularautomata_with_angle.pdf"><div align="center" class="align-center"><img alt="_images/rule_30_twodcellularautomata_with_angle.svg" src="_images/rule_30_twodcellularautomata_with_angle.svg" /></div>
</a>
<p>The blue object in the diagram represents the disordered part of a rule 30
simulation contained by white walls.  The cyan circle is the angle, in degrees, we are
searching for.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OneDCellularAutomataWithAngleDiscovery</span><span class="p">(</span><span class="n">OneDCellularAutomata</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
      <span class="n">generations</span><span class="p">,</span>
      <span class="n">cells_per_generation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="n">initial_condition_index</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="n">machine_cls</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="n">wall_cls</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
      <span class="n">generations</span><span class="p">,</span>
      <span class="n">cells_per_generation</span><span class="p">,</span>
      <span class="n">initial_condition_index</span><span class="p">,</span>
      <span class="n">machine_cls</span><span class="p">,</span>
      <span class="n">wall_cls</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">black_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Black</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">white_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">White</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
       <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">white_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">black_mask</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_angle</span> <span class="o">=</span> <span class="mi">90</span>

  <span class="k">def</span> <span class="nf">build_next_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_mask</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">White</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">n_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">black_mask</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">n_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">white_mask</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">update_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="n">previous_generation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">row_to_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Z</span><span class="p">[</span><span class="n">previous_generation</span><span class="p">]</span>
    <span class="n">sub_row_to_check</span> <span class="o">=</span> <span class="n">row_to_check</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_mask</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_mask</span><span class="p">,</span> <span class="n">sub_row_to_check</span><span class="p">):</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">nothing_at_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generations</span><span class="o">-</span><span class="n">previous_generation</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="n">adjacent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nothing_at_row</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells_per_generation</span> <span class="o">/</span> <span class="mf">2.0</span>
      <span class="n">opposite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells_per_generation</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">n_angle</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">opposite</span><span class="o">/</span><span class="n">adjacent</span><span class="p">))</span>

      <span class="bp">self</span><span class="o">.</span><span class="n">build_next_mask</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">next_generation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">next_generation</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_angle</span><span class="p">()</span>
</pre></div>
</div>
<p>With this code we can plot how the angle of the n-phenomenon changes as a
function of the graphing paper width:</p>
<a class="reference external image-reference" href="_static/cells_per_generation_vrs_angle_of_n_phenomenon.pdf"><div align="center" class="align-center"><img alt="_images/cells_per_generation_vrs_angle_of_n_phenomenon.svg" src="_images/cells_per_generation_vrs_angle_of_n_phenomenon.svg" /></div>
</a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The angle is still an approximation, since as you will see shortly, the
n-phenomenon is not a straight line.</p>
</div>
<p>Here is a video of 196 different renderings of rule thirty within white walls.
The video starts with 2 rule 30 machines squished between two white walls.
For each frame advance of the video, a cell is added to the width of the
graphing paper and the automata is restarted an run with a black machine
at the top and middle of the simulation.</p>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/8aHWeo_dgs0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center><p>The top part of the video remains constant as the width of the graphing paper
expands, which makes sense, since that part of the diagram experiences the same
set of initial conditions.  What is surprising is how avalanches perpetuate
through the diagram as the width of the graphing paper increases.  The left side
will cause an avalanche for two frames, then the right side will cause an
avalanche for two frames, then the left side again and so on and so forth.</p>
<p>You can see when the patterns are going to shift by watching for the “left white
_|” and the “black right L”.  If either of these mini-patterns appear, it will
tell you that the avalanche on their side of the diagram is over, and to move
your eyes to the other side of the page for the next frame.</p>
<p>As tempting as it is to think that this 2 beat oscillation is a feature of the
automata, it probably isn’t.  The 2 beat oscillation is the result of the
divide-by-2-and-round-the-result mixed with the
expansion-of-the-size-of-the-page.  Essentially we are changing the initial
conditions on one side of the page for 2 beats, then the other side for two
beats.  Because rule 30 creates a chaotic system that is highly sensitive to its
initial conditions we have avalanches of change in response to a new
partial-starting-state. The initial conditions remain the same for the top part
of the diagram, but are expressed when the rule 30 body hits the new wall
condition.</p>
<p>The video makes me think about time traveling stories.  If we imagine the new
starting condition as the location of a time traveler arriving in the past from
the future (to change one thing and then leave), we can see how he effects
history as the change-avalanche on his side of the video frame.  The entire past
isn’t changed, just the side that was within the causal cone of his avalanche.</p>
<p>The rule 30 states only one square can be effected each generation; so the
maximum theoretical propagation of a historical distortion is 45 degrees.  In
our reality we also have such a causal limitation, it is the speed of light, c.</p>
<p>Here is another video of 196 different renderings with a white left wall and
black right wall:</p>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/DtDaKKeOsOg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center><p>Black left, white right wall:</p>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/gO-Y6UfMj70" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center><p>Left and right walls set to black:</p>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/z1R8-gZd5wQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center></div>
</div>
</div>
<div class="section" id="random-number-generation">
<h1>Random Number Generation<a class="headerlink" href="#random-number-generation" title="Permalink to this headline">¶</a></h1>
<p>Let’s try and build a random number generator using a simple Python program.</p>
<p>First we should discuss our constraints.  Rule 30 provides an interesting
chaotic phenomenon, we would like to use this rule versus another rule, or we
may accidentally lose our ability to generate chaos.  If we make our graphing
paper very wide, then we need more computer memory and more computing resources
to construct the next generation of automata.  If we use walls, then we have
order imposing itself back into the body of the chaos, as the n-phenomenon, over
only a few generations.  Even if we can perfectly manage this n-phenomenon,
there are only so many permutations that can be held within the bounds of our
rectangle, and if we repeat a pattern we are not generating a random number, but
rather a long periodic number; a pseudo-random number.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Our universe seems to have set rules (the laws of physics) but it will not run
into this n-phenomenon, repetition issue; because it doesn’t seem to be
confined within walls or have limited memory: the universe is expanding at an
accelerating rate.</p>
<p class="last">Maybe it would have been wiped out by an n-phenomenon if it weren’t expanding.</p>
</div>
<p>So there seems to be a theoretical upper bound to what we can generate using
limited memory given that the rule doesn’t change and the state of the program
is held within a bounded rectangle. My first guess at what our upper bound is:
<code class="docutils literal notranslate"><span class="pre">2**n</span></code> where <code class="docutils literal notranslate"><span class="pre">n</span></code> is the number of states within the rectangle, and the <code class="docutils literal notranslate"><span class="pre">2</span></code>
is selected because we are only tracking two colors, black and white.</p>
<p>First things first, let’s deal with the n-phenomenon coming from the walls.  We
have control of the walls, and we have a chaos generator, so let’s feed the
chaos back into the walls.  Let’s make <a class="reference external" href="https://www.youtube.com/watch?v=ZuvK-od647c">some spooky action at a
distance</a>:</p>
<a class="reference external image-reference" href="_static/rule_30_chaos_to_walls_1.pdf"><div align="center" class="align-center"><img alt="_images/rule_30_chaos_to_walls_1.svg" src="_images/rule_30_chaos_to_walls_1.svg" /></div>
</a>
<p>We can write the colors of our center column into a deque, and use the top two
colors of this deque to set the color of the walls.  Let’s call this deque the
<code class="docutils literal notranslate"><span class="pre">core_colors</span></code>.  To begin with we set all of the <code class="docutils literal notranslate"><span class="pre">core_colors</span></code> to white, so
that the walls will remain white for the first <code class="docutils literal notranslate"><span class="pre">len(core_colors)</span></code> generations.
For every <code class="docutils literal notranslate"><span class="pre">Next</span></code> event, the <code class="docutils literal notranslate"><span class="pre">core_colors</span></code> deque is pushed one spot downward
into the center of our automata, where it is painted with the color of the core
at that spot.</p>
<p>We will use the last two elements of our <code class="docutils literal notranslate"><span class="pre">core_colors</span></code> to determine the color
of our walls.  These last two spots will act as a 2 digit binary number, holding
the values of <code class="docutils literal notranslate"><span class="pre">WallLeftWhiteRightWhite</span></code>, <code class="docutils literal notranslate"><span class="pre">WallLeftWhiteRightBlack</span></code>,
<code class="docutils literal notranslate"><span class="pre">WallLeftBlackRightWhite</span></code> and <code class="docutils literal notranslate"><span class="pre">WallLeftBlackRightBlack</span></code>.  How this rule is
applied isn’t that important, it just has to consistently map the center’s chaos
onto the walls.</p>
<p>So, how long do we make this <code class="docutils literal notranslate"><span class="pre">core_colors</span></code> deque?  My intuition is to feed it
as much chaos as rule 30 can generate, then feed this back into the automata
before the n-phenomenon destroys the disorder.</p>
<p>Every intuition I have had so far about rule 30 has been wrong, so I’ll probably
be wrong about this too.  I need some way to measure if my prediction is correct
or incorrect</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Stephen Wolfram (2002). <a class="reference external" href="https://www.wolframscience.com/">A New Kind of Science.</a> (p27)</td></tr>
</tbody>
</table>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="index.html">
  <img class="logo_a" src="_static/miros_a.svg" width="250" alt="Logo" >
</a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Cellular Automata</a><ul>
<li><a class="reference internal" href="#design-and-code">Design and Code</a><ul>
<li><a class="reference internal" href="#canvas-class">Canvas Class</a></li>
<li><a class="reference internal" href="#the-onedcellularautomata-class">The OneDCellularAutomata Class</a></li>
<li><a class="reference internal" href="#rule30-and-the-wall-classes">Rule30 and the Wall Classes</a></li>
<li><a class="reference internal" href="#running-and-visualizing-the-cellular-automata">Running and Visualizing the Cellular Automata</a></li>
<li><a class="reference internal" href="#the-nothing-n-phenomenon">The Nothing (n-phenomenon)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#random-number-generation">Random Number Generation</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="examples.html">Examples</a><ul>
      <li>Previous: <a href="comprehensive.html" title="previous chapter">Comprehensive</a></li>
      <li>Next: <a href="singlechartexample.html" title="next chapter">Active Object Example</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/cellular_automata.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Scott Volk.
      
      |
      <a href="_sources/cellular_automata.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>