







<!DOCTYPE html>
<html  lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Orthogonal Regions | miros</title>
    <link rel="shortcut icon" href="_static/favicon.ico">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css">
    <link rel="stylesheet" href="_static/theme.css" type="text/css">
    
      
    <link rel="stylesheet" type="text/css" href="_static/css/miros_docs.css" />
      
    
    

    
    <script type="text/javascript" src="_static/theme.js" defer></script>
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    
    <script src="_static/jquery.js"></script>
    
    <script src="_static/underscore.js"></script>
    
    <script src="_static/doctools.js"></script>
    
    <script src="_static/language_data.js"></script>
    
    

    
      
      
    <link rel="index" title="Index" href="genindex.html">
      
      
    <link rel="search" title="Search" href="search.html">
      
      
      
    <link rel="next" title="Distributed Battery Charging" href="batterychargingexample.html">
      
      
    <link rel="prev" title="Using and Unwinding a Factory" href="towardsthefactoryexample.html">
      
    

    

    

    
  </head>

  <body>
    <header class="main-header">
      <div class="navbar">
        <div id="js-sidebar-mask" class="sidebar-mask"></div>
        <div id="js-sidebar-menu-button" class="sidebar-menu-button">
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg>
        </div>
        <a href="index.html" class="site-link">
          
          miros
          
        </a>
        <div class="navbar-links">
          <a href="installation.html" class="navbar-link">Docs</a>
          
          <a href="https://github.com/aleph2c/miros" class="navbar-link">GitHub</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg>
          
        </div>
      </div>
    </header>

    <main class="main-wrapper">
      
      <div id="js-main-sidebar" class="main-sidebar">
        
        <div class="sidebar-content sidebar-content--divider sidebar-navbar-links">
          <a href="https://github.com/aleph2c/miros" class="sidebar-navbar-link">GitHub</a>
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg>
        </div>
        
        
        <div class="sidebar-content sidebar-logo">
    <a href="index.html">
      <img class="logo" src="_static/miros_logo.svg" alt="miros" >
    </a>
</div>
        
        

<h2 class="sidebar-heading">Contents</h2>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="zero_to_one.html">Tutorial: Zero To One</a></li>
<li class="toctree-l1"><a class="reference internal" href="reading_diagrams.html">Diagrams</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="comprehensive.html">Comprehensive</a></li>
<li class="toctree-l2"><a class="reference internal" href="comprehensive.html#comprehensive-with-instrumentation">Comprehensive with Instrumentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="thread_safe_attributes.html">Thread Safe Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="scribbleexample.html">Hacking to Learn</a></li>
<li class="toctree-l2"><a class="reference internal" href="interactingcharts.html">Interacting Statecharts (Same Machine)</a></li>
<li class="toctree-l2"><a class="reference internal" href="towardsthefactoryexample.html">Using and Unwinding a Factory</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Orthogonal Regions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#constructing-orthogonal-regions-with-miros">Constructing Orthogonal Regions with Miros</a></li>
<li class="toctree-l3"><a class="reference internal" href="#high-level-strategy-to-build-orthogonal-regions-with-miros">High Level Strategy to Build Orthogonal Regions with miros</a></li>
<li class="toctree-l3"><a class="reference internal" href="#orthogonal-regions-using-orthogonal-components">Orthogonal Regions Using Orthogonal Components</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="batterychargingexample.html">Distributed Battery Charging</a></li>
<li class="toctree-l2"><a class="reference internal" href="cellular_automata.html">Cellular Automata</a></li>
<li class="toctree-l2"><a class="reference internal" href="i_mongol_example.html">Mongol Horse Archer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="reflection.html">Reflection</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns.html">Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
</ul>

        
        
<h2 class="sidebar-heading">Useful Links</h2>

<ul>
  <li><a href="https://github.com/aleph2c/py-activeobject">miros on github</a></li>
  <li><a href="https://github.com/aleph2c/sequence">sequence on github</a></li>
  <li><a href="https://aleph2c.github.io/miros-rabbitmq/index.html">miros-rabbitmq plugin</a></li>
  <li><a href="http://www.umlet.com">UMLet Download</a></li>
  <li><a href="http://www.inf.ed.ac.uk/teaching/courses/seoc/2005_2006/resources/statecharts.pdf">formalism explained</a></li>
</ul>


<h2 class="sidebar-heading">For Embedded</h2>

<ul>
  <li><a href="https://state-machine.com/">Quantum Leaps for Embedded</a></li>
  <li><a href="https://github.com/QuantumLeaps/">Quantum Leaps On Github</a></li>
</ul>


<h2 class="sidebar-heading">Statechart Videos</h2>

<ul>
  <li><a href="https://www.mathworks.com/videos/understanding-state-machines-what-are-they-1-of-4-90488.html">Part 1 (What)</a></li>
  <li><a href="https://www.mathworks.com/videos/understanding-state-machines-why-use-them-2-of-4-90489.html">Part 2 (Why)</a></li>
  <li><a href="https://www.mathworks.com/videos/understanding-state-machines-what-are-they-1-of-4-90488.html">Part 3 (Mealy/Moore)</a></li>
  <li><a href="https://www.mathworks.com/videos/understanding-state-machines-harel-state-machines-4-of-4-90491.html">Part 4 (Harel Statecharts)</a></li>
  <li><a href="https://barrgroup.com/Embedded-Systems/How-To/Introduction-Hierarchical-State-Machines">Introduction to HSMs</a></li>
</ul>
        
        

<div id="searchbox" style="display: none" role="search">
  <h2 id="searchlabel" class="sidebar-heading">Quick search</h2>
  <div class="searchformwrapper sidebar-content">
    <form class="search" action="search.html" method="get">
      <input class="sidebar-search sidebar-search--input" type="text" name="q" aria-labelledby="searchlabel"><input class="sidebar-search sidebar-search--btn" type="submit" value="Go">
    </form>
  </div>
</div>
<script>$('#searchbox').show(0);</script>

        
      </div>
      

      
      <div class="main-content main-content--sidebar">
      
        
          
  <div class="section" id="orthogonal-regions">
<span id="othogonalregions-othogonal-regions-with-miros"></span><h1>Orthogonal Regions<a class="headerlink" href="#orthogonal-regions" title="Permalink to this headline">#</a></h1>
<p>The <a class="reference external" href="https://github.com/aleph2c/miros/blob/master/examples/xml_chart.py">code for this example</a> can be found here.</p>
<p>As your products scale and your designs get more complicated you will experience
<a class="reference external" href="https://www.coursera.org/lecture/system-validation-software-protocols/guidelines-to-avoid-the-state-space-explosion-problem-O5jEd">State space explosion</a>.
The number of states that are needed to make your system combinatorially mix so
that it becomes impractical to test all paths of possible behaviour.</p>
<p><strong>State space explosion</strong> also describes a situation where you can no longer
<em>comprehend</em> your design because it has become too complicated. Your chosen
design abstraction has been outpaced by the size of your problem, and you can’t
compress the picture of your system into a small enough diagram to understand
it.</p>
<p>This scale-to-bafflement rate is dependent upon your choice of abstraction.  It
will happen quickly if you use finite state machines as your primary design
tool.  You can hold it off a bit longer by switching to a hierarchical state
machine design approach; common behaviours are mapped into outer states, but
this can only take you so far.  At some point, you must chunk your design into
concurrent pieces that interact.</p>
<p>Concurrent state machines mix combinatorially, giving you an abstraction which
scales without needing pages and pages to draw out your idea.  Concurrent
statecharts give you <strong>state space compression</strong>.</p>
<p>David Harel’s original statechart paper addressed state space explosion by
inventing the <strong>orthogonal region</strong>.  Orthogonal regions pictorially describe
concurrency <em>within</em> an HSM.</p>
<p>But the orthogonal region abstraction was not supported in Miro Samek’s
statechart algorithm (used by this library), for performance
reasons.  Instead he offered up <a class="reference internal" href="patterns.html#patterns-orthogonal-component"><span class="std std-ref">orthogonal components</span></a>; HSMs acting as variables within other HSMs.</p>
<p>In this example, I will show you what an orthogonal region is and why you would
use it. Then we will map the orthogonal region behaviour into a Python program
using existing miros features.  We will be using the <a class="reference internal" href="patterns.html#patterns-orthogonal-component"><span class="std std-ref">orthogonal components</span></a> mixed with a Factory to satisfy an “orthogonal
regions” behavioural description written as part of the <a class="reference external" href="https://www.w3.org/TR/scxml/">SCXML standard</a>.</p>
<p>Our example will be instrumented so we can see it working as it runs.</p>
<p>The SCXML standard describes an orthogonal region statechart similar to this:</p>
<a class="reference external image-reference" href="_static/xml_chart_1.pdf"><img alt="_images/xml_chart_1.svg" class="scale-to-fit" src="_images/xml_chart_1.svg" /></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Click the above diagram to see a larger version.</p>
<p>The parallel <a class="reference external" href="https://www.w3.org/TR/scxml/#CoreIntroduction">CSXML parallel regions document</a> is full of mistakes, but
written well enough to describe how orthogonal regions should behave.</p>
</div>
<p>Let’s break the above UML diagram away from its supporting <a class="reference external" href="https://github.com/aleph2c/miros/blob/master/examples/xml_chart.xml">XML</a>:</p>
<a class="reference external image-reference" href="_static/xml_chart_2.pdf"><img alt="_images/xml_chart_2.svg" class="noscale-center" src="_images/xml_chart_2.svg" /></a>
<p>The dotted line describes two orthogonal regions within the <code class="docutils literal notranslate"><span class="pre">p</span></code> state which
will both become active when the <code class="docutils literal notranslate"><span class="pre">p</span></code> state is entered.  This means that when
the <code class="docutils literal notranslate"><span class="pre">p</span></code> state is entered, the init events will ensure that both <code class="docutils literal notranslate"><span class="pre">S11</span></code> and
<code class="docutils literal notranslate"><span class="pre">S21</span></code> will <em>both</em> become active states.  In the case that the statechart
receives a <code class="docutils literal notranslate"><span class="pre">to_outer</span></code> event while in the <code class="docutils literal notranslate"><span class="pre">p</span></code> state, the exit behaviour in
both orthogonal regions will be followed until the <code class="docutils literal notranslate"><span class="pre">p</span></code> state is exited:
<code class="docutils literal notranslate"><span class="pre">S11</span></code> exit code will run, the <code class="docutils literal notranslate"><span class="pre">S1</span> <span class="pre">Region</span></code> exit code will run, then the
<code class="docutils literal notranslate"><span class="pre">S21</span></code> exit code will run and the <code class="docutils literal notranslate"><span class="pre">S2</span> <span class="pre">Region</span></code> exit code will run.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>David Harel’s statechart paper does not describe regions as having entry and
exit conditions.  If you do not want to support such a thing (because they may
not appear in a standard), don’t add them to your design.</p>
</div>
<p>The power of the orthogonal region comes from its multiplicative feature.  The
number of state combinations within <code class="docutils literal notranslate"><span class="pre">p</span></code> is the product of the number of states
in each region: <code class="docutils literal notranslate"><span class="pre">3*3</span> <span class="pre">=</span> <span class="pre">9</span></code> (counting the final pseudostates):</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Active State combinations within <code class="docutils literal notranslate"><span class="pre">p</span></code> are:</p>
<p>(S11, S21)
(S11, S22)
(S11, S2_final)
(S12, S21)
(S12, S22)
(S12, S2_final)
(S1_final, S21)
(S1_final, S22)
(S1_final, S2_final)</p>
<p>This multiplicative property holds true for any concurrency mechanism,
whether it be concurrent statecharts (with publish/subscribe) or with the
orthogonal component pattern.</p>
</div>
<p>David Harel’s way of drawing concurrency fits nicely onto a diagram.  Moreover,
to have concurrency (with its multiplicative ability to compact design
complexity) in part of the design while having it go away in another part of the
design is a beautiful form of <strong>state space compression</strong>.</p>
<p>If you take the time to read the <a class="reference external" href="https://www.w3.org/TR/scxml/#CoreIntroduction">expected behaviour for orthogonal regions in
the CSXML standard</a> you will
see that a “final” event can be defined when all of the regions within <code class="docutils literal notranslate"><span class="pre">p</span></code>
have entered their final state (the circle with the black dot).  The diagram’s
<code class="docutils literal notranslate"><span class="pre">p_final</span></code> arrow describes what should happen when both the <code class="docutils literal notranslate"><span class="pre">S1</span></code> and <code class="docutils literal notranslate"><span class="pre">S2</span></code>
regions have finished.</p>
<div class="section" id="constructing-orthogonal-regions-with-miros">
<span id="othogonalregions-using-orthogonal-regions-with-miros"></span><h2>Constructing Orthogonal Regions with Miros<a class="headerlink" href="#constructing-orthogonal-regions-with-miros" title="Permalink to this headline">#</a></h2>
<p>We will write some Python code which maps the miros feature set onto this design
such that its behaviours match those described in the SCXML standard.</p>
<a class="reference external image-reference" href="_static/xml_chart_2.pdf"><img alt="_images/xml_chart_2.svg" class="noscale-center" src="_images/xml_chart_2.svg" /></a>
<p>We will verify that our design works by:</p>
<ul class="simple">
<li><p>starting the statechart and confirming it has moved into the <code class="docutils literal notranslate"><span class="pre">outer_state</span></code></p></li>
<li><p>posting a <code class="docutils literal notranslate"><span class="pre">to_p</span></code> event and confirm that both <code class="docutils literal notranslate"><span class="pre">S11</span></code> and <code class="docutils literal notranslate"><span class="pre">S21</span></code>
are eventually entered.</p></li>
<li><p>posting an <code class="docutils literal notranslate"><span class="pre">e4</span></code> and confirming that <code class="docutils literal notranslate"><span class="pre">S11</span></code> transitions into <code class="docutils literal notranslate"><span class="pre">S12</span></code> but that the
other active region remains in the <code class="docutils literal notranslate"><span class="pre">S21</span></code> state.</p></li>
<li><p>posting an <code class="docutils literal notranslate"><span class="pre">e1</span></code> and confirming that <code class="docutils literal notranslate"><span class="pre">S12</span></code> transitions into the S1 Region final
state and that <code class="docutils literal notranslate"><span class="pre">S12</span></code> transitions into <code class="docutils literal notranslate"><span class="pre">S22</span></code> in the S2 Region.</p></li>
<li><p>posting a <code class="docutils literal notranslate"><span class="pre">to_outer</span></code> and confirming that the two active states collapse into
one active state, and that all of the expected exit conditions are run;  In
Region S1, the S1 region exit condition is run and in Region S2, the exit
condition for <code class="docutils literal notranslate"><span class="pre">S22</span></code> is run then the exit condition for Region S2 is run.
After the <code class="docutils literal notranslate"><span class="pre">p</span></code> region has been exited, the statechart will ultimately land in
the <code class="docutils literal notranslate"><span class="pre">outer_state</span></code>.</p></li>
<li><p>re-posting <code class="docutils literal notranslate"><span class="pre">e4</span></code> and then <code class="docutils literal notranslate"><span class="pre">e1</span></code> with the same expected behaviour listed above.</p></li>
<li><p>posting an <code class="docutils literal notranslate"><span class="pre">e2</span></code> event which while S1 Region is in its final state and the S2
region is in its <code class="docutils literal notranslate"><span class="pre">S22</span></code> state.  This <code class="docutils literal notranslate"><span class="pre">e2</span></code> event will cause the S2 Region
to enter its final state too.  Since both final states have been entered, the
chart should post a <code class="docutils literal notranslate"><span class="pre">p_final</span></code> to itself.  This will cause the exit
conditions of the S1 Region and S2 Region to trigger, the two active states
will collapse into one.  The <code class="docutils literal notranslate"><span class="pre">p_final</span></code> event will cause a transition into
the <code class="docutils literal notranslate"><span class="pre">some_other_state</span></code> who’s entry condition should trigger.</p></li>
</ul>
<p>We would like the statechart to describe its behaviour in a log file, so that we can
confirm it is working.</p>
<p>The design should be sub-classable in the case that we want to change its
behaviour.</p>
<p>As far as I know there is no UML shorthand for two final states in a orthogonal
region conspiring to post an event to itself, so our design diagram will
explicitly describe this behaviour in code.</p>
</div>
<div class="section" id="high-level-strategy-to-build-orthogonal-regions-with-miros">
<span id="othogonalregions-high-level-strategy-to-build-orthogonal-regions-with-miros"></span><h2>High Level Strategy to Build Orthogonal Regions with miros<a class="headerlink" href="#high-level-strategy-to-build-orthogonal-regions-with-miros" title="Permalink to this headline">#</a></h2>
<a class="reference external image-reference" href="_static/xml_chart_2.pdf"><img alt="_images/xml_chart_2.svg" class="noscale-center" src="_images/xml_chart_2.svg" /></a>
<p>The statechart will have one thread, and the orthogonal regions described within
<code class="docutils literal notranslate"><span class="pre">p</span></code> will be driven by this thread using the orthogonal component pattern.
Each region will be an object derived from the <code class="docutils literal notranslate"><span class="pre">HsmWithQueues</span></code> class, which
provides all of the HSM dynamics and access to the <code class="docutils literal notranslate"><span class="pre">post_fifo</span></code> and
<code class="docutils literal notranslate"><span class="pre">complete_circuit</span></code> methods.  While in the <code class="docutils literal notranslate"><span class="pre">p</span></code> state, the outer statechart
will dispatch <code class="docutils literal notranslate"><span class="pre">e1</span></code>, <code class="docutils literal notranslate"><span class="pre">e2</span></code> and <code class="docutils literal notranslate"><span class="pre">e4</span></code> by posting into the queues of the S1
Region and the S2 Region.</p>
<p>Each Region will be given an <code class="docutils literal notranslate"><span class="pre">outer</span></code> and a <code class="docutils literal notranslate"><span class="pre">regions</span></code> attribute.  The
<code class="docutils literal notranslate"><span class="pre">outer</span></code> attribute will be a reference to the outer statechart running the
thread, which will be an object derived from the Factory class.  Using this
<code class="docutils literal notranslate"><span class="pre">outer</span></code> attribute, either region can post an event back into its outer
statechartThis will be needed for the <code class="docutils literal notranslate"><span class="pre">p_final</span></code> signal to work.  The
<code class="docutils literal notranslate"><span class="pre">regions</span></code> attribute will contain references to the other regions sharing the
same orthogonal region area of the chart.  Information about the other region’s
final state will be needed to determine if it is time to post the <code class="docutils literal notranslate"><span class="pre">p_final</span></code>
event into the <code class="docutils literal notranslate"><span class="pre">outer</span></code> statechart.  The <code class="docutils literal notranslate"><span class="pre">outer</span></code> attribute will also be used
by a region to channel its instrumentation stream back into the main
statechart’s instrumentation stream.</p>
<p>Two hidden states will be constructed, one for each region.  This is needed so
that the regions can exit without re-triggering their <code class="docutils literal notranslate"><span class="pre">init</span></code> signals.  For
instance if Region S2 was in <code class="docutils literal notranslate"><span class="pre">S22</span></code> when outer chart received a <code class="docutils literal notranslate"><span class="pre">to_outer</span></code>
event, we would expect this region to run its <code class="docutils literal notranslate"><span class="pre">S22</span></code> exit condition, then run
the Region S2 exit condition then <em>stop</em>.  However, if we only caused a
transition into the Region S2 state, the region’s init signal would re-fire and
the region would enter the <code class="docutils literal notranslate"><span class="pre">S21</span></code> state.  This is not what we want, so we
invent a hidden outer state for the region.  To get the desired exit behaviours
resulting from the <code class="docutils literal notranslate"><span class="pre">to_outer</span></code> event we trigger a second, hidden-event which
will cause a transition into the hidden outer state for the region.  By doing
this the exit conditions for a region will work as expected.</p>
<p>To make the instrumentation legible, we will wrap some code around the
<code class="docutils literal notranslate"><span class="pre">spy_on</span></code> decorator used to instrument the S1 and S2 regions. This code will
route a region’s spy instrumentation into the main statechart’s spy instrumentation
stream.  Since we are doing this we can remove any references to hidden outer
states to avoid cluttering up our spy stream.  The instrumentation will be written
to a log file by registering a spy function handler with the main state chart.</p>
<p>The code used to start the chart, and its regions will be written as a method
of the main statechart.  Each of the regions will be pre-started in their hidden
states to keep the code needed to enter the <code class="docutils literal notranslate"><span class="pre">p</span></code> state as simple as possible.
By pulling the start code out of the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method of the main chart, we
can subclass the main chart without starting its thread when <code class="docutils literal notranslate"><span class="pre">super</span></code> is called
within the subclass’ <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method.</p>
</div>
<div class="section" id="orthogonal-regions-using-orthogonal-components">
<span id="othogonalregions-miros-design"></span><h2>Orthogonal Regions Using Orthogonal Components<a class="headerlink" href="#orthogonal-regions-using-orthogonal-components" title="Permalink to this headline">#</a></h2>
<p>The behaviour described with this diagram:</p>
<a class="reference external image-reference" href="_static/xml_chart_2.pdf"><img alt="_images/xml_chart_2.svg" class="noscale-center" src="_images/xml_chart_2.svg" /></a>
<p>Can be manifested this way using miros:</p>
<a class="reference external image-reference" href="_static/xml_chart_3.pdf"><img alt="_images/xml_chart_3.svg" class="scale-to-fit" src="_images/xml_chart_3.svg" /></a>
<p>If you would like to compare the diagram to the code, the <a class="reference external" href="https://github.com/aleph2c/miros/blob/master/examples/xml_chart.py">code is
available here</a>.</p>
<p>To run the code:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3 ./examples/xml_chart.py
</pre></div>
</div>
<p>This will generate an instrumentation stream in <code class="docutils literal notranslate"><span class="pre">xml_chart.log</span></code>.</p>
<p>To view the instrumentation as the code is running:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tail -f ./examaples/xml_chart.log.
</pre></div>
</div>
<p>Now I will do a walk through of the code starting from the orthogonal regions
then I will talk about the XMLChart (right to left on the diagram).</p>
<div class="section" id="orthogonal-components-as-regions">
<span id="othogonalregions-orthogonal-components-as-regions"></span><h3>Orthogonal Components As Regions<a class="headerlink" href="#orthogonal-components-as-regions" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Regions</span></code> class will be derived from the <code class="docutils literal notranslate"><span class="pre">HsmWithQueues</span></code> class.</p>
<a class="reference external image-reference" href="_static/xml_chart_4.pdf"><img alt="_images/xml_chart_4.svg" class="scale-to-fit" src="_images/xml_chart_4.svg" /></a>
<p>The two region orthogonal components will be constructed in the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method of the
<code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="k">class</span> <span class="nc">XmlChart</span><span class="p">(</span><span class="n">InstrumentedFactory</span><span class="p">):</span>
   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">live_trace</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">live_spy</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">live_trace</span><span class="o">=</span><span class="n">live_trace</span><span class="p">,</span> <span class="n">live_spy</span><span class="o">=</span><span class="n">live_spy</span><span class="p">)</span>

<span class="hll">   <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class="hll">   <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span class="hll">     <span class="n">Region</span><span class="p">(</span>
</span><span class="hll">       <span class="n">name</span><span class="o">=</span><span class="s1">&#39;s1_r&#39;</span><span class="p">,</span>
</span><span class="hll">       <span class="n">starting_state</span><span class="o">=</span><span class="n">s1_hidden_region</span><span class="p">,</span>
</span><span class="hll">       <span class="n">outer</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span class="hll">       <span class="n">final_event</span><span class="o">=</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">p_final</span><span class="p">),</span>
</span><span class="hll">     <span class="p">)</span>
</span><span class="hll">   <span class="p">)</span>
</span><span class="hll">   <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span class="hll">     <span class="n">Region</span><span class="p">(</span>
</span><span class="hll">       <span class="n">name</span><span class="o">=</span><span class="s1">&#39;s2_r&#39;</span><span class="p">,</span>
</span><span class="hll">       <span class="n">starting_state</span><span class="o">=</span><span class="n">s2_hidden_region</span><span class="p">,</span>
</span><span class="hll">       <span class="n">outer</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
</span><span class="hll">       <span class="n">final_event</span><span class="o">=</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">p_final</span><span class="p">),</span>
</span><span class="hll">     <span class="p">)</span>
</span><span class="hll">   <span class="p">)</span>
</span><span class="hll">   <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="p">:</span>
</span><span class="hll">     <span class="k">for</span> <span class="n">_region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="p">:</span>
</span><span class="hll">       <span class="n">region</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_region</span><span class="p">)</span>
</span>   <span class="c1"># ...</span>
</pre></div>
</div>
<p>Each region will have to have a reference to its outer state chart and a
reference to all regions.  You can see this in the UML diagram as white-diamond
arrows (Aggregation arrows in UML-speak).  The white diamond arrow describes a
“has a” relationship:  A region “has many” other regions and “has an” outer
state chart.  These relationships are established in the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> code of
the <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> which constructs each region object (see the above listing).</p>
<p>The reference to the other regions is needed to determine if all regions are in
their final state.  If they are, then <code class="docutils literal notranslate"><span class="pre">p_final</span></code> event must be placed in the
outer statechart’s event queue.  To do this a reference to the outer statechart
is required.</p>
<p>A region’s state machine will be defined in the flat method style and will be
instrumented with the <code class="docutils literal notranslate"><span class="pre">&#64;instrumented</span></code> decorator which will be <a class="reference internal" href="#othogonalregions-instrumentation"><span class="std std-ref">described
shortly</span></a>.</p>
<a class="reference external image-reference" href="_static/xml_chart_5.pdf"><img alt="_images/xml_chart_5.svg" class="noscale-center" src="_images/xml_chart_5.svg" /></a>
<p>Here is the S1 Region’s HSM code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@instrumented</span>
<span class="k">def</span> <span class="nf">s1_hidden_region</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;A hidden state which permits the exit feature of the</span>
<span class="sd">     s1_region to work.</span>

<span class="sd">    **Note**:</span>
<span class="sd">       This will not appear in the spy instrumentation</span>

<span class="sd">    **Args**:</span>
<span class="sd">       | ``p`` (HsmWithQueues): Hsm with queues with no thread</span>
<span class="sd">       | ``e`` (Event): event</span>


<span class="sd">    **Returns**:</span>
<span class="sd">       (type): return_status</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">to_p</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">s1_region</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">top</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="nd">@instrumented</span>
<span class="k">def</span> <span class="nf">s1_region</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">region_exit</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">s1_hidden_region</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">s1_hidden_region</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="nd">@instrumented</span>
<span class="k">def</span> <span class="nf">s11</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">e4</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">s12</span><span class="p">)</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">s1_region</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="nd">@instrumented</span>
<span class="k">def</span> <span class="nf">s12</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">e1</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">s1_region_final</span><span class="p">)</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">s1_region</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="nd">@instrumented</span>
<span class="k">def</span> <span class="nf">s1_region_final</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">r</span><span class="o">.</span><span class="n">post_p_final_to_outer_if_ready</span><span class="p">()</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">r</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">s1_region</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>The S2 Region state machine will be very similar to the above listing.</p>
<p>To start the regions, code will be added to the <code class="docutils literal notranslate"><span class="pre">start</span></code> method of the
<code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> class such that the <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> can be instantiated, <em>then</em> started like
this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">example</span> <span class="o">=</span> <span class="n">XmlChart</span><span class="p">(</span>
  <span class="s1">&#39;parallel&#39;</span><span class="p">,</span> <span class="n">live_spy</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">live_trace</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> <code class="docutils literal notranslate"><span class="pre">start</span></code> method will look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="p">:</span>
    <span class="n">region</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">starting_state</span><span class="p">)</span>

  <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer_state</span><span class="p">)</span>
  <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
<p>The reason that the <code class="docutils literal notranslate"><span class="pre">start_at</span></code> methods are broken out of the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> call
is to make the <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> subclassable.  It is important to tease apart the
class definition from code that starts a thread, otherwise the <code class="docutils literal notranslate"><span class="pre">super</span></code> keyword
can become <a class="reference internal" href="recipes.html#recipes-inheritance-and-starting-factories"><span class="std std-ref">very dangerous later on</span></a>.
We don’t want to call the <code class="docutils literal notranslate"><span class="pre">start_at</span></code> method from within the main function,
since we are trying to data-hide how the state machine works.</p>
<p>As previously mentioned, we pre-start the orthogonal regions into their hidden
states before they are needed to keep the <code class="docutils literal notranslate"><span class="pre">p</span></code> entry state code simple within
the <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> state machine.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Regions</span></code> class contains a name, a starting state so that a subclass
can change how it is used, a final_event so that the <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> class can
tell its components what event to fire when they are done.   It has an
instrumented attribute which can be set to False once we know the chart works
and we want to speed up the code and a <code class="docutils literal notranslate"><span class="pre">final</span></code> bool used to track if the
component is in its final state.  The regions list will contain a list to all
regions within <code class="docutils literal notranslate"><span class="pre">p</span></code>, including a reference to itself.</p>
<a class="reference external image-reference" href="_static/xml_chart_4.pdf"><img alt="_images/xml_chart_4.svg" class="scale-to-fit" src="_images/xml_chart_4.svg" /></a>
<p>Here is the <code class="docutils literal notranslate"><span class="pre">Region</span></code> class code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Region</span><span class="p">(</span><span class="n">HsmWithQueues</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">,</span> <span class="n">starting_state</span><span class="p">,</span> <span class="n">outer</span><span class="p">,</span> <span class="n">final_event</span><span class="p">,</span> <span class="n">instrumented</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Region management for othogonal regions</span>

<span class="sd">    **Args**:</span>
<span class="sd">       | ``name`` (str): name of the region</span>
<span class="sd">       | ``starting_state`` (str): name of the starting</span>
<span class="sd">       |   state of the region</span>
<span class="sd">       | ``outer`` (Factory): The statechart which will be</span>
<span class="sd">       |   using this region.</span>
<span class="sd">       | ``final_event`` (Event): The event used to finalize</span>
<span class="sd">       |   the region.</span>
<span class="sd">       | ``instrumented=True`` (bool): Need if you want to</span>
<span class="sd">       |   view the spy instrumention</span>

<span class="sd">    **Returns**:</span>
<span class="sd">       (Region): a region in the statechart</span>

<span class="sd">    **Example(s)**:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">      self.s1_region = Region(</span>
<span class="sd">        &#39;s1_r&#39;,</span>
<span class="sd">        outer=self,</span>
<span class="sd">        final_event=Event(signal=signals.p_final),</span>
<span class="sd">      )</span>
<span class="sd">      self.p_regions.append(self.s1_region)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">starting_state</span> <span class="o">=</span> <span class="n">starting_state</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">outer</span> <span class="o">=</span> <span class="n">outer</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">final_event</span> <span class="o">=</span> <span class="n">final_event</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">instrumented</span> <span class="o">=</span> <span class="n">instrumented</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">final</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="k">def</span> <span class="nf">post_p_final_to_outer_if_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">ready</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="bp">True</span>
    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">:</span>
      <span class="n">ready</span> <span class="o">&amp;=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">region</span><span class="o">.</span><span class="n">final</span> <span class="k">else</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">ready</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_event</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">post_p_final_to_outer_if_ready</span></code> worker function, iterates through all of
the regions and if they are all in a final state will post the final_event,
<code class="docutils literal notranslate"><span class="pre">p_final</span></code> provided by an argument to the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> function.  It is within
this worker function that we see how a region references other regions and uses
its reference to the outer statechart to post events to it.</p>
</div>
<div class="section" id="the-instrumentedfactory">
<span id="othogonalregions-the-instrumentedfactory"></span><h3>The InstrumentedFactory<a class="headerlink" href="#the-instrumentedfactory" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> subclasses from the <code class="docutils literal notranslate"><span class="pre">InstrumentedFactory</span></code>.</p>
<a class="reference external image-reference" href="_static/xml_chart_8.pdf"><img alt="_images/xml_chart_8.svg" class="noscale-center" src="_images/xml_chart_8.svg" /></a>
<p>The <code class="docutils literal notranslate"><span class="pre">InstrumentedFactory</span></code> instruments a miros factory class.  It creates an
<code class="docutils literal notranslate"><span class="pre">xml_chart.log</span></code> file then registers a spy and trace callback handler for the
statechart to use.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">InstrumentedFactory</span><span class="p">(</span><span class="n">Factory</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">log_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">live_trace</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">live_spy</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">live_trace</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">live_trace</span> <span class="o">==</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">live_trace</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">live_spy</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">live_spy</span> <span class="o">==</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">live_spy</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">log_file</span> <span class="o">=</span> <span class="s1">&#39;xml_chart.log&#39;</span> <span class="k">if</span> <span class="n">log_file</span> <span class="o">==</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">log_file</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">clear_log</span><span class="p">()</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
      <span class="n">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1">:</span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
      <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="p">,</span>
      <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">register_live_spy_callback</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spy_callback</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">register_live_trace_callback</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace_callback</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">trace_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;trace without datetimestamp&#39;&#39;&#39;</span>
    <span class="n">trace_without_datetime</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\[.+\]) (\[.+\].+)&#39;</span><span class="p">,</span> <span class="n">trace</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;T: &quot;</span> <span class="o">+</span> <span class="n">trace_without_datetime</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">spy_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spy</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;spy with machine name pre-pending&#39;&#39;&#39;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">spy</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;S: [{}] {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">spy</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">clear_log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
      <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="main-statechart-as-xmlchart">
<span id="othogonalregions-main-statechart-as-xmlchart"></span><h3>Main Statechart as XMLChart<a class="headerlink" href="#main-statechart-as-xmlchart" title="Permalink to this headline">#</a></h3>
<p>We call our main chart the <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> because we are deriving its behaviour
from the SCXML specification.  It doesn’t actually consume or produce any XML.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> has two <code class="docutils literal notranslate"><span class="pre">Region</span></code> orthogonal components which it defines in
its <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method.</p>
<a class="reference external image-reference" href="_static/xml_chart_6.pdf"><img alt="_images/xml_chart_6.svg" class="scale-to-fit" src="_images/xml_chart_6.svg" /></a>
<p>Here is the XMLChart written as Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">XmlChart</span><span class="p">(</span><span class="n">InstrumentedFactory</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">live_trace</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">live_spy</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Example of othogonal regions described in the CSXML</span>
<span class="sd">       standard</span>

<span class="sd">    **Args**:</span>
<span class="sd">       | ``name`` (type1):</span>
<span class="sd">       | ``live_trace=None``: enable live_trace feature?</span>
<span class="sd">       | ``live_spy=None``: enable live_spy feature?</span>

<span class="sd">    **Returns**:</span>
<span class="sd">       (type):</span>

<span class="sd">    **Example(s)**:</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        example = XmlChart(</span>
<span class="sd">          &#39;parallel&#39;, live_spy=True, live_trace=True</span>
<span class="sd">        ).start()</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">live_trace</span><span class="o">=</span><span class="n">live_trace</span><span class="p">,</span> <span class="n">live_spy</span><span class="o">=</span><span class="n">live_spy</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
      <span class="n">Region</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;s1_r&#39;</span><span class="p">,</span>
        <span class="n">starting_state</span><span class="o">=</span><span class="n">s1_hidden_region</span><span class="p">,</span>
        <span class="n">outer</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">final_event</span><span class="o">=</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">p_final</span><span class="p">),</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
      <span class="n">Region</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;s2_r&#39;</span><span class="p">,</span>
        <span class="n">starting_state</span><span class="o">=</span><span class="n">s2_hidden_region</span><span class="p">,</span>
        <span class="n">outer</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">final_event</span><span class="o">=</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">p_final</span><span class="p">),</span>
      <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">_region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="p">:</span>
        <span class="n">region</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_region</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">outer_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">&quot;outer_state&quot;</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outer_state_entry_signal</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">to_p</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outer_state_to_p</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">to_method</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p_entry_signal</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">e1</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p_dispatcher</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">e2</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p_dispatcher</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">e4</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p_dispatcher</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">p_final</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p_p_final</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p_exit_signal</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">to_outer</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p_to_outer</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">to_method</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">some_other_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="s2">&quot;some_other_state&quot;</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">catch</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">,</span>
        <span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">some_other_state_entry_signal</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">to_method</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">nest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer_state</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">nest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outer_state</span><span class="p">)</span><span class="o">.</span> \
      <span class="n">nest</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">some_other_state</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">outer_state</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="p">:</span>
      <span class="n">region</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">starting_state</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">start_at</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer_state</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>

  <span class="k">def</span> <span class="nf">outer_state_entry_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
    <span class="k">return</span> <span class="n">status</span>

  <span class="k">def</span> <span class="nf">outer_state_to_p</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">status</span>

  <span class="k">def</span> <span class="nf">p_entry_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">p_dispatcher</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">to_p</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">status</span>

  <span class="k">def</span> <span class="nf">p_dispatcher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
<span class="hll">    <span class="p">[</span><span class="n">region</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="p">]</span>
</span><span class="hll">    <span class="p">[</span><span class="n">region</span><span class="o">.</span><span class="n">complete_circuit</span><span class="p">()</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="p">]</span>
</span>    <span class="k">return</span> <span class="n">status</span>

  <span class="k">def</span> <span class="nf">p_p_final</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">some_other_state</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">status</span>

  <span class="k">def</span> <span class="nf">p_exit_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">p_dispatcher</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">region_exit</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">status</span>

  <span class="k">def</span> <span class="nf">p_to_outer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">live_spy_callback</span><span class="p">(</span><span class="s2">&quot;to_outer:p&quot;</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outer_state</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">status</span>

  <span class="k">def</span> <span class="nf">some_other_state_entry_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
    <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>I have highlighted the two lines that will post events to the two orthogonal regions, then drive
those events through their respective HSMs.</p>
<p>Now that we see how the three HSMs are initialized and how they work, let’s compare them
to the orthogonal regions design presented at the beginning of this essay:</p>
<a class="reference external image-reference" href="_static/xml_chart_7.pdf"><img alt="_images/xml_chart_7.svg" class="scale-to-fit" src="_images/xml_chart_7.svg" /></a>
<p>We can mentally verify that the bottom design matches the top design by:</p>
<ul class="simple">
<li><p>starting the statechart and confirming it has moved into the <code class="docutils literal notranslate"><span class="pre">outer_state</span></code></p></li>
<li><p>posting a <code class="docutils literal notranslate"><span class="pre">to_p</span></code> event and confirm that both <code class="docutils literal notranslate"><span class="pre">S11</span></code> and <code class="docutils literal notranslate"><span class="pre">S21</span></code>
are eventually entered.</p></li>
<li><p>posting an <code class="docutils literal notranslate"><span class="pre">e4</span></code> and confirming that <code class="docutils literal notranslate"><span class="pre">S11</span></code> transitions into <code class="docutils literal notranslate"><span class="pre">S12</span></code> but that the
other active region remains in the <code class="docutils literal notranslate"><span class="pre">S21</span></code> state.</p></li>
<li><p>posting an <code class="docutils literal notranslate"><span class="pre">e1</span></code> and confirming that <code class="docutils literal notranslate"><span class="pre">S12</span></code> transitions into the S1 Region final
state and that <code class="docutils literal notranslate"><span class="pre">S12</span></code> transitions into <code class="docutils literal notranslate"><span class="pre">S22</span></code> in the S2 Region.</p></li>
<li><p>posting a <code class="docutils literal notranslate"><span class="pre">to_outer</span></code> and confirming that the two active states collapse into
one active state, and that all of the expected exit conditions are run;  In
Region S1, the S1 region exit condition is run and in Region S2, the exit
condition for <code class="docutils literal notranslate"><span class="pre">S22</span></code> is run then the exit condition for Region S2 is run.
After the <code class="docutils literal notranslate"><span class="pre">p</span></code> region has been exited, the statechart will ultimately land in
the <code class="docutils literal notranslate"><span class="pre">outer_state</span></code>.</p></li>
<li><p>re-posting <code class="docutils literal notranslate"><span class="pre">e4</span></code> and then <code class="docutils literal notranslate"><span class="pre">e1</span></code> with the same expected behaviour listed above.</p></li>
<li><p>posting an <code class="docutils literal notranslate"><span class="pre">e2</span></code> event which while S1 Region is in its final state and the S2
region is in its <code class="docutils literal notranslate"><span class="pre">S22</span></code> state.  This <code class="docutils literal notranslate"><span class="pre">e2</span></code> event will cause the S2 Region
to enter its final state too.  Since both final states have been entered, the
chart should post a <code class="docutils literal notranslate"><span class="pre">p_final</span></code> to itself.  This will cause the exit
conditions of the S1 Region and S2 Region to trigger, the two active states
will collapse into one.  The <code class="docutils literal notranslate"><span class="pre">p_final</span></code> event will cause a transition into
the <code class="docutils literal notranslate"><span class="pre">some_other_state</span></code> who’s entry condition should trigger.</p></li>
</ul>
</div>
<div class="section" id="instrumentation-hacking-the-spy-on-decorator">
<span id="othogonalregions-instrumentation"></span><h3>Instrumentation: Hacking the spy_on Decorator<a class="headerlink" href="#instrumentation-hacking-the-spy-on-decorator" title="Permalink to this headline">#</a></h3>
<p>We are mashing together a <code class="docutils literal notranslate"><span class="pre">Factory</span></code> and two <code class="docutils literal notranslate"><span class="pre">HsmWithQueues</span></code> derived-objects.
All of these objects can leave bread crumbs (spy streams) about what they have
done and when they did it.  We want these spy streams to be merged into one file
as all three objects are run together.</p>
<p>The <a class="reference internal" href="#othogonalregions-the-instrumentedfactory"><span class="std std-ref">InstrumentedFactory</span></a>
defines a <code class="docutils literal notranslate"><span class="pre">spy_callback</span></code>, which will be used by the <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> to write its
spy stream into a log file.  Our goal is to have each region write its spy
stream to this same log file.  Each region has a reference back to the
<code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> object, and the <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> is derived from the
<code class="docutils literal notranslate"><span class="pre">InstrumentedFactory</span></code> which means each region has a reference to the
<code class="docutils literal notranslate"><span class="pre">spy_callback</span></code>, which was defined by the <code class="docutils literal notranslate"><span class="pre">InstrumentedFactory</span></code>.  So we
should be able to grab information out of a region’s spy stream, adjust it, then
send it into the <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> spy stream as that information is being generated.
This way, the order of events will be preserved and we can retroactively confirm
our miros version of orthogonal regions is working as we would expect it to
work.</p>
<p>State methods used by an <code class="docutils literal notranslate"><span class="pre">HsmWithQueues</span></code> derived object (our regions) can be
instrumented by decorating them with the <code class="docutils literal notranslate"><span class="pre">spy_on</span></code> decorator provided by the
miros library.  The <code class="docutils literal notranslate"><span class="pre">spy_on</span></code> decorator is just a function wrapper.  So why
don’t we wrap this wrapper with another wrapper, and force it to write its spy
information back into its outer chart like so:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># ..</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">instrumented</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
  <span class="nd">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">_pspy_on</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">chart</span><span class="o">.</span><span class="n">instrumented</span><span class="p">:</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">spy_on</span><span class="p">(</span><span class="n">fn</span><span class="p">)(</span><span class="n">chart</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">rtc</span><span class="o">.</span><span class="n">spy</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;hidden_region&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
          <span class="n">chart</span><span class="o">.</span><span class="n">outer</span><span class="o">.</span><span class="n">live_spy_callback</span><span class="p">(</span>
            <span class="s2">&quot;{}::{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chart</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
      <span class="n">chart</span><span class="o">.</span><span class="n">rtc</span><span class="o">.</span><span class="n">spy</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">e</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">status</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">status</span>
  <span class="k">return</span> <span class="n">_pspy_on</span>
</pre></div>
</td></tr></table></div>
<p>The above decorator accepts a function as an argument, then returns a new
function that uses the original function within it.  This decorator will be used
to wrap flat-state functions used by our regions.</p>
<p>In our case, we wrap the original function with a <code class="docutils literal notranslate"><span class="pre">spy_on</span></code> call so that its
instrumentation data structures are filled (line 8).  Then we iterate over this
instrumentation information and send it to the <code class="docutils literal notranslate"><span class="pre">live_spy_callback</span></code> that we
registered by the <code class="docutils literal notranslate"><span class="pre">InstrumentedFactory</span></code> (lines 9-13).  The hidden states are
added to make exit features work in our version of the orthogonal regions, but
we don’t want to see anything about this in our spy stream, so we filter it out
with a regular expression (line 9-11).  When we are finished using the spy
information, we clear the list holding the instrumentation so that we don’t
write it out the next time this decorator is called (line 14).</p>
<p>Once we know our chart is working, we can improve its performance by turning off
its instrumentation (line 7 and lines 15-17).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The miros library will only instrument decorators with a <code class="docutils literal notranslate"><span class="pre">spy_on</span></code> as part of
their name, for this reason the <code class="docutils literal notranslate"><span class="pre">_pspy_on</span></code> inner function is called this.
This “feature” was added so that user defined decorators can be placed around
state functions (line 6, line 19).</p>
</div>
<p>Now that we have a new decorator that can route the instrumentation information
from our flat state methods back to our main statechart we can use them like
this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ..</span>

<span class="hll"><span class="nd">@instrumented</span>
</span><span class="k">def</span> <span class="nf">s1_region</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">INIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">s11</span><span class="p">)</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">region_exit</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">s1_hidden_region</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">s1_hidden_region</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="hll"><span class="nd">@instrumented</span>
</span><span class="k">def</span> <span class="nf">s11</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">UNHANDLED</span>
  <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">ENTRY_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">e4</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">trans</span><span class="p">(</span><span class="n">s12</span><span class="p">)</span>
  <span class="k">elif</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal</span> <span class="o">==</span> <span class="n">signals</span><span class="o">.</span><span class="n">EXIT_SIGNAL</span><span class="p">):</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">s1_region</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">SUPER</span>
  <span class="k">return</span> <span class="n">status</span>

<span class="c1"># ..</span>
</pre></div>
</div>
<p>Any flat method decorated with the <code class="docutils literal notranslate"><span class="pre">&#64;instrumented</span></code> will route its
instrumentation information back into our main chart, and it will appear in the
<code class="docutils literal notranslate"><span class="pre">xml_chart.log</span></code> in the correct sequence.  Well, almost…</p>
<p>The instrumentation stream coming from the orthogonal components will arrive in
the log file before the event, which initiates from the <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code>.  This is
because the instrumentation code for a <code class="docutils literal notranslate"><span class="pre">XMLChart</span></code> runs after an event has been
processed.   The <code class="docutils literal notranslate"><span class="pre">&#64;instrumented</span></code> decorate doesn’t wait; it just writes what it
sees immediately into the <code class="docutils literal notranslate"><span class="pre">live_spy_callback</span></code>.</p>
<p>Having the region events write themselves to the log before the event which
triggered them in the first place, will make the log file a bit confusing to
read.</p>
<p>To make it easier to read, you will use the <code class="docutils literal notranslate"><span class="pre">scribble</span></code> feature, and pound a
note into the spy stream before a region is run, like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">p_dispatcher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
  <span class="n">status</span> <span class="o">=</span> <span class="n">return_status</span><span class="o">.</span><span class="n">HANDLED</span>
<span class="hll">  <span class="bp">self</span><span class="o">.</span><span class="n">live_spy_callback</span><span class="p">(</span><span class="s2">&quot;{}:p&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">signal_name</span><span class="p">))</span>
</span>  <span class="p">[</span><span class="n">region</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="p">]</span>
  <span class="p">[</span><span class="n">region</span><span class="o">.</span><span class="n">complete_circuit</span><span class="p">()</span> <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_regions</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">status</span>
</pre></div>
</div>
<p>Let’s build and run the chart, then look at the resulting log file:</p>
<a class="reference external image-reference" href="_static/.pdf"><img alt="_images/xml_chart_7.svg" class="scale-to-fit" src="_images/xml_chart_7.svg" /></a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

  <span class="c1"># lines 1-7 in log file</span>
  <span class="n">example</span> <span class="o">=</span> <span class="n">XmlChart</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;parallel&#39;</span><span class="p">,</span>
    <span class="n">live_spy</span><span class="o">=</span><span class="bp">True</span>
  <span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

  <span class="c1"># lines 8-26</span>
  <span class="n">example</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">to_p</span><span class="p">))</span>

  <span class="c1"># lines 27-38</span>
  <span class="n">example</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">e4</span><span class="p">))</span>

  <span class="c1"># lines 39-54</span>
  <span class="n">example</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">e1</span><span class="p">))</span>

  <span class="c1"># lines 55-73</span>
  <span class="n">example</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">to_outer</span><span class="p">))</span>

  <span class="c1"># lines 74-92</span>
  <span class="n">example</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">to_p</span><span class="p">))</span>

  <span class="c1"># lines 93-104</span>
  <span class="n">example</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">e4</span><span class="p">))</span>

  <span class="c1"># lines 105-120</span>
  <span class="n">example</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">e1</span><span class="p">))</span>

  <span class="c1"># lines 121-151, and causes chart to post p_final to itself</span>
  <span class="n">example</span><span class="o">.</span><span class="n">post_fifo</span><span class="p">(</span><span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">e2</span><span class="p">))</span>
  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.10</span><span class="p">)</span>
</pre></div>
</div>
<p>log:</p>
<div class="highlight-shell notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,431 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::START
</span> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,432 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::START
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,433 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> START
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,433 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> SEARCH_FOR_SUPER_SIGNAL:outer_state
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,433 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> ENTRY_SIGNAL:outer_state
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,434 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> INIT_SIGNAL:outer_state
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,434 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> &lt;- Queued:<span class="o">(</span><span class="m">0</span><span class="o">)</span> Deferred:<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<span class="hll"> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,435 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> to_p:outer_state
</span> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,435 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> to_p:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,436 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,436 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::ENTRY_SIGNAL:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,436 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::INIT_SIGNAL:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,437 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s11
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,437 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::ENTRY_SIGNAL:s11
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,437 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::INIT_SIGNAL:s11
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,438 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,438 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::ENTRY_SIGNAL:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,438 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::INIT_SIGNAL:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,439 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,439 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::ENTRY_SIGNAL:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,439 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::INIT_SIGNAL:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,440 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> to_p:outer_state
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,440 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> SEARCH_FOR_SUPER_SIGNAL:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,440 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> ENTRY_SIGNAL:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,440 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> INIT_SIGNAL:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,440 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> &lt;- Queued:<span class="o">(</span><span class="m">7</span><span class="o">)</span> Deferred:<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<span class="hll"> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,440 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e4:p
</span> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,441 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::e4:s11
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,441 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s12
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,441 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s11
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,442 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::EXIT_SIGNAL:s11
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,442 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::ENTRY_SIGNAL:s12
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,442 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::INIT_SIGNAL:s12
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,443 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::e4:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,443 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::e4:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,443 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e4:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,444 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e4:p:HOOK
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,444 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> &lt;- Queued:<span class="o">(</span><span class="m">6</span><span class="o">)</span> Deferred:<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<span class="hll"> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,444 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e1:p
</span> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,444 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::e1:s12
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,444 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s1_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,445 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s12
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,445 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::EXIT_SIGNAL:s12
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,445 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::ENTRY_SIGNAL:s1_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,446 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::INIT_SIGNAL:s1_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,446 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::e1:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,446 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s22
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,447 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,447 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::EXIT_SIGNAL:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,447 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::ENTRY_SIGNAL:s22
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,447 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::INIT_SIGNAL:s22
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,448 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e1:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,448 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e1:p:HOOK
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,448 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> &lt;- Queued:<span class="o">(</span><span class="m">5</span><span class="o">)</span> Deferred:<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<span class="hll"> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,448 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> to_outer:p
</span> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,449 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> region_exit:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,449 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::region_exit:s1_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,449 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::region_exit:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,450 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::EXIT_SIGNAL:s1_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,450 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,450 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::EXIT_SIGNAL:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,451 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::region_exit:s22
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,451 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::region_exit:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,452 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::EXIT_SIGNAL:s22
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,452 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s22
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,452 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,453 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::EXIT_SIGNAL:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,453 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> to_outer:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,453 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> SEARCH_FOR_SUPER_SIGNAL:outer_state
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,453 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> SEARCH_FOR_SUPER_SIGNAL:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,454 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> EXIT_SIGNAL:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,454 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> INIT_SIGNAL:outer_state
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,454 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> &lt;- Queued:<span class="o">(</span><span class="m">4</span><span class="o">)</span> Deferred:<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<span class="hll"> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,454 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> to_p:outer_state
</span> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,454 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> to_p:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,455 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,455 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::ENTRY_SIGNAL:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,455 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::INIT_SIGNAL:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,456 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s11
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,456 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::ENTRY_SIGNAL:s11
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,456 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::INIT_SIGNAL:s11
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,457 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,457 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::ENTRY_SIGNAL:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,457 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::INIT_SIGNAL:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,458 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,458 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::ENTRY_SIGNAL:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,458 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::INIT_SIGNAL:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,459 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> to_p:outer_state
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,459 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> SEARCH_FOR_SUPER_SIGNAL:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,459 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> ENTRY_SIGNAL:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,459 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> INIT_SIGNAL:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,459 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> &lt;- Queued:<span class="o">(</span><span class="m">3</span><span class="o">)</span> Deferred:<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<span class="hll"> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,459 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e4:p
</span> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,460 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::e4:s11
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,460 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s12
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,460 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s11
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,461 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::EXIT_SIGNAL:s11
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,461 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::ENTRY_SIGNAL:s12
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,461 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::INIT_SIGNAL:s12
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,462 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::e4:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,462 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::e4:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,462 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e4:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,463 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e4:p:HOOK
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,463 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> &lt;- Queued:<span class="o">(</span><span class="m">2</span><span class="o">)</span> Deferred:<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<span class="hll"> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,463 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e1:p
</span> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,463 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::e1:s12
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,464 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s1_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,464 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s12
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,464 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::EXIT_SIGNAL:s12
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,464 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::ENTRY_SIGNAL:s1_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,465 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::INIT_SIGNAL:s1_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,465 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::e1:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,465 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s22
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,466 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,466 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::EXIT_SIGNAL:s21
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,466 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::ENTRY_SIGNAL:s22
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,467 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::INIT_SIGNAL:s22
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,467 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e1:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,467 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e1:p:HOOK
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,467 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> &lt;- Queued:<span class="o">(</span><span class="m">1</span><span class="o">)</span> Deferred:<span class="o">(</span><span class="m">0</span><span class="o">)</span>
<span class="hll"> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,467 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e2:p
</span> <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,468 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::e2:s1_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,468 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::e2:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,468 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::e2:s22
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,469 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s2_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,469 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s22
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,469 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::EXIT_SIGNAL:s22
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,470 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::ENTRY_SIGNAL:s2_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,470 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::INIT_SIGNAL:s2_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,470 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e2:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,470 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> POST_FIFO:p_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,470 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> e2:p:HOOK
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,471 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> &lt;- Queued:<span class="o">(</span><span class="m">1</span><span class="o">)</span> Deferred:<span class="o">(</span><span class="m">0</span><span class="o">)</span>
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,471 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> region_exit:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,472 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::region_exit:s1_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,472 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::region_exit:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,472 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::EXIT_SIGNAL:s1_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,473 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::SEARCH_FOR_SUPER_SIGNAL:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,473 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s1_r::EXIT_SIGNAL:s1_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,473 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::region_exit:s2_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,474 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::region_exit:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,474 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::EXIT_SIGNAL:s2_region_final
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,474 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::SEARCH_FOR_SUPER_SIGNAL:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,475 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> s2_r::EXIT_SIGNAL:s2_region
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,475 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> p_final:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,476 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> SEARCH_FOR_SUPER_SIGNAL:some_other_state
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,476 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> SEARCH_FOR_SUPER_SIGNAL:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,476 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> EXIT_SIGNAL:p
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,476 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> ENTRY_SIGNAL:some_other_state
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,476 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> INIT_SIGNAL:some_other_state
 <span class="m">2019</span>-12-06 <span class="m">09</span>:39:43,476 DEBUG:S: <span class="o">[</span>parallel<span class="o">]</span> &lt;- Queued:<span class="o">(</span><span class="m">0</span><span class="o">)</span> Deferred:<span class="o">(</span><span class="m">0</span><span class="o">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


        
        <div class="main-content__right-sidebar">
          <h2 class="sidebar-heading">On this page:</h2>
        </div>
      </div>
    </main>

    <div class="footer-wrapper">
      
      <footer class="main-footer main-footer--sidebar">
      
        <div class="relational-links">
          <div>
            
            ← <a class="relational-link" href="towardsthefactoryexample.html" title="previous chapter">Using and Unwinding a Factory</a>
            
          </div>
          <div>
            
             <a class="relational-link" href="batterychargingexample.html" title="next chapter">Distributed Battery Charging</a> →
            
          </div>
        </div>
        
        <div class="copyright">
          © Copyright <span class="js-year"></span>,
          
          <a href="https://github.com/aleph2c" class="copyright_link">Scott Volk</a>.
          
        </div>
        
        
        <div class="last-updated">
          <span class="prefix">Last updated:</span>
          <span class="time">Jul 02, 2020 12:46 PM</span>
        </div>
        
        
        <div class="created-with">
          Created using <a href="http://sphinx-doc.org/" class="copyright_link">Sphinx</a> 3.1.1 with <span class="theme">13ds_theme_one</span>.
        </div>
        
      </footer>
    </div>
  </body>
</html>