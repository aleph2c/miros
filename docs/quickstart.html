
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Quick Start &#8212; miros 2.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Zero To One" href="zero_to_one.html" />
    <link rel="prev" title="Introduction" href="introduction.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <blockquote>
<div><p><em>I invented the term object oriented, and I can tell you that C++ wasn’t what I had in mind.</em></p>
<p class="attribution">&mdash;Alan Kay</p>
</div></blockquote>
<div class="section" id="quick-start">
<span id="id1"></span><h1>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h1>
<p>If you know nothing about statecharts I suggest you start here: <a class="reference internal" href="zero_to_one.html#zero-to-one-zero-to-one"><span class="std std-ref">zero to
one</span></a></p>
<p>If you haven’t seen UML diagrams before, scan the <a class="reference internal" href="reading_diagrams.html#reading-diagrams-reading-diagrams"><span class="std std-ref">understanding diagrams</span></a> part of this guide to make sense of the
pictures.</p>
<p>If you are an embedded developer and want to port your working miros Python code to
C/C++ for a considerable performance gain.  Check out this project: <a class="reference external" href="https://github.com/QuantumLeaps/qpc">qp codebase</a>.  It is documented here: <a class="reference external" href="https://sourceforge.net/projects/qpc/files/doc/PSiCC2.pdf/download">Practical UML
Statecharts in C/C++, 2nd Edition</a>.</p>
<p>In the next section we will show how to tackle a problem using UML statecharts.</p>
<div class="section" id="a-networked-sprinkler">
<span id="quickstart-a-quick-example"></span><h2>A Networked Sprinkler<a class="headerlink" href="#a-networked-sprinkler" title="Permalink to this headline">¶</a></h2>
<p>Let’s use the Python miros library to build a sprinkler. This
sprinkler will water our plants in the summer, after dark, and only when it is
not raining.  To do this we will call out to the <a class="reference external" href="https://openweathermap.org/api">open weather api</a>.</p>
<a class="reference external image-reference" href="https://www.ijcaonline.org/archives/volume172/number6/28254-2017915160"><img alt="_images/sprinkler.jpg" class="align-center" src="_images/sprinkler.jpg" /></a>
<p>Once the networked sprinkler knows which city its working in it should just turn
on and operate as if it could measure the weather conditions with local instruments.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">open</span> <span class="pre">weather</span></code> documentation recommends that we request city information
using a city ID, so our software should extract this id from a file the <code class="docutils literal notranslate"><span class="pre">open</span>
<span class="pre">weather</span></code> folks have put on their website:
<a class="reference external" href="http://bulk.openweathermap.org/sample/city.list.json.gz">http://bulk.openweathermap.org/sample/city.list.json.gz</a>.</p>
<p>Our design will consist of three different active objects which will work
together:</p>
<blockquote>
<div><ul class="simple">
<li>something that will control the sprinkler (Sprinkler).</li>
<li>something that will download a file from the open weather website and
extract the correct city ID for a given city and country
(OpenWeatherMapCityDetails).</li>
<li>something that will act like a weather station attached to the sprinkler,
by making calls to the open weather API (CityWeather).</li>
</ul>
</div></blockquote>
<p>Here is a high level diagram of how these parts fit together and what they do:</p>
<a class="reference external image-reference" href="_static/sprinkler_high_level.pdf"><div align="center" class="align-center"><img alt="_images/sprinkler_high_level.svg" src="_images/sprinkler_high_level.svg" /></div>
</a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>On interpreting the diagram:</p>
<p class="last">The Sprinkler class <strong>will have a</strong> CityWeather object <strong>and an</strong>
OpenWeatherMapCityDetails object (black diamond arrows).  The CityWeather
object will interact with the Sprinkler and OpenWeatherMapCityDetails objects.
(dashed lines)</p>
</div>
<p>We will use three different statecharts, one per object in the above diagram.
Having independent objects interface in a statechart is called orthogonality in
statechart theory.</p>
<div class="section" id="figuring-out-what-information-will-be-passed-around">
<span id="quickstart-figuring-out-what-information-will-be-passed-around"></span><h3>Figuring out what Information will be Passed Around<a class="headerlink" href="#figuring-out-what-information-will-be-passed-around" title="Permalink to this headline">¶</a></h3>
<p>Let’s wave our hands an assume that the three active objects used in this
designed have been built already and are working, but we want to figure out how
they will communicate with one another.</p>
<p>David Harel called such a thing, a <code class="docutils literal notranslate"><span class="pre">statocol</span></code> (state protocol):  what
information will the statecharts need to share, so as a group, they will
achieve our design goal; and give us our networked sprinkler:</p>
<a class="reference external image-reference" href="_static/sprinkler_high_level.pdf"><div align="center" class="align-center"><img alt="_images/sprinkler_high_level.svg" src="_images/sprinkler_high_level.svg" /></div>
</a>
<p>We need to figure out how to call the open weather api, with a city id, before it
will return weather information for its location. This is the problem the
<code class="docutils literal notranslate"><span class="pre">OpenWeatherMapCityDetails</span></code> object solves: it will provide the city id when we
give it the city and country names of where we have placed the sprinkler.</p>
<p>A rough sketch of the <code class="docutils literal notranslate"><span class="pre">OpenWeatherMapCityDetails</span></code> object will look like this:</p>
<a class="reference external image-reference" href="_static/open_weather_map_city_details_medium.pdf"><div align="center" class="align-center"><img alt="_images/open_weather_map_city_details_medium.svg" src="_images/open_weather_map_city_details_medium.svg" /></div>
</a>
<p>This diagram shows us the input and output goals; for a city and a country
return the open weather api’s city id.</p>
<p><code class="docutils literal notranslate"><span class="pre">OpenWeatherMapCityDetails</span></code> will subscribe to and receive events called
<code class="docutils literal notranslate"><span class="pre">REQUEST_DETAILS_FOR_CITY</span></code>.  Below this event is the namedtuple,
<code class="docutils literal notranslate"><span class="pre">RequestDetailsForCityPayload</span></code>.  This is the immutable payload that will ride
inside of the event.  Likewise the namedtuple called <code class="docutils literal notranslate"><span class="pre">CityDetailsPayload</span></code> will
ride inside of the <code class="docutils literal notranslate"><span class="pre">CITY_DETAILS</span></code> event.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>On interpreting the diagram:</p>
<p class="last">All of the high level event interfaces will look like this one.  Arrows going
into the rounded rectangle beside the green dots are the published events
that the object will consume.  Arrows leaving the object, beside the red
dots, will be the events it publishes.  The namedtuples near the event’s name
will describe the payload data structure.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>On namedtuples:</p>
<p class="last">The miros library can place any kind of object into an event payload.
However event payloads are objects that are shared between threads, we don’t
want one thread to change this object while another thread is trying to read
it, so as a rule use immutable objects as payloads when programming with miros
(to avoid nasty multithreading bugs).</p>
</div>
<p>The high level event interface of the <code class="docutils literal notranslate"><span class="pre">CityWeather</span></code> object looks like this:</p>
<a class="reference external image-reference" href="_static/city_weather_details_medium.pdf"><div align="center" class="align-center"><img alt="_images/city_weather_details_medium.svg" src="_images/city_weather_details_medium.svg" /></div>
</a>
<p>This diagram shows us the <code class="docutils literal notranslate"><span class="pre">CityWeather</span></code> input and output goals: For a city and
a country get its city id, and when asked, return the weather information for
that city.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>On implimentation (and sausage making):</p>
<p class="last">I wrote some prototype code, to poke at the open weather city api prior to
designing this system.  I used the python debugger to break right after
receiving a message from their service.  I compared what I was seeing with
their documentation, then decided on what the payload data structures should
look like.</p>
</div>
<p>Here is the high level interface diagram of the <code class="docutils literal notranslate"><span class="pre">Sprinkler</span></code>:</p>
<a class="reference external image-reference" href="_static/sprinkler_details_medium.pdf"><div align="center" class="align-center"><img alt="_images/sprinkler_details_medium.svg" src="_images/sprinkler_details_medium.svg" /></div>
</a>
<p>This diagram shows us the <code class="docutils literal notranslate"><span class="pre">Sprinkler</span></code> input and output goals: Ask for the
weather and get the weather.</p>
<p>There can be many events which all share the same name; an event’s name is
called a signal.  An event of a particular signal, can also carry a python
object with it.  As this event is passed through the system, the object that it
is carrying stays linked to it.  A linked object is called a payload.  The miros
library lets you link any python object to an event, or in other words, your
Event can have any Python object as a payload.  However, we are limiting
ourselves to only send namedtuples as payloads, because they are immutable and
provide very nice syntax.</p>
<p>Here is how you would use the miros library to publish (public send) a
<code class="docutils literal notranslate"><span class="pre">REQUEST_DETAILS_FOR_CITY</span></code> event:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">miros</span> <span class="kn">import</span> <span class="n">event</span>
<span class="kn">from</span> <span class="nn">miros</span> <span class="kn">import</span> <span class="n">signals</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="c1"># define the REQUEST_DETAILS_FOR_CITY payload type</span>
<span class="n">RequestDetailsForCityPayload</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;RequestDetailsForCityPayload&#39;</span><span class="p">,</span>
  <span class="p">[</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">])</span>

<span class="c1"># Assume the CityWeather ActiveObject has been defined elsewhere and is</span>
<span class="c1"># working.</span>
<span class="n">city_weather</span> <span class="o">=</span> <span class="n">CityWeather</span><span class="p">()</span>

<span class="c1"># Published an event will have a red dot beside it on the diagram, it</span>
<span class="c1"># publishes and the event has to wait somewhere before it is processed (red</span>
<span class="c1"># light).</span>
<span class="c1">#</span>
<span class="c1"># If the &#39;REQUEST_DETAILS_FOR_CITY&#39; signal name has not been defined before</span>
<span class="c1"># miros will define it now.  Its signal will be given a signal_number</span>
<span class="c1"># attribute and a signal_name attribute equal to &#39;REQUEST_DETAILS_FOR_CITY&#39;</span>
<span class="c1"># (signal name construction happens automatically in miros)</span>
<span class="n">city_weather</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
  <span class="n">Event</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signals</span><span class="o">.</span><span class="n">REQUEST_DETAILS_FOR_CITY</span><span class="p">,</span>
    <span class="n">payload</span><span class="o">=</span><span class="n">RequestDetailsForCityPayload</span><span class="p">(</span><span class="n">city</span><span class="o">=</span><span class="s1">&#39;Vancouver&#39;</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="s1">&#39;CA&#39;</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span>
<span class="c1"># any ActiveObject that has subscribed to REQUEST_DETAILS_FOR_CITY will</span>
<span class="c1"># receive the event and react to it.  When an event is received which</span>
<span class="c1"># was subscribed to on the diagram, it will have a green dot beside it.</span>
<span class="c1"># (green light)</span>
</pre></div>
</div>
<p>Now that we have a decent understanding about what information we want to flow
in our system, let’s focus in on each part.</p>
</div>
<div class="section" id="openweathermapcitydetails-specifications">
<span id="quickstart-openweathermapcitydetails-specifications"></span><h3>OpenWeatherMapCityDetails Specifications<a class="headerlink" href="#openweathermapcitydetails-specifications" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">OpenWeatherMapCityDetails</span></code> needs to provide a city ID given a city and a
country.  This city ID will be used by the <code class="docutils literal notranslate"><span class="pre">CityDetails</span></code> object to make a call
to the open web API.</p>
<a class="reference external image-reference" href="_static/open_weather_map_city_details.pdf"><div align="center" class="align-center"><img alt="_images/open_weather_map_city_details.svg" src="_images/open_weather_map_city_details.svg" /></div>
</a>
</div>
<div class="section" id="cityweather-specifications">
<span id="quickstart-citydetails-specifications"></span><h3>CityWeather Specifications<a class="headerlink" href="#cityweather-specifications" title="Permalink to this headline">¶</a></h3>
<a class="reference external image-reference" href="_static/city_weather.pdf"><div align="center" class="align-center"><img alt="_images/city_weather.svg" src="_images/city_weather.svg" /></div>
</a>
</div>
<div class="section" id="sprinkler-specifications">
<span id="quickstart-sprinkler-specifications"></span><h3>Sprinkler Specifications<a class="headerlink" href="#sprinkler-specifications" title="Permalink to this headline">¶</a></h3>
<a class="reference external image-reference" href="_static/sprinkler.pdf"><div align="center" class="align-center"><img alt="_images/sprinkler.svg" src="_images/sprinkler.svg" /></div>
</a>
<a class="reference internal" href="introduction.html"<span class="std-ref">prev</span></a>, <a class="reference internal" href="index.html#top"><span class="std std-ref">top</span></a>, <a class="reference internal" href="zero_to_one.html"><span class="std std-ref">next</span></a><div class="toctree-wrapper compound">
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="index.html">
  <img class="logo_a" src="_static/miros_a.svg" width="250" alt="Logo" >
</a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Quick Start</a><ul>
<li><a class="reference internal" href="#a-networked-sprinkler">A Networked Sprinkler</a><ul>
<li><a class="reference internal" href="#figuring-out-what-information-will-be-passed-around">Figuring out what Information will be Passed Around</a></li>
<li><a class="reference internal" href="#openweathermapcitydetails-specifications">OpenWeatherMapCityDetails Specifications</a></li>
<li><a class="reference internal" href="#cityweather-specifications">CityWeather Specifications</a></li>
<li><a class="reference internal" href="#sprinkler-specifications">Sprinkler Specifications</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="introduction.html" title="previous chapter">Introduction</a></li>
      <li>Next: <a href="zero_to_one.html" title="next chapter">Zero To One</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/quickstart.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Scott Volk.
      
      |
      <a href="_sources/quickstart.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>